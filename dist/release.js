var v="function"==typeof Object.defineProperties?Object.defineProperty:function(g,r,p){if(g==Array.prototype||g==Object.prototype)return g;g[r]=p.value;return g};function x(g){g=["object"==typeof globalThis&&globalThis,g,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var r=0;r<g.length;++r){var p=g[r];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");}var H=x(this);
function M(g,r){if(r)a:{var p=H;g=g.split(".");for(var y=0;y<g.length-1;y++){var C=g[y];if(!(C in p))break a;p=p[C]}g=g[g.length-1];y=p[g];r=r(y);r!=y&&null!=r&&v(p,g,{configurable:!0,writable:!0,value:r})}}function N(g){g=Math.trunc(g)||0;0>g&&(g+=this.length);if(!(0>g||g>=this.length))return this[g]}M("Array.prototype.at",function(g){return g?g:N});function O(g){return g?g:N}M("Int8Array.prototype.at",O);M("Uint8Array.prototype.at",O);M("Uint8ClampedArray.prototype.at",O);
M("Int16Array.prototype.at",O);M("Uint16Array.prototype.at",O);M("Int32Array.prototype.at",O);M("Uint32Array.prototype.at",O);M("Float32Array.prototype.at",O);M("Float64Array.prototype.at",O);M("String.prototype.at",function(g){return g?g:N});
(()=>{function g(a,b,c=0){0==c&&(c=b);var d=q(a.width*c,a.height*b),e=d.getContext("2d");for(let f=0;f<b;f++)for(let l=0;l<c;l++)e.drawImage(a,l*a.width,f*a.height);return d}function r(a,b){let c=q(a.width,a.height),d=c.getContext("2d");return d.globalAlpha=b,d.drawImage(a,0,0),d.globalAlpha=1,c}function p(a,b,c,d){var e=q(2*a.width,2*a.height),f=e.getContext("2d");return f.drawImage(a,0,0),f.drawImage(b,a.width,0),f.drawImage(c,0,a.height),f.drawImage(d,a.width,a.height),e}class y{constructor(a=
1/60,b,c=!1){this.at=0;this.ja=null;this.ya=a;this.t=b;c&&this.start();this.p=this.I=!1}Cb(a){if(this.ja)for(this.at+=(a-this.ja)/1E3,1<this.at&&(this.at=1);this.at>this.ya;){this.t.update(Math.floor(a/1E3));this.at-=this.ya;break}this.ja=a;this.I||this.Ia()}Ia(){requestAnimationFrame(a=>{this.Cb(a)})}start(){this.I=!1;this.Ia()}stop(){this.I=!0}}class C{constructor(a){this.o=a;this.U=[]}update(a){this.time=a;[...this.U].forEach(b=>{b.update&&b.update(a)});this.U=this.U.filter(b=>!b.delete)}u(a){a.clearRect(0,
0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);[...this.U].forEach(b=>{b.u&&b.u(a)})}aa(a){this.o.Ha=this.o.v;a.o=this.o;this.o.Na(a)}zb(a){this.o.Na(this.o.Ha);this.o.Ha=a}notify(a){let b=a.name;a=a.event;"keydown"==b&&this.R?this.R(a):"keyup"==b&&this.M?this.M(a):"mousemove"==b&&this.ub||("click"==b&&this.click?this.click(a):"control"==b&&this.control?this.control(a.key):"controlts"==b&&this.Xa?this.Xa(a.key):"controlte"==b&&this.Wa?this.Wa(a.key):
console.log(b))}ub(){}M(a){this.control(a.key)}}const P=Math.PI,F=(a,b=document)=>b.querySelector(a),Q=(a=1,b=0)=>b+(a-b)*Math.random(),q=(a=0,b=0)=>{let c=document.createElement("canvas");return c.width=a,c.height=b,c},I=(a,b)=>{b=b%8*P/4;var c,d,e,f;0==b%(Math.PI/4)?(e=a.width,f=a.height,c=d=Math.sqrt(e*e+f*f)):(c=a.width,d=a.height);e=q(c,d);f=e.getContext("2d");c/=2;d/=2;return f.imageSmoothingQuality="high",f.save(),f.translate(c,d),f.rotate(b),f.drawImage(a,0,0,a.width,a.height,-a.width/2,-a.height/
2,a.width,a.height),f.restore(),e},D=(a,b,c,d,e)=>{let f=q(d,e);return f.getContext("2d").drawImage(a,b,c,d,e,0,0,d,e),f},z=(a,b=1,c=null)=>{let d=a.length,e=Math.max(...a.map(k=>k.length));var f=q(e*b,d*b),l=f.getContext("2d");for(let k=0;k<d;k++)for(let n=0;n<e;n++){var m=a[k][n];c&&(m=c(m));m&&""!=m&&(l.fillStyle=m,l.fillRect(n*b,k*b,b,b))}return f},A=(a,b)=>{for(var c=a.getContext("2d").getImageData(0,0,a.width,a.height).data,d=[],e=0;e<c.length;e+=4){var f=d,l=f.push;var m=c[e];var k=c[e+1],
n=c[e+2];m=0==m+k+n+c[e+3]?null:0==m+k+n||255<m||255<k||255<n?"#000000":"#"+((m<<16)+(k<<8)+n).toString(16).padStart(6,"0");l.call(f,m)}c=[];for(e=0;e<a.height;e++)c[e]=[];f=e=0;for(l=0;l<d.length;l++)e>=a.width&&(f++,e=0),c[f][e]=d[l],b&&(c[f][e]=b(c[f][e])),e++;return c},K=(a,b,c="source-atop")=>{let d=q(a.width,a.height),e=d.getContext("2d");e.drawImage(a,0,0);e.globalCompositeOperation=c;for(c=0;c<a.width/b.width;c++)for(let f=0;f<a.height/b.height;f++)e.drawImage(b,c*b.width,f*b.height);return d},
t=[{c:0,h:0,n:"dirt",x:88,y:0,w:8,g:8},{c:0,h:0,n:"grass",x:96,y:0,w:8,g:8},{c:0,h:0,n:"water",x:104,y:0,w:8,g:8},{c:0,h:0,n:"steel",x:112,y:0,w:8,g:8},{c:0,h:0,n:"brick",x:120,y:0,w:8,g:8},{c:1,h:0,n:"magic",x:88,y:8,w:8,g:8},{c:1,h:1,n:"tree",x:96,y:8,w:8,g:8},{c:1,h:0,n:"log",x:104,y:8,w:8,g:8},{c:1,h:0,n:"apple",x:112,y:8,w:8,g:8},{c:1,h:0,n:"lemon",x:120,y:8,w:8,g:8},{c:1,h:0,n:"sword",x:88,y:16,w:8,g:8},{c:1,h:0,n:"bow",x:96,y:16,w:8,g:8},{c:1,h:0,n:"arrow",x:104,y:16,w:8,g:8},{c:1,h:0,n:"rabbit",
x:88,y:24,w:8,g:8},{c:1,h:0,n:"wolf",x:96,y:24,w:16,g:8},{c:1,h:0,n:"castle",x:128,y:0,w:32,g:32},{c:1,h:0,n:"fort",x:112,y:16,w:16,g:16},{c:1,h:0,n:"player",x:0,y:32,w:16,g:16},{c:1,h:0,n:"playerb",x:16,y:32,w:16,g:16},{c:1,h:0,n:"players",x:32,y:32,w:8,g:16},{c:1,h:0,n:"playerh",x:40,y:32,w:8,g:16},{c:1,h:0,n:"bear",x:48,y:32,w:16,g:16},{c:1,h:0,n:"deer",x:64,y:32,w:16,g:16},{c:1,h:0,n:"house",x:80,y:32,w:16,g:16},{c:1,h:0,n:"shop",x:96,y:32,w:16,g:16},{c:1,h:0,n:"npcgirl",x:112,y:32,w:16,g:16},
{c:1,h:0,n:"npcman",x:128,y:32,w:16,g:16},{c:1,h:0,n:"direction",x:128,y:32,w:16,g:16},{c:0,h:0,n:"map_house",x:0,y:48,w:16,g:16},{c:0,h:0,n:"map_villge",x:16,y:48,w:16,g:16},{c:0,h:0,n:"map_village_2",x:32,y:48,w:16,g:16},{c:0,h:0,n:"map_castle",x:48,y:48,w:16,g:16},{c:0,h:0,n:"map_forest_1",x:64,y:48,w:16,g:16},{c:0,h:0,n:"map_forest_2",x:80,y:48,w:16,g:16},{c:0,h:0,n:"map_forest_3",x:96,y:48,w:16,g:16},{c:0,h:0,n:"map_forest_4",x:112,y:48,w:16,g:16}];class B{constructor(){this.Ma=this.nb()}nb(){if(B.sa)return B.sa;
for(let a=0;a<t.length;a++)t[a].Gb=this.get(t[a].n),t[a].Ka=this.i(t[a].n,2),t[a].La=this.i(t[a].n,3);B.sa=t}Ca(a){return(this.Ma?this.Ma:t).find(b=>b.n.toLowerCase()==a.toLowerCase())}get(a){a=this.Ca(a);if(!a||null==a.x)return null;if(a.I)return a.I;var b=F("#spriteSheetMain");b=D(b,a.x,a.y,a.w,a.g);return a.c?(a=A(b,c=>"#ffffff"===c?"":c),z(a,1,c=>c)):b}i(a,b=1){var c=this.Ca(a);if(c&&2==b&&c.Ka)return c.Ka;if(c&&3==b&&c.La)return c.La;a=this.get(a);a=A(a,d=>"#ffffff"==d?"":d);return z(a,b,d=>
d)}static Y(a,b=1){a=this.gb(a);a=A(a,c=>"#ffffff"==c?"":c);return z(a,b,c=>c)}static gb(a){var b=t.find(d=>d.n.toLowerCase()==a.toLowerCase());if(b.I)return b.I;var c=F("#spriteSheetMain");c=D(c,b.x,b.y,b.w,b.g);return b.c?(b=A(c,d=>"#ffffff"===d?"":d),z(b,1,d=>d)):c}}class h{constructor(){}static get(a){var b=t.find(d=>d.n.toLowerCase()==a.toLowerCase()),c=F("#spriteSheetMain");c=D(c,b.x,b.y,b.w,b.g);return b.c?(b=A(c,d=>"#ffffff"===d?"":d),z(b,1,d=>d)):c}static i(a,b=1){a=this.get(a);a=A(a,c=>
"#ffffff"==c?"":c);return z(a,b,c=>c)}static getAll(a=1){var b={};for(let c in t)b[t[c].n]=1==a?h.get(t[c].n):h.i(t[c].n,a);return b}}class u{static Pa(){if(u.ba)return u.ba;var a=F("#spriteSheetMain");a=D(a,0,0,88,32);a=A(a,c=>"#ffffff"==c?"":c);var b=z(a,1,c=>c);return u.ba={canvas:b,H:a},u.ba}constructor(a={}){this.K=a;a.size?this.size=a.size:this.size=1;var b=u.Pa();this.H=JSON.parse(JSON.stringify(b.H));this.canvas=z(this.H,this.size,c=>a.color&&"#000000"==c?a.color:c);a.eb&&(this.canvas=K(this.canvas,
a.eb));this.Ua=this.ib(this.canvas,8*this.size)}B(a,b){let c=q(8*this.size*a.length,8*this.size),d=c.getContext("2d");a=a.toUpperCase();for(let e in a)d.drawImage(this.Ua[a[e]],this.size*e*8,0);return b&&(c=K(c,b)),c}ib(a,b){var c={};let d=0,e=0;for(let f=0;44>f;f++){let l=" 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ.:-\u00d7?\u00a9!"[f];11<=f&&0==f%11&&(e=0,d+=b);let m=D(a,e*b,d,b,b);c[l]=m;e++}return c}}class J{constructor(a){a.size&&(this.size=a.size);a.Aa&&(this.Aa=a.Aa)}static get(a){var b=h.i("log",
a);a=h.i("tree",a);var c=q(a.width,a.width+b.width),d=c.getContext("2d");return d.drawImage(a,0,0),d.drawImage(b,0,a.height),c}static fb(){var a=h.i("log",2),b=h.i("tree",2),c=q(b.width,b.height+2*a.height).getContext("2d");c.drawImage(b,0,0);c.drawImage(a,0,b.height);c.drawImage(a,0,b.height+a.height)}}class R{constructor(a,b=300,c=!0,d=!0,e=3){this.C=a;this.Ab=b;this.loop=e;this.pitch=d;this.S=!1;this.G=new AudioContext;this.Fa=this.C;c&&this.start()}toggle(){this.S?this.stop():this.start()}start(){this.S=
!0;this.Ga()}stop(){this.S=!1}reset(){this.C=this.Fa}lb(a){switch(a){case "B":return 493.88;case "C":return 261.63;case "D":return 293.66;case "E":return 329.63;case "F":return 349.23;case "G":return 392}return 440}kb(a){var b=this.lb(a[0]);return 1<a.length?b*Math.pow(2,a[1]/12):b}Ga(){if(this.S)if(0===this.C.length&&0<this.loop&&(this.C=this.Fa,this.loop--),0===this.C.length)this.stop();else{var a=this.C[0];this.pitch?(this.C[1],this.C=this.C.slice(2)):this.C=this.C.slice(1);var b=this.G.createOscillator(),
c=this.G.createGain();b.connect(c);c.connect(this.G.destination);b.frequency.setValueAtTime(this.kb(a),this.G.currentTime);b.start();c.gain.setValueAtTime(0,this.G.currentTime);c.gain.exponentialRampToValueAtTime(1,this.G.currentTime+.02);setTimeout(()=>{c.gain.setValueAtTime(1,this.G.currentTime);c.gain.exponentialRampToValueAtTime(.001,this.G.currentTime+.02);b.stop(this.G.currentTime+.02);this.Ga()},60/this.Ab*1E3)}}}class S extends C{constructor(a){super(a);this.s={oa:h.i("steel",1),qa:h.i("water",
1),Da:h.i("grass",1),m:h.i("player",1),Ja:h.i("rabbit",1),xa:h.i("deer",1),va:h.i("bear",1),Sa:h.i("apple",1),sb:h.i("lemon",1)};this.O=new u({color:"red",size:1});new u({color:"white",size:2});this.yb=new u({color:"white",size:3});this.buffer=this.na();this.y=0}na(){var a=q(this.o.K.width,1200);let b=a.getContext("2d");var c=64;return b.drawImage(this.yb.B("GAME INSTRUCTIONS",this.s.oa),32,c),c+=80,b.fillStyle="white",b.font="16px Arial",b.fillText("you step into the legendary shoes of Robin Hood.",
64,c),c+=20,b.fillText("your mission is to make the world a better place.",64,c),c+=20,b.fillText("- explore forest and hunt animals",64,c),c+=20,b.fillText("- do quests and trade with merchants",64,c),c+=20,b.fillText("- spread the wealth to the poor",64,c),c+=20,b.fillText("- improve your stats and defend the village",64,c),c+=20,c+=20,b.fillText("controls",64,c),c+=20,b.fillText("a/left : move left",64,c),c+=20,b.fillText("d/right : move right",64,c),c+=20,b.fillText("w/up : move up",64,c),c+=
20,b.fillText("s/down : move down",64,c),c+=20,b.fillText("space : shoot arrow",64,c),c+=20,b.fillText("e : interact with",64,c),c+=20,b.fillText("q : open menu",64,c),c+=20,c+=20,b.fillStyle="green",b.fillText("game play",64,c),c+=20,b.fillStyle="white",b.fillText("hunt animals in forest, rabbit, deer, bear",64,c),c+=20,b.drawImage(this.s.Ja,64,c+8),b.drawImage(this.s.xa,72,c),b.drawImage(this.s.va,88,c),c+=40,b.fillText("harvest trees to get apples and lemons",64,c),b.drawImage(this.s.Sa,64,c+8),
b.drawImage(this.s.sb,72,c+8),c+=40,b.fillText("things to do in town",64,c),c+=20,b.fillText("- trade hunts with merchants",64,c),c+=20,b.fillText("- give goodies to villagers for free (gain morale)",64,c),c+=20,b.fillText("- take quests from villagers for extra love",64,c),c+=40,b.fillStyle="green",b.fillText("extra things to do",64,c),c+=20,b.fillStyle="red",b.fillText("deep into the jungle lies the old wizzard",64,c),c+=20,b.fillText("find him and buy the magic bow",64,c),c+=20,b.fillStyle="white",
b.fillText("more instructions can be learned in game",64,c),a}update(a){this.time=a}u(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,this.y);a.fillText("Time "+this.time,20,20)}click(){}R(){}control(a){"s"===a||"ArrowDown"===a?this.y-=32:"w"===a||"ArrowUp"===a?this.y+=32:"fire"!==a&&"e"!==a&&"q"!==a&&"a"!==a&&"ArrowLeft"!==a&&"d"!==a&&"ArrowRight"!==a&&"space"!==
a&&" "!==a||this.aa(new L(this.o))}M(a){this.control(a.key)}}class w{constructor(a,b){this.x=a;this.y=b}is(a){let b=this.y,c=a.y;return this.x==a.x&&b==c}Ya(a){if(!a)return 1/0;let b=this.x,c=this.y,d=a.x;a=a.y;if(b==d&&c==a)return 0;if(b==d)return Math.abs(c-a);if(c==a)return Math.abs(b-d);let e=0;return e+=Math.pow(b-d,2),e+=Math.pow(c-a,2),e=Math.sqrt(e),e}jb(a){let b=this.x,c=this.y,d=a.x;a=a.y;return b==d&&c==a?4:b>d?6:b<d?2:c<a?4:c>a?0:4}move(a,b){0==a?this.y-=b:4==a?this.y+=b:6==a?this.x-=
b:2==a?this.x+=b:7==a?(this.y-=b,this.x-=b):1==a?(this.y-=b,this.x+=b):3==a?(this.y+=b,this.x+=b):5==a&&(this.y+=b,this.x-=b)}vb(a,b){let c=a.x-this.x,d=a.y-this.y,e=Math.sqrt(c*c+d*d);e<b?(this.x=a.x,this.y=a.y):(this.x+=(c/e||0)*b,this.y+=(d/e||0)*b)}clone(){return new w(this.x,this.y)}u(a,b="red"){a.fillStyle=b;this.$a(a,b)}$a(a,b="green"){a.fillStyle=b;a.strokeStyle=b;a.beginPath();a.arc(this.x,this.y,3,0,2*Math.PI);a.fill()}}const T=[{n:"tree",h:1,c:"#0d3702"},{n:"brick",h:1,c:"#bf0a0a"},{n:"dirt",
h:0,c:"#d9a066"},{n:"grass",h:0,c:"#99e550"},{n:"water",h:1,c:"#8a99f6"},{n:"steel",h:1,c:"#6a6a6a"},{n:"player",h:1,c:"#130c40"}];class U{constructor(a=32){this.l=new B;this.mb(a)}rb(a,b){return(a=Math.floor(a),b=Math.floor(b),0>a)||a>this.H.length||0>b||b>this.H.length?!0:this.qb(this.H[a][b])}qb(a){var b=T.find(c=>c.c==a);return null==b||1==b.h}mb(a=1){var b=this.l.get("map_house"),c=this.l.get("map_villge"),d=this.l.get("map_village_2"),e=this.l.get("map_castle"),f=this.l.get("map_forest_1"),
l=this.l.get("map_forest_2"),m=this.l.get("map_forest_3"),k=this.l.get("map_forest_4");b=p(b,f,l,c);l=p(f,f,f,m);c=p(f,e,c,f);d=p(k,m,d,f);d=p(b,l,c,d);this.H=d=A(d);f={"#0d3702":this.l.i("tree",2*a),"#d9a066":g(this.l.get("dirt"),2*a),"#bf0a0a":g(this.l.get("brick"),2*a),"#99e550":g(this.l.get("grass"),2*a),"#8a99f6":g(this.l.get("water"),2*a),"#6a6a6a":g(this.l.get("steel"),2*a),"#a9a9a9":this.l.i("castle",2*a),"#fbf236":this.l.i("house",2*a),"#eca732":this.l.i("shop",2*a)};a*=16;m=q(d.length*a,
d.length*a);k=m.getContext("2d");for(c=0;c<d.length;c++)for(e=0;e<d[c].length;e++)b=d[c][e],"#0d3702"==b?(k.drawImage(.5<Q()?f["#d9a066"]:f["#99e550"],c*a,e*a),k.drawImage(f["#0d3702"],c*a,e*a)):"#d9a066"==b?k.drawImage(f["#d9a066"],c*a,e*a):"#bf0a0a"==b?k.drawImage(f["#bf0a0a"],c*a,e*a):"#99e550"==b?k.drawImage(f["#99e550"],c*a,e*a):"#8a99f6"==b?k.drawImage(f["#8a99f6"],c*a,e*a):"#6a6a6a"==b?k.drawImage(f["#6a6a6a"],c*a,e*a):"#a9a9a9"==b?(k.drawImage(g(this.l.get("grass"),8*a),c*a,e*a),k.drawImage(f["#a9a9a9"],
c*a,e*a)):"#fbf236"==b?(k.drawImage(g(this.l.get("grass"),4*a),c*a,e*a),k.drawImage(f["#fbf236"],c*a,e*a)):"#eca732"==b?(k.drawImage(g(this.l.get("grass"),4*a),c*a,e*a),k.drawImage(f["#eca732"],c*a,e*a)):"#130c40"==b&&(this.ta=new w(c*a,e*a),d[c][e]="#d9a066",k.drawImage(f["#d9a066"],c*a,e*a));this.tb=m}}class V{constructor(a,b,c,d,e){this.Ba=a;this.j=new w(0,0);this.g=c;this.w=b;this.wb=d;this.xb=e}za(a){this.j=new w(a.x,a.y)}move(a){this.j.move(a,32)}hb(a){var b=this.j.x-this.w/2,c=this.j.y-this.g/
2;return D(a,0>b?0:b,0>c?0:c,this.w,this.g)}u(a,b){let c;let d,e,f,l,m,k;var n=this.j.y-this.g/2;c=this.j.x-this.w/2;0>=c&&(c=0,this.j.x=c+this.w/2);0>=n&&(n=0,this.j.y=n+this.g/2);c+this.w>b.width&&(c=b.width-this.w,this.j.x=c+this.w/2);n+this.g>b.height&&(n=b.height-this.g,this.j.y=n+this.g/2);f=this.wb;l=this.xb;d=m=this.w;e=k=this.g;a.drawImage(b,c,n,d,e,f,l,m,k)}}class G{constructor(a){this.e=a;this.direction=a.direction;this.s=this.ha();this.ma=this.s[this.direction];this.width=this.ma.width;
this.height=this.ma.height;this.j=new w(a.j.x-a.width/2+this.width,a.j.y-a.height/2+this.height);this.Za=this.e.attributes.ra*this.width;this.ka=0;this.Ea=1;console.log("arrow created",this)}update(a){this.time=a;this.ka++;console.log(this.ka);this.ka<this.Za?this.j.move(this.direction,this.width/2):this.Ea=0}ha(){if(G.da)return G.da;var a=B.Y("arrow",this.e.v.J),b=I(a,2),c=I(a,4),d=I(a,6);this.w=a.width;this.g=a.height;return G.da=[d,d,a,a,b,b,c,d],G.da}u(a){a.drawImage(this.ma,this.j.x,this.j.y)}}
class W{constructor(){this.ra=1;this.Qa=8}}class X{constructor(a){this.v=a;this.attributes=new W(1);this.j=new w(0,0);this.destination=new w(0,0);this.$=!1;this.time=0;this.direction=4;this.s=this.ha();this.wa=this.s[4];this.T=[];this.W=0}setPosition(a){this.j=new w(a.x,a.y);this.destination=new w(a.x,a.y)}update(a){this.W=Math.min(this.W-1,0);this.T=this.T.filter(b=>0<b.Ea);[...this.T].forEach(b=>{b.update&&b.update(a)});this.time=a;0!=this.j.Ya(this.destination)?(this.$=!0,this.j.vb(this.destination,
this.attributes.Qa)):(this.$=!1,this.v.fa.za(this.j))}cb(){0<this.W||(this.W=10-this.attributes.ra,this.T.push(new G(this)))}u(a){a.drawImage(this.wa,this.j.x,this.j.y);[...this.T].forEach(b=>{b.u&&b.u(a)})}moveTo(a,b){a=this.j.jb(new w(a,b));this.wa=this.s[a];this.move(a)}move(a){a===this.direction?this.$||(console.log("moving player"),this.destination.move(a,this.width)):this.direction=a}ha(){var a=B.Y("player",this.v.J),b=B.Y("playerb",this.v.J),c=B.Y("players",this.v.J);b=[b,b,c,a,a,a,((d,e=!0)=>
{let f=q(d.width,d.height),l=f.getContext("2d");return l.save(),e?(l.scale(-1,1),l.drawImage(d,0,0,-1*d.width,d.height)):(l.scale(1,-1),l.drawImage(d,0,0,d.width,-1*d.height)),l.restore(),f})(c,!0),b];return this.width=a.width,this.height=a.height,b}}class Y extends C{constructor(a){super(a);this.pb()}pb(){this.J=2;this.keyboard={};this.X=new U(this.J);this.O=new u({color:"white",size:1});this.m=new X(this);this.m.setPosition(this.X.ta?this.X.ta:new w(224,224));this.fa=new V(this,320*this.J,320*this.J,
0,0);this.fa.za(this.m.j);this.la="robin hood"}ab(a){var b=a.height/32,c=a.width/32;a=a.getContext("2d");a.fillStyle="black";a.font="8px Arial";for(let d=0;d<c;d++)a.fillText(d,32*d,24);for(c=0;c<b;c++)a.fillText(c,0,32*c)}Va(a,b){return this.X.rb(a/this.m.width,b/this.m.height)}ga(){var a=q(this.o.K.width,this.o.K.height);let b=a.getContext("2d");b.clearRect(0,0,b.canvas.width,b.canvas.height);b.fillStyle="black";b.fillRect(0,0,b.canvas.width,b.canvas.height);var c;if(c=this.X.tb){var d=q(c.width,
c.height);c=(d.getContext("2d").drawImage(c,0,0),d)}else c=null;this.ab(c);d=c.getContext("2d");this.m.u(d);c=this.fa.hb(c);return b.drawImage(c,0,0),a}update(a){this.time=a;this.m.update(a);for(let b in this.keyboard)this.keyboard[b]&&this.ua(b)}ua(a){if(" "===a||"space"===a)console.log("fire"),this.m.cb();else if("q"===a)this.zb(this);else if(!this.m.$){var b=this.m.j.clone();"s"===a||"ArrowDown"===a?b.move(4,this.m.height):"w"===a||"ArrowUp"===a?b.move(0,this.m.height):"d"===a||"ArrowRight"===
a?b.move(2,this.m.height):"a"!==a&&"ArrowLeft"!==a||b.move(6,this.m.height);this.Va(b.x,b.y)?console.log("obstacle at",b):this.m.moveTo(b.x,b.y)}}u(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.ga(),0,0);a.fillText("Time "+this.time,20,20)}click(){}control(a){this.ua(a)}R(a){this.keyboard[a.key]=!0}M(a){this.keyboard[a.key]=!1}}class L extends C{constructor(a){super(a);
this.s={oa:h.i("steel",1),qa:h.i("water",1),Da:h.i("grass",1),m:h.i("player",1)};this.A=[{x:100,y:128},{x:100,y:160},{x:100,y:192},{x:100,y:224}];this.la="robin hood";this.F=0;this.O=new u({color:"red",size:2});this.buffer=this.na()}na(){var a=q(this.o.K.width,this.o.K.height);let b=a.getContext("2d");return b.drawImage(this.O.B("PLAY GAME",this.s.oa),this.A[0].x+20,this.A[0].y),b.drawImage(this.O.B("INSTRUCTIONS",this.s.Da),this.A[3].x+20,this.A[3].y),a}update(a){this.time=a}u(a){a.clearRect(0,0,
a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,0);a.drawImage(this.O.B("SOUND : "+(this.N&&this.N.S?"on":"off"),this.s.qa),this.A[1].x+20,this.A[1].y);a.drawImage(this.O.B(`NAME : ${this.la}`,this.s.qa),this.A[2].x+20,this.A[2].y);a.drawImage(this.s.m,this.A[this.F].x,this.A[this.F].y);a.fillText("Time "+this.time,20,20)}click(){}control(a){if("s"===a||"ArrowDown"===a)a=this.F+1,this.F=
(0>a?-a:a)%this.A.length;else if("w"===a||"ArrowUp"===a)a=this.F-1,this.F=(0>a?-a:a)%this.A.length;else if("a"===a||"ArrowLeft"===a||"d"===a||"ArrowRight"===a||"space"===a||" "===a)0==this.F?this.aa(new Y(this.o)):1==this.F?(this.N||(this.N=new R("E4E4D4E4E4D4E4G4G4A4A4E4E4D4E4E4D4E4G4G4A4A4G4G4E4E4D4E4E4D4E4A4A4",120,!1,!0,2E3)),this.N.toggle()):2==this.F?this.la=(a=prompt("name","robin"))&&0<a.length?a.substring(0,10):"robin":3==this.F&&(this.N&&this.N.stop(),this.aa(new S(this.o)))}R(){}M(a){this.control(a.key)}}
class Z extends C{constructor(a){super(a);a=h.i("brick",1);h.i("brick",2);h.i("brick",3);var b=h.i("steel",1),c=h.i("water",1),d=h.i("apple",1),e=h.i("grass",1),f=h.i("water",2),l=h.i("dirt",2),m=h.i("grass",2),k=h.i("castle",3),n=h.i("player",2),aa=h.i("bear",3),ba=h.i("deer",2),ca=h.i("rabbit",2),da=new u({color:"red",size:2}),E=new u({color:"red",size:4});J.get(1);J.get(2);J.fb();this.D={ca:E.B("JS",a),"13K":E.B("13K",b),2023:E.B("2023",c),13:E.B("13",b),Ra:da.B("TH",b),Oa:E.B("CENTURY",d),"ROBIN HOOD":E.B("ROBIN HOOD",
e)};this.Db=r(g(f,2,36),.6);this.P=r(g(l,2,36),.4);this.ob=r(g(m,12,36),.4);this.Ta=k;this.m=n;this.va=aa;this.xa=ba;this.Ja=ca;this.buffer=this.ga();this.ia=0}update(a){this.time=a;this.ia++}ga(){let a=q(600,600),b=a.getContext("2d");b.drawImage(this.Db,0,192);b.drawImage(this.P,0,224);b.drawImage(this.P,0,256);b.drawImage(this.P,0,480);b.drawImage(this.P,0,512);b.drawImage(this.P,0,544);b.drawImage(this.ob,0,288);return b.drawImage(this.D.ca,128,96),b.drawImage(this.D["13K"],128+this.D.ca.width,
96),b.drawImage(this.D[2023],160+this.D.ca.width+this.D["13K"].width,96),b.drawImage(this.D[13],128,128),b.drawImage(this.D.Ra,192,128),b.drawImage(this.D.Oa,224,128),b.drawImage(this.D["ROBIN HOOD"],128,160),a}u(a){let b=20;a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.drawImage(this.buffer,0,0);a.fillStyle="green";a.font="16px Arial";a.fillText("Time "+this.time,20,b);a.fillText("use any key to load menu ",20,b+20);a.drawImage(this.Ta,
32,256);a.drawImage(this.m,128,352)}Z(){100<this.ia&&this.aa(new L(this.o));this.ia=100}control(){this.Z()}click(){this.Z()}R(){this.Z()}M(){this.Z()}}class ea{constructor(a){return this.target=a,this.pa=[],!!a.addEventListener&&(["click","keydown","keyup","mousemove"].forEach(b=>{a.addEventListener(b,c=>{this.fireEvent({name:b,event:c})})}),!0)}sub(a){this.pa.push(a)}clear(){this.pa=[]}fireEvent(a){var b=this.pa,c;for(c in b)b[c].notify&&b[c].notify(a)}}class fa{constructor(a){this.K=a;this.V=document.querySelector(a.V);
this.canvas=Object.assign(document.createElement("canvas"),{width:a.width,height:a.height,className:"gamecanvas"});this.V.appendChild(this.canvas);this.L=new ea(document);this.Bb();this.ea=new y(a.framerate,this,!0);this.bb()}update(a){if(0==this.ea.p)if(this.time=a,this.v)try{this.v.update(a),this.v.u(this.canvas.getContext("2d"))}catch(b){console.log(b),this.ea.stop()}else this.ea.stop()}Bb(){this.v=new Z(this);this.L.sub(this.v)}Na(a){this.v=a;this.L.clear();this.L.sub(this.v)}bb(){var a=Object.assign(document.createElement("div"),
{className:"controls_container"});a.innerHTML="<table>\n        <tr><td id='q'>q</td><td id='w'>w</td><td id='e'>e</td><td class=\"padding\"></td><td id='space'>space</td> </tr>\n        <tr><td id='a'>a</td><td id='s'>s</td><td id='d'>d</td><td class=\"padding\"></td><td id='f'>f</td></tr></table>";this.V.appendChild(a);var b=((c,d=document)=>d.querySelectorAll(c))(".controls_container td");for(let c=0;c<b.length;c++)b[c].addEventListener("click",()=>{this.L.fireEvent({name:"control",event:{key:b[c].innerText}})}),
b[c].addEventListener("touchstart",()=>{this.L.fireEvent({name:"controlts",event:{key:b[c].innerText}})}),b[c].addEventListener("touchend",()=>{this.L.fireEvent({name:"controlte",event:{key:b[c].innerText}})})}}const ha={V:".canvas_container",Ib:32,Eb:1,framerate:1/15,width:576,height:576,Fb:"Assets",Hb:F("#spriteSheetMain")};class ia extends fa{constructor(a){super(a)}}document.addEventListener("DOMContentLoaded",function(){window.Ba||(window.Ba=new ia(ha))},!1)})();
