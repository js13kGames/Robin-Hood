var y="function"==typeof Object.defineProperties?Object.defineProperty:function(g,r,q){if(g==Array.prototype||g==Object.prototype)return g;g[r]=q.value;return g};function z(g){g=["object"==typeof globalThis&&globalThis,g,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var r=0;r<g.length;++r){var q=g[r];if(q&&q.Math==Math)return q}throw Error("Cannot find global object");}var K=z(this);
function P(g,r){if(r)a:{var q=K;g=g.split(".");for(var w=0;w<g.length-1;w++){var H=g[w];if(!(H in q))break a;q=q[H]}g=g[g.length-1];w=q[g];r=r(w);r!=w&&null!=r&&y(q,g,{configurable:!0,writable:!0,value:r})}}function Q(g){g=Math.trunc(g)||0;0>g&&(g+=this.length);if(!(0>g||g>=this.length))return this[g]}P("Array.prototype.at",function(g){return g?g:Q});function R(g){return g?g:Q}P("Int8Array.prototype.at",R);P("Uint8Array.prototype.at",R);P("Uint8ClampedArray.prototype.at",R);
P("Int16Array.prototype.at",R);P("Uint16Array.prototype.at",R);P("Int32Array.prototype.at",R);P("Uint32Array.prototype.at",R);P("Float32Array.prototype.at",R);P("Float64Array.prototype.at",R);P("String.prototype.at",function(g){return g?g:Q});
(()=>{function g(a,b,c=0){0==c&&(c=b);var d=p(a.width*c,a.height*b),e=d.getContext("2d");for(let f=0;f<b;f++)for(let k=0;k<c;k++)e.drawImage(a,k*a.width,f*a.height);return d}function r(a,b){let c=p(a.width,a.height),d=c.getContext("2d");return d.globalAlpha=b,d.drawImage(a,0,0),d.globalAlpha=1,c}function q(a,b,c,d){var e=p(2*a.width,2*a.height),f=e.getContext("2d");return f.drawImage(a,0,0),f.drawImage(b,a.width,0),f.drawImage(c,0,a.height),f.drawImage(d,a.width,a.height),e}function w(a,b,c,d=!1){var e=
p(b,c),f=e.getContext("2d");return d&&f.fillRect(0,0,b,c),f.drawImage(a,b/2-a.width/2,c/2-a.height/2),e}class H{constructor(a=1/60,b,c=!1){this.at=0;this.oa=null;this.Ca=a;this.t=b;c&&this.start();this.p=this.P=!1}Lb(a){if(this.oa)for(this.at+=(a-this.oa)/1E3,1<this.at&&(this.at=1);this.at>this.Ca;){this.t.update(Math.floor(a/1E3));this.at-=this.Ca;break}this.oa=a;this.P||this.Pa()}Pa(){requestAnimationFrame(a=>{this.Lb(a)})}start(){this.P=!1;this.Pa()}stop(){this.P=!0}}class I{constructor(a){this.l=
a;this.da=[]}update(a){this.time=a;[...this.da].forEach(b=>{b.update&&b.update(a)});this.da=this.da.filter(b=>!b.delete)}v(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);[...this.da].forEach(b=>{b.v&&b.v(a)})}ha(a){this.l.Oa=this.l.s;a.l=this.l;this.l.Ua(a)}Gb(a){this.l.Ua(this.l.Oa);this.l.Oa=a}notify(a){let b=a.name;a=a.event;"keydown"==b&&this.$?this.$(a):"keyup"==b&&this.U?this.U(a):"mousemove"==b&&this.Bb||("click"==b&&this.click?
this.click(a):"control"==b&&this.control?this.control(a.key):"controlts"==b&&this.fb?this.fb(a.key):"controlte"==b&&this.eb?this.eb(a.key):console.log(b))}Bb(){}U(a){this.control(a.key)}}const S=Math.PI,E=(a,b=document)=>b.querySelector(a),M=(a=1,b=0)=>b+(a-b)*Math.random(),T=(a=1,b=0)=>0|M(a,b),p=(a=0,b=0)=>{let c=document.createElement("canvas");return c.width=a,c.height=b,c},J=(a,b,c=!0)=>((d,e,f=!0)=>{var k,l,h,n;f&&0!=e%(Math.PI/4)?(h=d.width,n=d.height,k=l=Math.sqrt(h*h+n*n)):(k=d.width,l=d.height);
f=p(k,l);h=f.getContext("2d");k/=2;l/=2;return h.imageSmoothingQuality="high",h.save(),h.translate(k,l),h.rotate(e),h.drawImage(d,0,0,d.width,d.height,-d.width/2,-d.height/2,d.width,d.height),h.restore(),f})(a,(b%=8)*S/4,c),C=(a,b,c,d,e)=>{let f=p(d,e);return f.getContext("2d").drawImage(a,b,c,d,e,0,0,d,e),f},A=(a,b=1,c=null)=>{let d=a.length,e=Math.max(...a.map(h=>h.length));var f=p(e*b,d*b),k=f.getContext("2d");for(let h=0;h<d;h++)for(let n=0;n<e;n++){var l=a[h][n];c&&(l=c(l));l&&""!=l&&(k.fillStyle=
l,k.fillRect(n*b,h*b,b,b))}return f},B=(a,b)=>{for(var c=a.getContext("2d").getImageData(0,0,a.width,a.height).data,d=[],e=0;e<c.length;e+=4){var f=d,k=f.push;var l=c[e];var h=c[e+1],n=c[e+2];l=0==l+h+n+c[e+3]?null:0==l+h+n||255<l||255<h||255<n?"#000000":"#"+((l<<16)+(h<<8)+n).toString(16).padStart(6,"0");k.call(f,l)}c=[];for(e=0;e<a.height;e++)c[e]=[];f=e=0;for(k=0;k<d.length;k++)e>=a.width&&(f++,e=0),c[f][e]=d[k],b&&(c[f][e]=b(c[f][e])),e++;return c},N=(a,b,c="source-atop")=>{let d=p(a.width,a.height),
e=d.getContext("2d");e.drawImage(a,0,0);e.globalCompositeOperation=c;for(c=0;c<a.width/b.width;c++)for(let f=0;f<a.height/b.height;f++)e.drawImage(b,c*b.width,f*b.height);return d},u=[{c:0,h:0,n:"dirt",x:88,y:0,w:8,g:8},{c:0,h:0,n:"grass",x:96,y:0,w:8,g:8},{c:0,h:0,n:"water",x:104,y:0,w:8,g:8},{c:0,h:0,n:"steel",x:112,y:0,w:8,g:8},{c:0,h:0,n:"brick",x:120,y:0,w:8,g:8},{c:1,h:0,n:"magic",x:88,y:8,w:8,g:8},{c:1,h:1,n:"tree",x:96,y:8,w:8,g:8},{c:1,h:0,n:"log",x:104,y:8,w:8,g:8},{c:1,h:0,n:"apple",x:112,
y:8,w:8,g:8},{c:1,h:0,n:"lemon",x:120,y:8,w:8,g:8},{c:1,h:0,n:"sword",x:88,y:16,w:8,g:8},{c:1,h:0,n:"bow",x:96,y:16,w:8,g:8},{c:1,h:0,n:"arrow",x:104,y:16,w:8,g:8},{c:1,h:0,n:"rabbit",x:88,y:24,w:8,g:8},{c:1,h:0,n:"wolf",x:96,y:24,w:16,g:8},{c:1,h:0,n:"castle",x:128,y:0,w:32,g:32},{c:1,h:0,n:"fort",x:112,y:16,w:16,g:16},{c:1,h:0,n:"player",x:0,y:32,w:16,g:16},{c:1,h:0,n:"playerb",x:16,y:32,w:16,g:16},{c:1,h:0,n:"players",x:32,y:32,w:8,g:16},{c:1,h:0,n:"playerh",x:40,y:32,w:8,g:16},{c:1,h:0,n:"bear",
x:48,y:32,w:16,g:16},{c:1,h:0,n:"deer",x:64,y:32,w:16,g:16},{c:1,h:0,n:"house",x:80,y:32,w:16,g:16},{c:1,h:0,n:"shop",x:96,y:32,w:16,g:16},{c:1,h:0,n:"npcgirl",x:112,y:32,w:16,g:16},{c:1,h:0,n:"npcman",x:128,y:32,w:16,g:16},{c:1,h:0,n:"direction",x:128,y:32,w:16,g:16},{c:0,h:0,n:"map_house",x:0,y:48,w:16,g:16},{c:0,h:0,n:"map_villge",x:16,y:48,w:16,g:16},{c:0,h:0,n:"map_village_2",x:32,y:48,w:16,g:16},{c:0,h:0,n:"map_castle",x:48,y:48,w:16,g:16},{c:0,h:0,n:"map_forest_1",x:64,y:48,w:16,g:16},{c:0,
h:0,n:"map_forest_2",x:80,y:48,w:16,g:16},{c:0,h:0,n:"map_forest_3",x:96,y:48,w:16,g:16},{c:0,h:0,n:"map_forest_4",x:112,y:48,w:16,g:16}];class v{constructor(){this.Ta=this.vb()}vb(){if(v.va)return v.va;for(let a=0;a<u.length;a++)u[a].Qb=this.get(u[a].n),u[a].Ra=this.j(u[a].n,2),u[a].Sa=this.j(u[a].n,3);v.va=u}Ha(a){return(this.Ta?this.Ta:u).find(b=>b.n.toLowerCase()==a.toLowerCase())}get(a){a=this.Ha(a);if(!a||null==a.x)return null;if(a.P)return a.P;var b=E("#spriteSheetMain");b=C(b,a.x,a.y,a.w,
a.g);return a.c?(a=B(b,c=>"#ffffff"===c?"":c),A(a,1,c=>c)):b}j(a,b=1){var c=this.Ha(a);if(c&&2==b&&c.Ra)return c.Ra;if(c&&3==b&&c.Sa)return c.Sa;a=this.get(a);a=B(a,d=>"#ffffff"==d?"":d);return A(a,b,d=>d)}static F(a,b=1){a=this.pb(a);a=B(a,c=>"#ffffff"==c?"":c);return A(a,b,c=>c)}static pb(a){var b=u.find(d=>d.n.toLowerCase()==a.toLowerCase());if(b.P)return b.P;var c=E("#spriteSheetMain");c=C(c,b.x,b.y,b.w,b.g);return b.c?(b=B(c,d=>"#ffffff"===d?"":d),A(b,1,d=>d)):c}}class m{constructor(){}static get(a){var b=
u.find(d=>d.n.toLowerCase()==a.toLowerCase()),c=E("#spriteSheetMain");c=C(c,b.x,b.y,b.w,b.g);return b.c?(b=B(c,d=>"#ffffff"===d?"":d),A(b,1,d=>d)):c}static j(a,b=1){a=this.get(a);a=B(a,c=>"#ffffff"==c?"":c);return A(a,b,c=>c)}static getAll(a=1){var b={};for(let c in u)b[u[c].n]=1==a?m.get(u[c].n):m.j(u[c].n,a);return b}}class x{static Wa(){if(x.ia)return x.ia;var a=E("#spriteSheetMain");a=C(a,0,0,88,32);a=B(a,c=>"#ffffff"==c?"":c);var b=A(a,1,c=>c);return x.ia={canvas:b,L:a},x.ia}constructor(a={}){this.D=
a;a.size?this.size=a.size:this.size=1;var b=x.Wa();this.L=JSON.parse(JSON.stringify(b.L));this.canvas=A(this.L,this.size,c=>a.color&&"#000000"==c?a.color:c);a.nb&&(this.canvas=N(this.canvas,a.nb));this.cb=this.rb(this.canvas,8*this.size)}C(a,b){let c=p(8*this.size*a.length,8*this.size),d=c.getContext("2d");a=a.toUpperCase();for(let e in a)d.drawImage(this.cb[a[e]],this.size*e*8,0);return b&&(c=N(c,b)),c}rb(a,b){var c={};let d=0,e=0;for(let f=0;44>f;f++){let k=" 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ.:-\u00d7?\u00a9!"[f];
11<=f&&0==f%11&&(e=0,d+=b);let l=C(a,e*b,d,b,b);c[k]=l;e++}return c}}class L{constructor(a){a.size&&(this.size=a.size);a.Fa&&(this.Fa=a.Fa)}static get(a){var b=m.j("log",a);a=m.j("tree",a);var c=p(a.width,a.width+b.width),d=c.getContext("2d");return d.drawImage(a,0,0),d.drawImage(b,0,a.height),c}static ob(){var a=m.j("log",2),b=m.j("tree",2),c=p(b.width,b.height+2*a.height).getContext("2d");c.drawImage(b,0,0);c.drawImage(a,0,b.height);c.drawImage(a,0,b.height+a.height)}}class U{constructor(a,b=300,
c=!0,d=!0,e=3){this.H=a;this.Jb=b;this.loop=e;this.pitch=d;this.aa=!1;this.K=new AudioContext;this.Ma=this.H;c&&this.start()}toggle(){this.aa?this.stop():this.start()}start(){this.aa=!0;this.Na()}stop(){this.aa=!1}reset(){this.H=this.Ma}tb(a){switch(a){case "B":return 493.88;case "C":return 261.63;case "D":return 293.66;case "E":return 329.63;case "F":return 349.23;case "G":return 392}return 440}sb(a){var b=this.tb(a[0]);return 1<a.length?b*Math.pow(2,a[1]/12):b}Na(){if(this.aa)if(0===this.H.length&&
0<this.loop&&(this.H=this.Ma,this.loop--),0===this.H.length)this.stop();else{var a=this.H[0];this.pitch?(this.H[1],this.H=this.H.slice(2)):this.H=this.H.slice(1);var b=this.K.createOscillator(),c=this.K.createGain();b.connect(c);c.connect(this.K.destination);b.frequency.setValueAtTime(this.sb(a),this.K.currentTime);b.start();c.gain.setValueAtTime(0,this.K.currentTime);c.gain.exponentialRampToValueAtTime(1,this.K.currentTime+.02);setTimeout(()=>{c.gain.setValueAtTime(1,this.K.currentTime);c.gain.exponentialRampToValueAtTime(.001,
this.K.currentTime+.02);b.stop(this.K.currentTime+.02);this.Na()},60/this.Jb*1E3)}}}class V extends I{constructor(a){super(a);this.u={ra:m.j("steel",1),ta:m.j("water",1),Ja:m.j("grass",1),m:m.j("player",1),Qa:m.j("rabbit",1),Ba:m.j("deer",1),ya:m.j("bear",1),$a:m.j("apple",1),zb:m.j("lemon",1)};this.W=new x({color:"red",size:1});new x({color:"white",size:2});this.Fb=new x({color:"white",size:3});this.buffer=this.qa();this.y=0}qa(){var a=p(this.l.D.width,1200);let b=a.getContext("2d");var c=64;return b.drawImage(this.Fb.C("GAME INSTRUCTIONS",
this.u.ra),32,c),c+=80,b.fillStyle="white",b.font="16px Arial",b.fillText("you step into the legendary shoes of Robin Hood.",64,c),c+=20,b.fillText("your mission is to make the world a better place.",64,c),c+=20,b.fillText("- explore forest and hunt animals",64,c),c+=20,b.fillText("- do quests and trade with merchants",64,c),c+=20,b.fillText("- spread the wealth to the poor",64,c),c+=20,b.fillText("- improve your stats and defend the village",64,c),c+=20,c+=20,b.fillText("controls",64,c),c+=20,b.fillText("a/left : move left",
64,c),c+=20,b.fillText("d/right : move right",64,c),c+=20,b.fillText("w/up : move up",64,c),c+=20,b.fillText("s/down : move down",64,c),c+=20,b.fillText("space : shoot arrow",64,c),c+=20,b.fillText("e : interact with",64,c),c+=20,b.fillText("q : open menu",64,c),c+=20,c+=20,b.fillStyle="green",b.fillText("game play",64,c),c+=20,b.fillStyle="white",b.fillText("hunt animals in forest, rabbit, deer, bear",64,c),c+=20,b.drawImage(this.u.Qa,64,c+8),b.drawImage(this.u.Ba,72,c),b.drawImage(this.u.ya,88,
c),c+=40,b.fillText("harvest trees to get apples and lemons",64,c),b.drawImage(this.u.$a,64,c+8),b.drawImage(this.u.zb,72,c+8),c+=40,b.fillText("things to do in town",64,c),c+=20,b.fillText("- trade hunts with merchants",64,c),c+=20,b.fillText("- give goodies to villagers for free (gain morale)",64,c),c+=20,b.fillText("- take quests from villagers for extra love",64,c),c+=40,b.fillStyle="green",b.fillText("extra things to do",64,c),c+=20,b.fillStyle="red",b.fillText("deep into the jungle lies the old wizzard",
64,c),c+=20,b.fillText("find him and buy the magic bow",64,c),c+=20,b.fillStyle="white",b.fillText("more instructions can be learned in game",64,c),a}update(a){this.time=a}v(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,this.y);a.fillText("Time "+this.time,20,20)}click(){}$(){}control(a){"s"===a||"ArrowDown"===a?this.y-=32:"w"===a||"ArrowUp"===a?this.y+=32:"fire"!==
a&&"e"!==a&&"q"!==a&&"a"!==a&&"ArrowLeft"!==a&&"d"!==a&&"ArrowRight"!==a&&"space"!==a&&" "!==a||this.ha(new O(this.l))}U(a){this.control(a.key)}}class t{constructor(a,b){this.x=a;this.y=b}is(a){let b=this.y,c=a.y;return this.x==a.x&&b==c}S(a){if(!a)return 1/0;let b=this.x,c=this.y,d=a.x;a=a.y;if(b==d&&c==a)return 0;if(b==d)return Math.abs(c-a);if(c==a)return Math.abs(b-d);let e=0;return e+=Math.pow(b-d,2),e+=Math.pow(c-a,2),e=Math.sqrt(e),e}Ia(a){let b=this.x,c=this.y,d=a.x;a=a.y;return b==d&&c==
a?4:b>d?6:b<d?2:c<a?4:c>a?0:4}move(a,b){0==a?this.y-=b:4==a?this.y+=b:6==a?this.x-=b:2==a?this.x+=b:7==a?(this.y-=b,this.x-=b):1==a?(this.y-=b,this.x+=b):3==a?(this.y+=b,this.x+=b):5==a&&(this.y+=b,this.x-=b)}Cb(a,b){let c=a.x-this.x,d=a.y-this.y,e=Math.sqrt(c*c+d*d);e<b?(this.x=a.x,this.y=a.y):(this.x+=(c/e||0)*b,this.y+=(d/e||0)*b)}clone(){return new t(this.x,this.y)}v(a,b="red"){a.fillStyle=b;this.hb(a,b)}hb(a,b="green"){a.fillStyle=b;a.strokeStyle=b;a.beginPath();a.arc(this.x,this.y,3,0,2*Math.PI);
a.fill()}}const W=[{n:"tree",h:1,c:"#0d3702"},{n:"brick",h:1,c:"#bf0a0a"},{n:"dirt",h:0,c:"#d9a066"},{n:"grass",h:0,c:"#99e550"},{n:"water",h:1,c:"#8a99f6"},{n:"steel",h:1,c:"#6a6a6a"},{n:"player",h:1,c:"#130c40"}];class X{constructor(a=32){this.o=new v;this.ub(a)}Ka(a,b){return(a=Math.floor(a),b=Math.floor(b),0>a)||a>this.L.length-1||0>b||b>this.L.length-1?!0:this.yb(this.L[a][b])}yb(a){var b=W.find(c=>c.c==a);return null==b||1==b.h}ub(a=1){var b=this.o.get("map_house"),c=this.o.get("map_villge"),
d=this.o.get("map_village_2"),e=this.o.get("map_castle"),f=this.o.get("map_forest_1"),k=this.o.get("map_forest_2"),l=this.o.get("map_forest_3"),h=this.o.get("map_forest_4");b=q(b,f,k,c);k=q(f,f,f,l);c=q(f,e,c,f);d=q(h,l,d,f);d=q(b,k,c,d);this.L=d=B(d);f={"#0d3702":this.o.j("tree",2*a),"#d9a066":g(this.o.get("dirt"),2*a),"#bf0a0a":g(this.o.get("brick"),2*a),"#99e550":g(this.o.get("grass"),2*a),"#8a99f6":g(this.o.get("water"),2*a),"#6a6a6a":g(this.o.get("steel"),2*a),"#a9a9a9":this.o.j("castle",2*a),
"#fbf236":this.o.j("house",2*a),"#eca732":this.o.j("shop",2*a)};a*=16;l=p(d.length*a,d.length*a);h=l.getContext("2d");for(c=0;c<d.length;c++)for(e=0;e<d[c].length;e++)b=d[c][e],"#0d3702"==b?(h.drawImage(.5<M()?f["#d9a066"]:f["#99e550"],c*a,e*a),h.drawImage(f["#0d3702"],c*a,e*a)):"#d9a066"==b?h.drawImage(f["#d9a066"],c*a,e*a):"#bf0a0a"==b?h.drawImage(f["#bf0a0a"],c*a,e*a):"#99e550"==b?h.drawImage(f["#99e550"],c*a,e*a):"#8a99f6"==b?h.drawImage(f["#8a99f6"],c*a,e*a):"#6a6a6a"==b?h.drawImage(f["#6a6a6a"],
c*a,e*a):"#a9a9a9"==b?(h.drawImage(g(this.o.get("grass"),8*a),c*a,e*a),h.drawImage(f["#a9a9a9"],c*a,e*a)):"#fbf236"==b?(h.drawImage(g(this.o.get("grass"),4*a),c*a,e*a),h.drawImage(f["#fbf236"],c*a,e*a)):"#eca732"==b?(h.drawImage(g(this.o.get("grass"),4*a),c*a,e*a),h.drawImage(f["#eca732"],c*a,e*a)):"#130c40"==b&&(this.wa=new t(c*a,e*a),d[c][e]="#d9a066",h.drawImage(f["#d9a066"],c*a,e*a));this.Ab=l}}class Y{constructor(a,b,c,d,e){this.Ga=a;this.i=new t(0,0);this.g=c;this.w=b;this.Db=d;this.Eb=e}Ea(a){this.i=
new t(a.x,a.y)}move(a){this.i.move(a,32)}qb(a){var b=this.i.x-this.w/2,c=this.i.y-this.g/2;return C(a,0>b?0:b,0>c?0:c,this.w,this.g)}v(a,b){let c;let d,e,f,k,l,h;var n=this.i.y-this.g/2;c=this.i.x-this.w/2;0>=c&&(c=0,this.i.x=c+this.w/2);0>=n&&(n=0,this.i.y=n+this.g/2);c+this.w>b.width&&(c=b.width-this.w,this.i.x=c+this.w/2);n+this.g>b.height&&(n=b.height-this.g,this.i.y=n+this.g/2);f=this.Db;k=this.Eb;d=l=this.w;e=h=this.g;a.drawImage(b,c,n,d,e,f,k,l,h)}}class F{constructor(a){this.e=a;this.direction=
a.direction;this.u=this.Z();this.ca=this.u[this.direction];this.width=this.ca.width;this.height=this.ca.height;this.i=new t(a.i.x,a.i.y);console.log(this.width);this.speed=this.width/4;this.gb=this.e.attributes.ua*this.speed/2;this.La=0;this.O=1}update(a){this.time=a;this.La++;this.La<this.gb?(this.i.move(this.direction,this.speed),this.e.ab(this)):(console.log("dead ",this),this.O=0)}Z(){if(F.M)return F.M;var a=this.e.s.R,b=16*a,c=w(v.F("arrow",a),b,b);a=J(c,0);b=J(c,2);var d=J(c,4);c=J(c,6);this.w=
a.width;this.g=a.height;return F.M=[c,c,a,a,b,b,d,c],F.M}v(a){a.drawImage(this.ca,this.i.x,this.i.y)}}class Z{constructor(){this.ua=4;this.Xa=8}}class aa{constructor(a){this.s=a;this.attributes=new Z(1);this.i=new t(0,0);this.destination=new t(0,0);this.ga=!1;this.time=0;this.direction=4;this.u=this.Z();this.Aa=this.u[4];this.ba=[];this.Y=0}setPosition(a){this.i=new t(a.x,a.y);this.destination=new t(a.x,a.y)}update(a){this.Y=Math.max(this.Y-1,0);this.ba=this.ba.filter(b=>0<b.O);[...this.ba].forEach(b=>
{b.update&&b.update(a)});this.time=a;0!=this.i.S(this.destination)?(this.ga=!0,this.i.Cb(this.destination,this.attributes.Xa)):(this.ga=!1,this.s.la.Ea(this.i))}mb(){0<this.Y||(this.Y=20-2*this.attributes.ua,console.log(this.Y),this.ba.push(new F(this)))}ab(a){var b=a.i;this.s.za(b.x,b.y)&&(a.O=0);for(let c=0;c<this.s.G.length;c++)b=this.s.G[c],b.i.S(a.i)<this.s.A&&(--b.O,a.O--)}v(a){a.drawImage(this.Aa,this.i.x,this.i.y);[...this.ba].forEach(b=>{b.v&&b.v(a)})}Hb(a,b){this.direction=this.i.Ia(new t(a,
b))}moveTo(a,b){var c=this.i.Ia(new t(a,b));this.direction=c;0!=this.i.S(new t(a,b))&&(this.Aa=this.u[c],this.move(c))}move(a){a===this.direction?this.ga||(console.log("moving player"),this.destination.move(a,this.width)):this.direction=a}Z(){var a=v.F("player",this.s.R),b=v.F("playerb",this.s.R),c=v.F("players",this.s.R);return this.width=a.width,this.height=a.height,[b,b,c=w(c,this.width,this.height),a,a,a,((d,e=!0)=>{let f=p(d.width,d.height),k=f.getContext("2d");return k.save(),e?(k.scale(-1,
1),k.drawImage(d,0,0,-1*d.width,d.height)):(k.scale(1,-1),k.drawImage(d,0,0,d.width,-1*d.height)),k.restore(),f})(c,!0),b]}}class G{constructor(a){this.s=a;this.u=this.Z();this.ca=this.u[0];this.i=a.kb();console.log("mob created at ",this.i);this.O=1}update(a){this.time=a}v(a){a.drawImage(this.ca,this.i.x,this.i.y)}Z(){if(G.M)return G.M;var a=this.s.R,b=this.s.A,c=w(v.F("rabbit",a),b,b,!1),d=w(v.F("wolf",a),b,b,!1),e=w(v.F("deer",a),b,b,!1),f=w(v.F("bear",a),b,b,!1),k=v.F("bear",a),l=v.F("npcman",
a);a=v.F("npcgirl",a);document.body.append(c);document.body.append(d);document.body.append(e);document.body.append(f);document.body.append(k);document.body.append(k);document.body.append(l);document.body.append(a);this.g=this.w=b;return G.M=[c,d,e,f,k,k,l,a],G.M}}class ba extends I{constructor(a){super(a);this.xb()}xb(){this.R=2;this.A=16*this.R;this.keyboard={};this.N=new X(this.R);this.W=new x({color:"white",size:1});this.m=new aa(this);this.m.setPosition(this.N.wa?this.N.wa:new t(224,224));this.la=
new Y(this,this.l.D.width-96,this.l.D.height-96,0,0);this.la.Ea(this.m.i);this.pa="robin hood";this.G=[];this.Mb=this.lb();this.Ib=this.Da()}ib(a){var b=a.height/32,c=a.width/32;a=a.getContext("2d");a.fillStyle="black";a.font="8px Arial";for(let d=0;d<c;d++)a.fillText(d,32*d,24);for(c=0;c<b;c++)a.fillText(c,0,32*c)}za(a,b){var c=new t(a,b);for(let d=0;d<this.G.length;d++)if(this.G[d].i.S(c)<this.A)return!0;return this.N.Ka(a/this.A,b/this.A)}ma(){var a=p(this.l.D.width,this.l.D.height);let b=a.getContext("2d");
b.clearRect(0,0,b.canvas.width,b.canvas.height);b.fillStyle="black";b.fillRect(0,0,b.canvas.width,b.canvas.height);var c=(e=>{if(!e)return null;let f=p(e.width,e.height);return f.getContext("2d").drawImage(e,0,0),f})(this.N.Ab);this.ib(c);var d=c.getContext("2d");d.fillStyle="#70ff76a1";this.Ib.forEach(e=>{d.fillRect(e.x,e.y,this.A,this.A)});[...this.G].forEach(e=>{e.update&&e.v(d)});this.m.v(d);c=this.la.qb(c);return b.drawImage(c,0,0),a}update(a){this.time=a;10>this.G.length&&this.Za();[...this.G].forEach(b=>
{b.update&&b.update(a)});this.G=this.G.filter(b=>0<b.O);this.m.update(a);for(let b in this.keyboard)this.keyboard[b]&&this.xa(b)}Za(){if(!(10<this.G.length)){var a=new G(this);this.G.push(a)}}lb(){var a=[];for(let c=0;c<this.N.L.length;c++)for(let d=0;d<this.N.L.length;d++){var b=new t(c*this.A,d*this.A);this.N.Ka(c,d)||a.push(b)}return a}kb(){var a=this.Da(4,8);return 0<a.length?a[T(0,a.length)]:new t(this.A,this.A)}Da(a=8,b=13){var c=this.Mb;return(c=c.filter(d=>d.S(this.m.i)>this.A*a)).filter(d=>
d.S(this.m.i)<this.A*b)}xa(a){if(" "!==a&&"space"!==a||this.m.mb()," "!==a&&"e"!==a)if("q"===a)this.Gb(this);else if(!this.m.ga){var b=this.m.i.clone();"s"===a||"ArrowDown"===a?b.move(4,this.m.height):"w"===a||"ArrowUp"===a?b.move(0,this.m.height):"d"===a||"ArrowRight"===a?b.move(2,this.m.height):"a"!==a&&"ArrowLeft"!==a||b.move(6,this.m.height);this.za(b.x,b.y)?this.m.Hb(b.x,b.y):this.m.moveTo(b.x,b.y)}}v(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,
a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.ma(),0,0);a.fillText("Time "+this.time,20,20)}click(){}control(a){this.xa(a)}$(a){this.keyboard[a.key]=!0}U(a){this.keyboard[a.key]=!1}}class O extends I{constructor(a){super(a);this.u={ra:m.j("steel",1),ta:m.j("water",1),Ja:m.j("grass",1),m:m.j("player",1)};this.B=[{x:100,y:128},{x:100,y:160},{x:100,y:192},{x:100,y:224}];this.pa="robin hood";this.J=0;this.W=new x({color:"red",size:2});this.buffer=this.qa()}qa(){var a=p(this.l.D.width,
this.l.D.height);let b=a.getContext("2d");return b.drawImage(this.W.C("PLAY GAME",this.u.ra),this.B[0].x+20,this.B[0].y),b.drawImage(this.W.C("INSTRUCTIONS",this.u.Ja),this.B[3].x+20,this.B[3].y),a}update(a){this.time=a}v(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,0);a.drawImage(this.W.C("SOUND : "+(this.V&&this.V.aa?"on":"off"),this.u.ta),this.B[1].x+20,this.B[1].y);
a.drawImage(this.W.C(`NAME : ${this.pa}`,this.u.ta),this.B[2].x+20,this.B[2].y);a.drawImage(this.u.m,this.B[this.J].x,this.B[this.J].y);a.fillText("Time "+this.time,20,20)}click(){}control(a){if("s"===a||"ArrowDown"===a)a=this.J+1,this.J=(0>a?-a:a)%this.B.length;else if("w"===a||"ArrowUp"===a)a=this.J-1,this.J=(0>a?-a:a)%this.B.length;else if("a"===a||"ArrowLeft"===a||"d"===a||"ArrowRight"===a||"space"===a||" "===a)0==this.J?this.ha(new ba(this.l)):1==this.J?(this.V||(this.V=new U("E4E4D4E4E4D4E4G4G4A4A4E4E4D4E4E4D4E4G4G4A4A4G4G4E4E4D4E4E4D4E4A4A4",
120,!1,!0,2E3)),this.V.toggle()):2==this.J?this.pa=(a=prompt("name","robin"))&&0<a.length?a.substring(0,10):"robin":3==this.J&&(this.V&&this.V.stop(),this.ha(new V(this.l)))}$(){}U(a){this.control(a.key)}}class ca extends I{constructor(a){super(a);this.buffer=p(this.l.D.width,this.l.D.height);a=m.j("brick",1);var b=m.j("steel",1),c=m.j("water",1),d=m.j("apple",1),e=m.j("grass",1);m.j("water",2);var f=m.j("dirt",2),k=m.j("grass",2),l=m.j("castle",3),h=m.j("player",2),n=m.j("bear",3),da=m.j("deer",
2),ea=m.j("rabbit",2),fa=new x({color:"red",size:2}),D=new x({color:"red",size:4});L.get(1);L.get(2);L.ob();this.I={ja:D.C("JS",a),"13K":D.C("13K",b),2023:D.C("2023",c),13:D.C("13",b),Ya:fa.C("TH",b),Va:D.C("CENTURY",d),"ROBIN HOOD":D.C("ROBIN HOOD",e)};this.Nb=r(g(c,4,this.l.D.width/c.width),.6);this.X=r(g(f,2,36),.4);this.wb=r(g(k,12,36),.4);this.bb=l;this.m=h;this.ya=n;this.Ba=da;this.Qa=ea;this.buffer=this.ma();this.na=0}update(a){this.time=a;this.na++}ma(){let a=p(600,600),b=a.getContext("2d");
b.drawImage(this.Nb,0,192);b.drawImage(this.X,0,224);b.drawImage(this.X,0,256);b.drawImage(this.X,0,480);b.drawImage(this.X,0,512);b.drawImage(this.X,0,544);b.drawImage(this.wb,0,288);return b.drawImage(this.I.ja,128,96),b.drawImage(this.I["13K"],128+this.I.ja.width,96),b.drawImage(this.I[2023],160+this.I.ja.width+this.I["13K"].width,96),b.drawImage(this.I[13],128,128),b.drawImage(this.I.Ya,192,128),b.drawImage(this.I.Va,224,128),b.drawImage(this.I["ROBIN HOOD"],128,160),a}v(a){let b=20;a.clearRect(0,
0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.drawImage(this.buffer,0,0);a.fillStyle="green";a.font="16px Arial";a.fillText("Time "+this.time,20,b);b+=20;a.fillText("use any key to load menu ",20,b);a.fillText("last edit : 2023-08-20 6:00 PM ",20,b+20);a.drawImage(this.bb,32,256);a.drawImage(this.m,128,352)}fa(){100<this.na&&this.ha(new O(this.l));this.na=100}control(){this.fa()}click(){this.fa()}$(){this.fa()}U(){this.fa()}}class ha{constructor(a){return this.target=
a,this.sa=[],!!a.addEventListener&&(["click","keydown","keyup","mousemove"].forEach(b=>{a.addEventListener(b,c=>{this.fireEvent({name:b,event:c})})}),!0)}sub(a){this.sa.push(a)}clear(){this.sa=[]}fireEvent(a){var b=this.sa,c;for(c in b)b[c].notify&&b[c].notify(a)}}class ia{constructor(a){this.D=a;this.ea=document.querySelector(a.ea);this.canvas=Object.assign(document.createElement("canvas"),{width:a.width,height:a.height,className:"gamecanvas"});this.ea.appendChild(this.canvas);this.T=new ha(document);
this.Kb();this.ka=new H(a.framerate,this,!0);this.jb()}update(a){if(0==this.ka.p)if(this.time=a,this.s)try{this.s.update(a),this.s.v(this.canvas.getContext("2d"))}catch(b){console.log(b),this.ka.stop()}else this.ka.stop()}Kb(){this.s=new ca(this);this.T.sub(this.s)}Ua(a){this.s=a;this.T.clear();this.T.sub(this.s)}jb(){var a=Object.assign(document.createElement("div"),{className:"controls_container"});a.innerHTML="<table>\n        <tr><td id='q'>q</td><td id='w'>w</td><td id='e'>e</td><td class=\"padding\"></td><td id='space'>space</td> </tr>\n        <tr><td id='a'>a</td><td id='s'>s</td><td id='d'>d</td><td class=\"padding\"></td><td id='f'>f</td></tr></table>";
this.ea.appendChild(a);var b=((c,d=document)=>d.querySelectorAll(c))(".controls_container td");for(let c=0;c<b.length;c++)b[c].addEventListener("click",()=>{this.T.fireEvent({name:"control",event:{key:b[c].innerText}})}),b[c].addEventListener("touchstart",()=>{this.T.fireEvent({name:"controlts",event:{key:b[c].innerText}})}),b[c].addEventListener("touchend",()=>{this.T.fireEvent({name:"controlte",event:{key:b[c].innerText}})})}}const ja={ea:".canvas_container",Sb:32,Ob:1,framerate:1/15,width:576,
height:576,Pb:"Assets",Rb:E("#spriteSheetMain")};class ka extends ia{constructor(a){super(a)}}document.addEventListener("DOMContentLoaded",function(){window.Ga||(window.Ga=new ka(ja))},!1)})();
