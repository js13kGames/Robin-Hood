var v="function"==typeof Object.defineProperties?Object.defineProperty:function(g,k,q){if(g==Array.prototype||g==Object.prototype)return g;g[k]=q.value;return g};function z(g){g=["object"==typeof globalThis&&globalThis,g,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var k=0;k<g.length;++k){var q=g[k];if(q&&q.Math==Math)return q}throw Error("Cannot find global object");}var F=z(this);
function O(g,k){if(k)a:{var q=F;g=g.split(".");for(var w=0;w<g.length-1;w++){var C=g[w];if(!(C in q))break a;q=q[C]}g=g[g.length-1];w=q[g];k=k(w);k!=w&&null!=k&&v(q,g,{configurable:!0,writable:!0,value:k})}}function P(g){g=Math.trunc(g)||0;0>g&&(g+=this.length);if(!(0>g||g>=this.length))return this[g]}O("Array.prototype.at",function(g){return g?g:P});function Q(g){return g?g:P}O("Int8Array.prototype.at",Q);O("Uint8Array.prototype.at",Q);O("Uint8ClampedArray.prototype.at",Q);
O("Int16Array.prototype.at",Q);O("Uint16Array.prototype.at",Q);O("Int32Array.prototype.at",Q);O("Uint32Array.prototype.at",Q);O("Float32Array.prototype.at",Q);O("Float64Array.prototype.at",Q);O("String.prototype.at",function(g){return g?g:P});
(()=>{function g(a,b,c=0){0==c&&(c=b);var d=p(a.width*c,a.height*b),e=d.getContext("2d");for(let h=0;h<b;h++)for(let l=0;l<c;l++)e.drawImage(a,l*a.width,h*a.height);return d}function k(a,b){let c=p(a.width,a.height),d=c.getContext("2d");return d.globalAlpha=b,d.drawImage(a,0,0),d.globalAlpha=1,c}class q{constructor(a=1/60,b,c=!1){this.at=0;this.ca=null;this.ia=a;this.t=b;c&&this.start();this.p=this.fa=!1}Na(a){if(this.ca)for(this.at+=(a-this.ca)/1E3,1<this.at&&(this.at=1);this.at>this.ia;){this.t.update(Math.floor(a/
1E3));this.at-=this.ia;break}this.ca=a;this.fa||this.ma()}ma(){requestAnimationFrame(a=>{this.Na(a)})}start(){this.fa=!1;this.ma()}stop(){this.fa=!0}}class w{constructor(a){this.m=a;this.N=[]}update(a){this.time=a;[...this.N].forEach(b=>{b.update&&b.update(a)});this.N=this.N.filter(b=>!b.delete)}C(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);[...this.N].forEach(b=>{b.C&&b.C(a)})}T(a){a.m=this.m;this.m.Ja(a)}notify(a){let b=a.name;
a=a.event;"keydown"==b&&this.S||("keyup"==b&&this.G?this.G(a):"mousemove"==b&&this.Fa||("click"==b&&this.click?this.click(a):"control"==b&&this.control?this.control(a.key):console.log(b)))}Fa(){}G(a){this.control(a.key)}}Math.PI;const C=(a,b=document)=>b.querySelector(a),t=(a=1,b=0)=>0|((c=1,d=0)=>d+(c-d)*Math.random())(a,b),p=(a=0,b=0)=>{let c=document.createElement("canvas");return c.width=a,c.height=b,c},G=(a,b,c,d,e)=>{let h=p(d,e);return h.getContext("2d").drawImage(a,b,c,d,e,0,0,d,e),h},E=(a,
b=1,c=null)=>{let d=a.length,e=Math.max(...a.map(r=>r.length));var h=p(e*b,d*b),l=h.getContext("2d");for(let r=0;r<d;r++)for(let x=0;x<e;x++){var m=a[r][x];c&&(m=c(m));m&&""!=m&&(l.fillStyle=m,l.fillRect(x*b,r*b,b,b))}return h},H=(a,b)=>{for(var c=a.getContext("2d").getImageData(0,0,a.width,a.height).data,d=[],e=0;e<c.length;e+=4){var h=d,l=h.push;var m=c[e];var r=c[e+1],x=c[e+2];m=0==m+r+x+c[e+3]?null:0==m+r+x||255<m||255<r||255<x?"#000000":"#"+((m<<16)+(r<<8)+x).toString(16).padStart(6,"0");l.call(h,
m)}c=[];for(e=0;e<a.height;e++)c[e]=[];h=e=0;for(l=0;l<d.length;l++)e>=a.width&&(h++,e=0),c[h][e]=d[l],b&&(c[h][e]=b(c[h][e])),e++;return c},K=(a,b,c="source-atop")=>{let d=p(a.width,a.height),e=d.getContext("2d");e.drawImage(a,0,0);e.globalCompositeOperation=c;for(c=0;c<a.width/b.width;c++)for(let h=0;h<a.height/b.height;h++)e.drawImage(b,c*b.width,h*b.height);return d};class f{constructor(){}static get(a){var b=f.K.find(d=>d.n.toLowerCase()==a.toLowerCase()),c=C("#spriteSheetMain");c=G(c,b.x,b.y,
b.w,b.h);return b.c?(b=H(c,d=>"#ffffff"===d?"":d),E(b,1,d=>d)):c}static g(a,b=1){a=this.get(a);a=H(a,c=>"#ffffff"==c?"":c);return E(a,b,c=>c)}static getAll(a=1){var b={};for(let c in f.K)b[f.K[c].n]=1==a?f.get(f.K[c].n):f.g(f.K[c].n,a);return b}}f.K=[{n:"brick",x:88,y:0,w:8,h:8,c:0},{n:"grass",x:96,y:0,w:8,h:8,c:0},{n:"water",x:104,y:0,w:8,h:8,c:0},{n:"steel",x:112,y:0,w:8,h:8,c:0},{n:"dirt",x:88,y:8,w:8,h:8,c:1},{n:"tree",x:96,y:8,w:8,h:8,c:1},{n:"log",x:104,y:8,w:8,h:8,c:1},{n:"magic",x:112,y:8,
w:8,h:8,c:1},{n:"castle",x:120,y:0,w:32,h:32,c:1},{n:"apple",x:88,y:16,w:8,h:8,c:1},{n:"lemon",x:96,y:16,w:8,h:8,c:1},{n:"fort",x:104,y:16,w:16,h:16,c:1},{n:"player",x:0,y:32,w:16,h:16,c:1},{n:"playerback",x:16,y:32,w:16,h:16,c:1},{n:"playerside",x:32,y:32,w:8,h:16,c:1},{n:"playersidehand",x:40,y:32,w:8,h:16,c:1},{n:"bear",x:48,y:32,w:16,h:16,c:1},{n:"rabbit",x:64,y:40,w:8,h:8,c:1},{n:"deer",x:72,y:32,w:16,h:16,c:1},{n:"house",x:88,y:32,w:16,h:16,c:1},{n:"npcgirl",x:0,y:48,w:16,h:16,c:1},{n:"npcman",
x:16,y:48,w:16,h:16,c:1}];class u{static oa(){if(u.W)return u.W;var a=C("#spriteSheetMain");a=G(a,0,0,88,32);a=H(a,c=>"#ffffff"==c?"":c);var b=E(a,1,c=>c);return u.W={canvas:b,$:a},u.W}constructor(a={}){this.F=a;a.size?this.size=a.size:this.size=1;var b=u.oa();this.$=JSON.parse(JSON.stringify(b.$));this.canvas=E(this.$,this.size,c=>a.color&&"#000000"==c?a.color:c);a.va&&(this.canvas=K(this.canvas,a.va));this.sa=this.za(this.canvas,8*this.size)}j(a,b){let c=p(8*this.size*a.length,8*this.size),d=c.getContext("2d");
a=a.toUpperCase();for(let e in a)d.drawImage(this.sa[a[e]],this.size*e*8,0);return b&&(c=K(c,b)),c}za(a,b){var c={};let d=0,e=0;for(let h=0;44>h;h++){let l=" 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ.:-\u00d7?\u00a9!"[h];11<=h&&0==h%11&&(e=0,d+=b);let m=G(a,e*b,d,b,b);c[l]=m;e++}return c}}class I{constructor(){}static get(a){var b=f.g("log",a);a=f.g("tree",a);var c=p(a.width,a.width+b.width),d=c.getContext("2d");return d.drawImage(a,0,0),d.drawImage(b,0,a.height),c}static xa(){var a=f.g("log",2),b=f.g("tree",
2),c=p(b.width,b.height+2*a.height),d=c.getContext("2d");return d.drawImage(b,0,0),d.drawImage(a,0,b.height),d.drawImage(a,0,b.height+a.height),c}}class R{constructor(a,b=300,c=!0,d=!0,e=3){this.s=a;this.Ha=b;this.loop=e;this.pitch=d;this.L=!1;this.A=new AudioContext;this.ka=this.s;c&&this.start()}toggle(){this.L?this.stop():this.start()}start(){this.L=!0;this.la()}stop(){this.L=!1}reset(){this.s=this.ka}Ba(a){switch(a){case "B":return 493.88;case "C":return 261.63;case "D":return 293.66;case "E":return 329.63;
case "F":return 349.23;case "G":return 392}return 440}Aa(a){var b=this.Ba(a[0]);return 1<a.length?b*Math.pow(2,a[1]/12):b}la(){if(this.L)if(0===this.s.length&&0<this.loop&&(this.s=this.ka,this.loop--),0===this.s.length)this.stop();else{var a=this.s[0];this.pitch?(this.s[1],this.s=this.s.slice(2)):this.s=this.s.slice(1);var b=this.A.createOscillator(),c=this.A.createGain();b.connect(c);c.connect(this.A.destination);b.frequency.setValueAtTime(this.Aa(a),this.A.currentTime);b.start();c.gain.setValueAtTime(0,
this.A.currentTime);c.gain.exponentialRampToValueAtTime(1,this.A.currentTime+.02);setTimeout(()=>{c.gain.setValueAtTime(1,this.A.currentTime);c.gain.exponentialRampToValueAtTime(.001,this.A.currentTime+.02);b.stop(this.A.currentTime+.02);this.la()},60/this.Ha*1E3)}}}class S extends w{constructor(a){super(a);this.i={U:f.g("steel",1),V:f.g("water",1),ba:f.g("grass",1),I:f.g("player",1),ea:f.g("rabbit",1),aa:f.g("deer",1),Z:f.g("bear",1),qa:f.g("apple",1),Ea:f.g("lemon",1)};this.D=new u({color:"red",
size:1});new u({color:"white",size:2});this.Ga=new u({color:"white",size:3});this.buffer=this.M();this.y=0}M(){var a=p(this.m.F.width,1200);let b=a.getContext("2d");var c=64;return b.drawImage(this.Ga.j("GAME INSTRUCTIONS",this.i.U),32,c),c+=80,b.fillStyle="white",b.font="16px Arial",b.fillText("you step into the legendary shoes of Robin Hood.",64,c),c+=20,b.fillText("your mission is to make the world a better place.",64,c),c+=20,b.fillText("- explore forest and hunt animals",64,c),c+=20,b.fillText("- do quests and trade with merchants",
64,c),c+=20,b.fillText("- spread the wealth to the poor",64,c),c+=20,b.fillText("- improve your stats and defend the village",64,c),c+=20,c+=20,b.fillText("controls",64,c),c+=20,b.fillText("a/left : move left",64,c),c+=20,b.fillText("d/right : move right",64,c),c+=20,b.fillText("w/up : move up",64,c),c+=20,b.fillText("s/down : move down",64,c),c+=20,b.fillText("space : shoot arrow",64,c),c+=20,b.fillText("e : interact with",64,c),c+=20,b.fillText("q : open menu",64,c),c+=20,c+=20,b.fillStyle="green",
b.fillText("game play",64,c),c+=20,b.fillStyle="white",b.fillText("hunt animals in forest, rabbit, deer, bear",64,c),c+=20,b.drawImage(this.i.ea,64,c+8),b.drawImage(this.i.aa,72,c),b.drawImage(this.i.Z,88,c),c+=40,b.fillText("harvest trees to get apples and lemons",64,c),b.drawImage(this.i.qa,64,c+8),b.drawImage(this.i.Ea,72,c+8),c+=40,b.fillText("things to do in town",64,c),c+=20,b.fillText("- trade hunts with merchants",64,c),c+=20,b.fillText("- give goodies to villagers for free (gain morale)",
64,c),c+=20,b.fillText("- take quests from villagers for extra love",64,c),c+=40,b.fillStyle="green",b.fillText("extra things to do",64,c),c+=20,b.fillStyle="red",b.fillText("deep into the jungle lies the old wizzard",64,c),c+=20,b.fillText("find him and buy the magic bow",64,c),c+=20,b.fillStyle="white",b.fillText("more instructions can be learned in game",64,c),a}update(a){this.time=a}C(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);
a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,this.y);a.fillText("Time "+this.time,20,20)}click(){}S(){}control(a){"s"===a||"ArrowDown"===a?this.y-=32:"w"===a||"ArrowUp"===a?this.y+=32:"fire"!==a&&"e"!==a&&"q"!==a&&"a"!==a&&"ArrowLeft"!==a&&"d"!==a&&"ArrowRight"!==a&&"space"!==a&&" "!==a||this.T(new L(this.m))}G(a){this.control(a.key)}}class T extends w{constructor(a){super(a);this.i={U:f.g("steel",1),V:f.g("water",1),ba:f.g("grass",1),I:f.g("player",2),Da:f.g("house",6),Oa:f.g("water",
2),ta:f.g("dirt",2),Ca:f.g("grass",2)};this.ha=k(g(this.i.Oa,2,36),.9);this.B=k(g(this.i.ta,2,36),.9);this.R=k(g(this.i.Ca,2,36),.9);this.da="robin hood";this.u={x:96,y:64};this.o=0;this.D=new u({color:"white",size:1});this.buffer=this.M()}M(){var a=p(this.m.F.width,this.m.F.height);let b=a.getContext("2d");return b.drawImage(this.ha,0,0),b.drawImage(this.B,0,32),b.drawImage(this.B,0,64),b.drawImage(this.R,0,96),b.drawImage(this.R,0,128),b.drawImage(this.i.Da,0,0),b.drawImage(this.D.j("HOUSE"),14,
56),a}update(a){this.time=a}C(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,0);a.drawImage(this.i.I,this.u.x,this.u.y);a.fillText("Time "+this.time,20,20)}click(){}control(a){"s"===a||"ArrowDown"===a?this.u.y+=32:"w"===a||"ArrowUp"===a?this.u.y-=32:"d"===a||"ArrowRight"===a?this.u.x+=32:"a"!==a&&"ArrowLeft"!==a||(this.u.x-=32);console.log(this.u)}S(){}G(a){this.control(a.key)}}
class L extends w{constructor(a){super(a);this.i={U:f.g("steel",1),V:f.g("water",1),ba:f.g("grass",1),I:f.g("player",1)};this.l=[{x:100,y:128},{x:100,y:160},{x:100,y:192},{x:100,y:224}];this.da="robin hood";this.o=0;this.D=new u({color:"red",size:2});this.buffer=this.M()}M(){var a=p(this.m.F.width,this.m.F.height);let b=a.getContext("2d");return b.drawImage(this.D.j("NEW GAME",this.i.U),this.l[0].x+20,this.l[0].y),b.drawImage(this.D.j("INSTRUCTIONS",this.i.ba),this.l[3].x+20,this.l[3].y),a}update(a){this.time=
a}C(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,0);a.drawImage(this.D.j("SOUND : "+(this.H&&this.H.L?"on":"off"),this.i.V),this.l[1].x+20,this.l[1].y);a.drawImage(this.D.j(`NAME : ${this.da}`,this.i.V),this.l[2].x+20,this.l[2].y);a.drawImage(this.i.I,this.l[this.o].x,this.l[this.o].y);a.fillText("Time "+this.time,20,20)}click(){}control(a){if("s"===a||"ArrowDown"===
a)a=this.o+1,this.o=(0>a?-a:a)%this.l.length;else if("w"===a||"ArrowUp"===a)a=this.o-1,this.o=(0>a?-a:a)%this.l.length;else if("a"===a||"ArrowLeft"===a||"d"===a||"ArrowRight"===a||"space"===a||" "===a)0==this.o?this.T(new T(this.m)):1==this.o?(this.H||(this.H=new R("E4E4D4E4E4D4E4G4G4A4A4E4E4D4E4E4D4E4G4G4A4A4G4G4E4E4D4E4E4D4E4A4A4",120,!1,!0,2E3)),this.H.toggle()):2==this.o?this.da=(a=prompt("name","robin"))&&0<a.length?a.substring(0,10):"robin":3==this.o&&(this.H&&this.H.stop(),this.T(new S(this.m)))}S(){}G(a){this.control(a.key)}}
class U extends w{constructor(a){super(a);a=f.g("brick",1);f.g("brick",2);f.g("brick",3);var b=f.g("steel",1),c=f.g("water",1),d=f.g("apple",1),e=f.g("grass",1),h=f.g("water",2),l=f.g("dirt",2),m=f.g("grass",2),r=f.g("castle",3),x=f.g("player",2),V=f.g("bear",3),W=f.g("deer",2),X=f.g("rabbit",2),Y=new u({color:"red",size:2}),D=new u({color:"red",size:4});this.Ma=I.get(1);this.La=I.get(2);this.Ka=I.xa();this.v={X:D.j("JS",a),"13K":D.j("13K",b),2023:D.j("2023",c),13:D.j("13",b),pa:Y.j("TH",b),na:D.j("CENTURY",
d),"ROBIN HOOD":D.j("ROBIN HOOD",e)};this.ha=k(g(h,2,36),.6);this.B=k(g(l,2,36),.4);this.R=k(g(m,12,36),.4);this.ra=r;this.I=x;this.Z=V;this.aa=W;this.ea=X;this.ja=function(n,y,M,N,A=1){1<A&&(n=g(n,A),y=g(y,A));A=p(n.width+y.width,n.height+y.height);var B=A.getContext("2d");n=(B.drawImage(n,0,0),B.drawImage(n,n.width,y.height),B.drawImage(y,n.width,0),B.drawImage(y,0,n.height),A);y=p(n.width*N,n.height*M);A=y.getContext("2d");for(B=0;B<M;B++)for(let J=0;J<N;J++)A.drawImage(n,B*n.height,J*n.width);
return y}(m,l,40,40,2);this.ja=k(this.ja,.3);this.buffer=this.ya()}update(a){this.time=a}ya(){let a=p(600,600),b=a.getContext("2d");b.drawImage(this.ha,0,192);b.drawImage(this.B,0,224);b.drawImage(this.B,0,256);b.drawImage(this.B,0,480);b.drawImage(this.B,0,512);b.drawImage(this.B,0,544);b.drawImage(this.R,0,288);b.drawImage(this.v.X,128,96);b.drawImage(this.v["13K"],128+this.v.X.width,96);b.drawImage(this.v[2023],160+this.v.X.width+this.v["13K"].width,96);b.drawImage(this.v[13],128,128);b.drawImage(this.v.pa,
192,128);b.drawImage(this.v.na,224,128);b.drawImage(this.v["ROBIN HOOD"],128,160);for(var c=0;2>c;c++){var d=t(288,480),e=t(230,530);b.drawImage(this.Z,e,d)}for(c=0;5>c;c++)d=t(288,480),e=t(230,530),b.drawImage(this.ea,e,d);for(c=0;5>c;c++)d=t(288,480),e=t(230,530),b.drawImage(this.aa,e,d);for(c=0;15>c;c++)d=t(288,480),e=t(230,530),b.drawImage(this.Ma,e,d);for(c=0;15>c;c++)d=t(288,480),e=t(230,530),b.drawImage(this.Ka,e,d);for(c=0;15>c;c++)d=t(288,480),e=t(230,530),b.drawImage(this.La,e,d);return a}C(a){let b=
20;a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.drawImage(this.buffer,0,0);a.fillStyle="green";a.font="16px Arial";a.fillText("Time "+this.time,20,b);a.fillText("Click to start game ",20,b+20);a.drawImage(this.ra,32,256);a.drawImage(this.I,128,352)}control(){this.T(new L(this.m))}click(){}S(){}G(a){this.control(a.key)}}class Z{constructor(a){return this.target=a,this.ga=[],!!a.addEventListener&&(["click","keydown","keyup","mousemove"].forEach(b=>
{a.addEventListener(b,c=>{this.fireEvent({name:b,event:c})})}),!0)}sub(a){this.ga.push(a)}clear(){this.ga=[]}fireEvent(a){var b=this.ga,c;for(c in b)b[c].notify&&b[c].notify(a)}}class aa{constructor(a){this.F=a;this.O=document.querySelector(a.O);this.canvas=Object.assign(document.createElement("canvas"),{width:a.width,height:a.height,className:"gamecanvas"});this.O.appendChild(this.canvas);this.P=new Z(document);this.Ia();this.Y=new q(a.framerate,this,!0);this.ua()}update(a){if(0==this.Y.p)if(this.time=
a,this.J)try{this.J.update(a),this.J.C(this.canvas.getContext("2d"))}catch(b){console.log(b),this.Y.stop()}else this.Y.stop()}Ia(){this.J=new U(this);this.P.sub(this.J)}Ja(a){this.J=a;this.P.clear();this.P.sub(this.J)}ua(){var a=Object.assign(document.createElement("div"),{className:"controls_container"});a.innerHTML='<table><tr><td>q</td><td>w</td><td>e</td><td class="padding"></td><td>space</td> </tr><tr><td>a</td><td>s</td><td>d</td><td class="padding"></td> <td>e</td> </tr></table>';this.O.appendChild(a);
var b=((c,d=document)=>d.querySelectorAll(c))(".controls_container td");for(let c=0;c<b.length;c++)b[c].addEventListener("click",()=>{this.P.fireEvent({name:"control",event:{key:b[c].innerText}})})}}const ba={O:".canvas_container",Sa:32,Pa:1,framerate:1/15,width:576,height:576,Qa:"Assets",Ra:C("#spriteSheetMain")};class ca extends aa{constructor(a){super(a)}}document.addEventListener("DOMContentLoaded",function(){window.wa||(window.wa=new ca(ba))},!1)})();
