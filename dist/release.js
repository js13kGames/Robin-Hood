var x="function"==typeof Object.defineProperties?Object.defineProperty:function(h,u,r){if(h==Array.prototype||h==Object.prototype)return h;h[u]=r.value;return h};function y(h){h=["object"==typeof globalThis&&globalThis,h,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var u=0;u<h.length;++u){var r=h[u];if(r&&r.Math==Math)return r}throw Error("Cannot find global object");}var K=y(this);
function R(h,u){if(u)a:{var r=K;h=h.split(".");for(var z=0;z<h.length-1;z++){var C=h[z];if(!(C in r))break a;r=r[C]}h=h[h.length-1];z=r[h];u=u(z);u!=z&&null!=u&&x(r,h,{configurable:!0,writable:!0,value:u})}}function S(h){h=Math.trunc(h)||0;0>h&&(h+=this.length);if(!(0>h||h>=this.length))return this[h]}R("Array.prototype.at",function(h){return h?h:S});function T(h){return h?h:S}R("Int8Array.prototype.at",T);R("Uint8Array.prototype.at",T);R("Uint8ClampedArray.prototype.at",T);
R("Int16Array.prototype.at",T);R("Uint16Array.prototype.at",T);R("Int32Array.prototype.at",T);R("Uint32Array.prototype.at",T);R("Float32Array.prototype.at",T);R("Float64Array.prototype.at",T);R("String.prototype.at",function(h){return h?h:S});
(()=>{function h(a,b,c=0){0==c&&(c=b);var d=q(a.width*c,a.height*b),e=d.getContext("2d");for(let f=0;f<b;f++)for(let k=0;k<c;k++)e.drawImage(a,k*a.width,f*a.height);return d}function u(a,b){let c=q(a.width,a.height),d=c.getContext("2d");return d.globalAlpha=b,d.drawImage(a,0,0),d.globalAlpha=1,c}function r(a,b,c,d=!1){var e=q(b,c),f=e.getContext("2d");return d&&f.fillRect(0,0,b,c),f.drawImage(a,b/2-a.width/2,c/2-a.height/2),e}class z{constructor(a=1/60,b,c=!1){this.at=0;this.wa=null;this.Ka=a;this.t=
b;c&&this.start();this.p=this.Y=!1}Yb(a){if(this.wa)for(this.at+=(a-this.wa)/1E3,1<this.at&&(this.at=1);this.at>this.Ka;){this.t.update(Math.floor(a/1E3));this.at-=this.Ka;break}this.wa=a;this.Y||this.Va()}Va(){requestAnimationFrame(a=>{this.Yb(a)})}start(){this.Y=!1;this.Va()}stop(){this.Y=!0}}class C{constructor(a){this.s=a;this.ia=[]}update(a){this.time=a;[...this.ia].forEach(b=>{b.update&&b.update(a)});this.ia=this.ia.filter(b=>!b.delete)}C(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle=
"black";a.fillRect(0,0,a.canvas.width,a.canvas.height);[...this.ia].forEach(b=>{b.C&&b.C(a)})}ab(a){this.s.cc=this.s.j;a.s=this.s;this.s.Xb(a)}notify(a){let b=a.name;a=a.event;"keydown"==b&&this.da?this.da(a):"keyup"==b&&this.Z?this.Z(a):"mousemove"==b&&this.Ob||("click"==b&&this.click?this.click(a):"control"==b&&this.control?this.control(a.key):"controlts"==b&&this.ob?this.ob(a.key):"controlte"==b&&this.nb?this.nb(a.key):console.log(b))}Ob(){}Z(a){this.control(a.key)}}const U=Math.PI,G=(a,b=document)=>
b.querySelector(a),N=(a=1,b=0)=>b+(a-b)*Math.random(),L=(a=1,b=0)=>0|N(a,b),q=(a=0,b=0)=>{let c=document.createElement("canvas");return c.width=a,c.height=b,c},I=(a,b,c=!0)=>((d,e,f=!0)=>{var k,g,m,p;f&&0!=e%(Math.PI/4)?(m=d.width,p=d.height,k=g=Math.sqrt(m*m+p*p)):(k=d.width,g=d.height);f=q(k,g);m=f.getContext("2d");k/=2;g/=2;return m.imageSmoothingQuality="high",m.save(),m.translate(k,g),m.rotate(e),m.drawImage(d,0,0,d.width,d.height,-d.width/2,-d.height/2,d.width,d.height),m.restore(),f})(a,(b%=
8)*U/4,c),D=(a,b,c,d,e)=>{let f=q(d,e);return f.getContext("2d").drawImage(a,b,c,d,e,0,0,d,e),f},A=(a,b=1,c=null)=>{let d=a.length,e=Math.max(...a.map(m=>m.length));var f=q(e*b,d*b),k=f.getContext("2d");for(let m=0;m<d;m++)for(let p=0;p<e;p++){var g=a[m][p];c&&(g=c(g));g&&""!=g&&(k.fillStyle=g,k.fillRect(p*b,m*b,b,b))}return f},B=(a,b)=>{for(var c=a.getContext("2d").getImageData(0,0,a.width,a.height).data,d=[],e=0;e<c.length;e+=4){var f=d,k=f.push;var g=c[e];var m=c[e+1],p=c[e+2];g=0==g+m+p+c[e+3]?
null:0==g+m+p||255<g||255<m||255<p?"#000000":"#"+((g<<16)+(m<<8)+p).toString(16).padStart(6,"0");k.call(f,g)}c=[];for(e=0;e<a.height;e++)c[e]=[];f=e=0;for(k=0;k<d.length;k++)e>=a.width&&(f++,e=0),c[f][e]=d[k],b&&(c[f][e]=b(c[f][e])),e++;return c},O=(a,b,c="source-atop")=>{let d=q(a.width,a.height),e=d.getContext("2d");e.drawImage(a,0,0);e.globalCompositeOperation=c;for(c=0;c<a.width/b.width;c++)for(let f=0;f<a.height/b.height;f++)e.drawImage(b,c*b.width,f*b.height);return d},P=(a,b=!0)=>{let c=q(a.width,
a.height),d=c.getContext("2d");return d.save(),b?(d.scale(-1,1),d.drawImage(a,0,0,-1*a.width,a.height)):(d.scale(1,-1),d.drawImage(a,0,0,a.width,-1*a.height)),d.restore(),c},v=[{c:0,i:0,n:"dirt",x:88,y:0,w:8,h:8},{c:0,i:0,n:"grass",x:96,y:0,w:8,h:8},{c:0,i:0,n:"water",x:104,y:0,w:8,h:8},{c:0,i:0,n:"steel",x:112,y:0,w:8,h:8},{c:0,i:0,n:"brick",x:120,y:0,w:8,h:8},{c:1,i:0,n:"magic",x:88,y:8,w:8,h:8},{c:1,i:1,n:"tree",x:96,y:8,w:8,h:8},{c:1,i:0,n:"log",x:104,y:8,w:8,h:8},{c:1,i:0,n:"apple",x:112,y:8,
w:8,h:8},{c:1,i:0,n:"lemon",x:120,y:8,w:8,h:8},{c:1,i:0,n:"sword",x:88,y:16,w:8,h:8},{c:1,i:0,n:"bow",x:96,y:16,w:8,h:8},{c:1,i:0,n:"arrow",x:104,y:16,w:8,h:8},{c:1,i:0,n:"rabbit",x:88,y:24,w:8,h:8},{c:1,i:0,n:"wolf",x:96,y:24,w:16,h:8},{c:1,i:0,n:"castle",x:128,y:0,w:32,h:32},{c:1,i:0,n:"cave",x:112,y:16,w:16,h:16},{c:1,i:0,n:"player",x:0,y:32,w:16,h:16},{c:1,i:0,n:"playerb",x:16,y:32,w:16,h:16},{c:1,i:0,n:"players",x:32,y:32,w:8,h:16},{c:1,i:0,n:"playerh",x:40,y:32,w:8,h:16},{c:1,i:0,n:"bear",x:48,
y:32,w:16,h:16},{c:1,i:0,n:"deer",x:64,y:32,w:16,h:16},{c:1,i:0,n:"house",x:80,y:32,w:16,h:16},{c:1,i:0,n:"shop",x:96,y:32,w:16,h:16},{c:1,i:0,n:"npcgirl",x:112,y:32,w:16,h:16},{c:1,i:0,n:"npcman",x:128,y:32,w:16,h:16},{c:1,i:0,n:"direction",x:128,y:32,w:16,h:16},{c:0,i:0,n:"map_spawn",x:0,y:48,w:16,h:16},{c:0,i:0,n:"map_castle",x:16,y:48,w:16,h:16},{c:0,i:0,n:"map_forest_1",x:32,y:48,w:16,h:16},{c:0,i:0,n:"map_forest_2",x:48,y:48,w:16,h:16},{c:0,i:0,n:"map_forest_3",x:64,y:48,w:16,h:16},{c:0,i:0,
n:"map_forest_4",x:80,y:48,w:16,h:16}];class t{constructor(){this.$a=this.Gb()}Gb(){if(t.pa)return t.pa;for(let a=0;a<v.length;a++)v[a].dc=this.get(v[a].n),v[a].Xa=this.l(v[a].n,2),v[a].Ya=this.l(v[a].n,3);return t.pa=v,t.pa}Oa(a){return(this.$a?this.$a:v).find(b=>b.n.toLowerCase()==a.toLowerCase())}get(a){a=this.Oa(a);if(!a||null==a.x)return null;if(a.Y)return a.Y;var b=G("#spriteSheetMain");b=D(b,a.x,a.y,a.w,a.h);return a.c?(a=B(b,c=>"#ffffff"===c?"":c),A(a,1,c=>c)):b}l(a,b=1){var c=this.Oa(a);
if(c&&2==b&&c.Xa)return c.Xa;if(c&&3==b&&c.Ya)return c.Ya;a=this.get(a);a=B(a,d=>"#ffffff"==d?"":d);return A(a,b,d=>d)}static H(a,b=1){a=this.zb(a);a=B(a,c=>"#ffffff"==c?"":c);return A(a,b,c=>c)}static zb(a){var b=v.find(d=>d.n.toLowerCase()==a.toLowerCase());if(b.Y)return b.Y;var c=G("#spriteSheetMain");c=D(c,b.x,b.y,b.w,b.h);return b.c?(b=B(c,d=>"#ffffff"===d?"":d),A(b,1,d=>d)):c}}class l{constructor(){}static get(a){var b=v.find(d=>d.n.toLowerCase()==a.toLowerCase()),c=G("#spriteSheetMain");c=
D(c,b.x,b.y,b.w,b.h);return b.c?(b=B(c,d=>"#ffffff"===d?"":d),A(b,1,d=>d)):c}static l(a,b=1){a=this.get(a);a=B(a,c=>"#ffffff"==c?"":c);return A(a,b,c=>c)}static getAll(a=1){var b={};for(let c in v)b[v[c].n]=1==a?l.get(v[c].n):l.l(v[c].n,a);return b}}class w{static eb(){if(w.na)return w.na;var a=G("#spriteSheetMain");a=D(a,0,0,88,32);a=B(a,c=>"#ffffff"==c?"":c);var b=A(a,1,c=>c);return w.na={canvas:b,M:a},w.na}constructor(a={}){this.B=a;a.size?this.size=a.size:this.size=1;var b=w.eb();this.M=JSON.parse(JSON.stringify(b.M));
this.canvas=A(this.M,this.size,c=>a.color&&"#000000"==c?a.color:c);a.xb&&(this.canvas=O(this.canvas,a.xb));this.mb=this.Bb(this.canvas,8*this.size)}I(a,b){let c=q(8*this.size*a.length,8*this.size),d=c.getContext("2d");a=a.toUpperCase();for(let e in a)d.drawImage(this.mb[a[e]],this.size*e*8,0);return b&&(c=O(c,b)),c}Bb(a,b){var c={};let d=0,e=0;for(let f=0;44>f;f++){let k=" 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ.:-\u00d7?\u00a9!"[f];11<=f&&0==f%11&&(e=0,d+=b);let g=D(a,e*b,d,b,b);c[k]=g;e++}return c}}
class M{constructor(a){a.size&&(this.size=a.size);a.Ma&&(this.Ma=a.Ma)}static get(a){var b=l.l("log",a);a=l.l("tree",a);var c=q(a.width,a.width+b.width),d=c.getContext("2d");return d.drawImage(a,0,0),d.drawImage(b,0,a.height),c}static yb(){var a=l.l("log",2),b=l.l("tree",2),c=q(b.width,b.height+2*a.height).getContext("2d");c.drawImage(b,0,0);c.drawImage(a,0,b.height);c.drawImage(a,0,b.height+a.height)}}class V extends C{constructor(a){super(a);this.buffer=q(this.s.B.width,this.s.B.height);a=l.l("brick",
1);var b=l.l("steel",1),c=l.l("water",1),d=l.l("apple",1),e=l.l("grass",1);l.l("water",2);var f=l.l("dirt",2),k=l.l("grass",2),g=l.l("castle",3),m=l.l("player",2),p=l.l("bear",3),W=l.l("deer",2),X=l.l("rabbit",2),Y=new w({color:"red",size:2}),E=new w({color:"red",size:4});M.get(1);M.get(2);M.yb();this.L={oa:E.I("JS",a),"13K":E.I("13K",b),2023:E.I("2023",c),13:E.I("13",b),gb:Y.I("TH",b),cb:E.I("CENTURY",d),"ROBIN HOOD":E.I("ROBIN HOOD",e)};this.$b=u(h(c,4,this.s.B.width/8),.6);this.ba=u(h(f,2,this.s.B.width/
8),.4);this.Hb=u(h(k,12,this.s.B.width/8),.4);this.kb=g;this.m=m;this.Ia=p;this.Ja=W;this.Wa=X;this.buffer=this.sa();this.va=0}update(a){this.time=a;this.va++}sa(){let a=q(this.s.B.width,this.s.B.height),b=a.getContext("2d");b.drawImage(this.$b,0,192);b.drawImage(this.ba,0,224);b.drawImage(this.ba,0,256);b.drawImage(this.ba,0,480);b.drawImage(this.ba,0,512);b.drawImage(this.ba,0,544);b.drawImage(this.Hb,0,288);var c=128;400>this.s.B.width&&(c=16);return b.drawImage(this.L.oa,c,96),b.drawImage(this.L["13K"],
c+this.L.oa.width,96),b.drawImage(this.L[2023],c+32+this.L.oa.width+this.L["13K"].width,96),b.drawImage(this.L[13],c,128),b.drawImage(this.L.gb,c+64,128),b.drawImage(this.L.cb,c+96,128),b.drawImage(this.L["ROBIN HOOD"],c,160),a}C(a){let b=20;a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.drawImage(this.buffer,0,0);a.fillStyle="green";a.font="16px Arial";a.fillText("Time "+this.time,20,b);b+=20;a.fillText("use any key to load menu ",
20,b);a.fillText("last edit : 2023-08-20 6:00 PM ",20,b+20);a.drawImage(this.kb,32,256);a.drawImage(this.m,128,352)}la(){100<this.va&&this.s.bb();this.va=100}control(){this.la()}click(){this.la()}da(){this.la()}Z(){this.la()}}class Z{constructor(a,b=300,c=!0,d=!0,e=3){this.K=a;this.Ub=b;this.loop=e;this.pitch=d;this.fa=!1;this.O=new AudioContext;this.Sa=this.K;c&&this.start()}toggle(){this.fa?this.stop():this.start()}start(){this.fa=!0;this.Ta()}stop(){this.fa=!1}reset(){this.K=this.Sa}Db(a){switch(a){case "B":return 493.88;
case "C":return 261.63;case "D":return 293.66;case "E":return 329.63;case "F":return 349.23;case "G":return 392}return 440}Cb(a){var b=this.Db(a[0]);return 1<a.length?b*Math.pow(2,a[1]/12):b}Ta(){if(this.fa)if(0===this.K.length&&0<this.loop&&(this.K=this.Sa,this.loop--),0===this.K.length)this.stop();else{var a=this.K[0];this.pitch?(this.K[1],this.K=this.K.slice(2)):this.K=this.K.slice(1);var b=this.O.createOscillator(),c=this.O.createGain();b.connect(c);c.connect(this.O.destination);b.frequency.setValueAtTime(this.Cb(a),
this.O.currentTime);b.start();c.gain.setValueAtTime(0,this.O.currentTime);c.gain.exponentialRampToValueAtTime(1,this.O.currentTime+.02);setTimeout(()=>{c.gain.setValueAtTime(1,this.O.currentTime);c.gain.exponentialRampToValueAtTime(.001,this.O.currentTime+.02);b.stop(this.O.currentTime+.02);this.Ta()},60/this.Ub*1E3)}}}class aa extends C{constructor(a){super(a);this.v={Ba:l.l("steel",1),Da:l.l("water",1),Qa:l.l("grass",1),m:l.l("player",1),Wa:l.l("rabbit",1),Ja:l.l("deer",1),Ia:l.l("bear",1),ib:l.l("apple",
1),Lb:l.l("lemon",1)};this.aa=new w({color:"red",size:1});new w({color:"white",size:2});this.Sb=new w({color:"white",size:3});this.buffer=this.Aa();this.y=0}Aa(){var a=q(this.s.B.width,1200);let b=a.getContext("2d");var c=64;return b.drawImage(this.Sb.I("GAME INSTRUCTIONS",this.v.Ba),32,c),c+=80,b.fillStyle="white",b.font="16px Arial",b.fillText("you step into the legendary shoes of Robin Hood.",64,c),c+=20,b.fillText("your mission is to make the world a better place.",64,c),c+=20,b.fillText("- explore forest and hunt animals",
64,c),c+=20,b.fillText("- do quests and trade with merchants",64,c),c+=20,b.fillText("- spread the wealth to the poor",64,c),c+=20,b.fillText("- improve your stats and defend the village",64,c),c+=20,c+=20,b.fillText("controls",64,c),c+=20,b.fillText("a/left : move left",64,c),c+=20,b.fillText("d/right : move right",64,c),c+=20,b.fillText("w/up : move up",64,c),c+=20,b.fillText("s/down : move down",64,c),c+=20,b.fillText("space : shoot arrow",64,c),c+=20,b.fillText("e : interact with",64,c),c+=20,
b.fillText("q : open menu",64,c),c+=20,c+=20,b.fillStyle="green",b.fillText("game play",64,c),c+=20,b.fillStyle="white",b.fillText("hunt animals in forest, rabbit, deer, bear",64,c),c+=20,b.drawImage(this.v.Wa,64,c+8),b.drawImage(this.v.Ja,72,c),b.drawImage(this.v.Ia,88,c),c+=40,b.fillText("harvest trees to get apples and lemons",64,c),b.drawImage(this.v.ib,64,c+8),b.drawImage(this.v.Lb,72,c+8),c+=40,b.fillText("things to do in town",64,c),c+=20,b.fillText("- trade hunts with merchants",64,c),c+=
20,b.fillText("- give goodies to villagers for free (gain morale)",64,c),c+=20,b.fillText("- take quests from villagers for extra love",64,c),c+=40,b.fillStyle="green",b.fillText("extra things to do",64,c),c+=20,b.fillStyle="red",b.fillText("deep into the jungle lies the old wizzard",64,c),c+=20,b.fillText("find him and buy the magic bow",64,c),c+=20,b.fillStyle="white",b.fillText("more instructions can be learned in game",64,c),a}update(a){this.time=a}C(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);
a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,this.y);a.fillText("Time "+this.time,20,20)}click(){}da(){}control(a){"s"===a||"ArrowDown"===a?this.y-=32:"w"===a||"ArrowUp"===a?this.y+=32:"fire"!==a&&"e"!==a&&"q"!==a&&"a"!==a&&"ArrowLeft"!==a&&"d"!==a&&"ArrowRight"!==a&&"space"!==a&&" "!==a||this.ab(new Q(this.s))}Z(a){this.control(a.key)}}class n{constructor(a,b){this.x=a;this.y=b}is(a){let b=this.y,c=a.y;return this.x==
a.x&&b==c}T(a){if(!a)return 1/0;let b=this.x,c=this.y,d=a.x;a=a.y;if(b==d&&c==a)return 0;if(b==d)return Math.abs(c-a);if(c==a)return Math.abs(b-d);let e=0;return e+=Math.pow(b-d,2),e+=Math.pow(c-a,2),e=Math.sqrt(e),e}Pa(a){let b=this.x,c=this.y,d=a.x;a=a.y;return b==d&&c==a?4:b>d?6:b<d?2:c<a?4:c>a?0:4}move(a,b){0==a?this.y-=b:4==a?this.y+=b:6==a?this.x-=b:2==a?this.x+=b:7==a?(this.y-=b,this.x-=b):1==a?(this.y-=b,this.x+=b):3==a?(this.y+=b,this.x+=b):5==a&&(this.y+=b,this.x-=b)}Pb(a,b){let c=a.x-this.x,
d=a.y-this.y,e=Math.sqrt(c*c+d*d);e<b?(this.x=a.x,this.y=a.y):(this.x+=(c/e||0)*b,this.y+=(d/e||0)*b)}clone(){return new n(this.x,this.y)}C(a,b="red"){a.fillStyle=b;this.rb(a,b)}rb(a,b="green"){a.fillStyle=b;a.strokeStyle=b;a.beginPath();a.arc(this.x,this.y,3,0,2*Math.PI);a.fill()}}const J=[{X:15,attack:1,o:1,name:"rabbit"},{X:50,attack:4,o:5,name:"wolf"},{X:50,attack:10,o:8,name:"deer"},{X:50,attack:20,o:10,name:"bear"},{X:10,attack:15,o:10,name:"npcman"},{X:10,attack:10,o:10,name:"npcgirl"}];class F{constructor(a,
b=0,c=null){this.type=b;this.j=a;this.v=this.ca();this.u=this.v[this.type];this.g=c||a.tb();this.o=J[this.type].o;this.ea=J[this.type].o;this.ya=J[this.type].X}Eb(){var a=[],b=this.j.D;let c=this.g.x/b,d=this.g.y/b;if(this.j.V(c+1,d)&&a.push(new n),this.j.V(c+1,d)&&a.push(new n(c*b+b,d*b)),this.j.V(c-1,d)&&a.push(new n(c*b-b,d*b)),this.j.V(c,d+1)&&a.push(new n(c*b,d*b+b)),this.j.V(c,d-1)&&a.push(new n(c*b,d*b-b)),0<a.length)a=a[L(0,a.length)],this.g=new n(a.x,a.y)}update(a){this.time=a;this.ya--;
0>=this.ya&&(this.ya=J[this.type].X,this.Eb(),this.g.T(this.j.m.g)<2*this.j.D&&(this.j.m.o-=this.type+1,this.j.m.Za=10,console.log("attack player")))}ta(){var a=q(this.u.width,3),b=a.getContext("2d");b.fillStyle="green";return b.fillRect(0,0,this.o/this.ea*this.u.width,3),a}C(a){a.drawImage(this.u,this.g.x,this.g.y);a.drawImage(this.ta(),this.g.x,this.g.y)}ca(){if(F.U)return F.U;var a=this.j.S,b=this.j.D,c=r(t.H("rabbit",a),b,b,!1),d=r(t.H("wolf",a),b,b,!1),e=r(t.H("deer",a),b,b,!1),f=t.H("bear",
a),k=t.H("npcman",a);a=t.H("npcgirl",a);var g=t.H("sword",this.j.S);this.h=this.w=b;return F.U=[c,d,e,f,k,a,g],F.U}}class ba extends F{constructor(a,b=0,c=null){super(a,b,c)}C(a){super.C(a);a.drawImage(this.v[6],this.g.x+.65*this.u.width,this.g.y+.25*this.u.height)}}const ca=[{n:"tree",i:1,c:"#0d3702"},{n:"brick",i:1,c:"#bf0a0a"},{n:"dirt",i:0,c:"#d9a066"},{n:"grass",i:0,c:"#99e550"},{n:"water",i:2,c:"#8a99f6"},{n:"steel",i:1,c:"#6a6a6a"},{n:"player",i:0,c:"#130c40"},{n:"army",i:0,c:"#ff0000"},{n:"cave",
i:1,c:"#2e2b2b"},{n:"deerspawnpoint",i:0,c:"#df7126"}];class da{constructor(a,b=1){this.W=a;this.A=new t;this.Ua=[];this.lb=[];this.pb=[];this.Fb(b)}ua(a,b){return(a=Math.floor(a),b=Math.floor(b),0>a)||a>this.M.length-1||0>b||b>this.M.length-1||!this.M[a]?!0:this.Kb(this.M[b][a])}Kb(a){var b=ca.find(c=>c.c==a);return null==b?1:b.i}Fb(a=1){var b=this.A.get("map_spawn"),c=this.A.get("map_castle"),d=this.A.get("map_forest_1"),e=this.A.get("map_forest_2"),f=(this.A.get("map_forest_3"),this.A.get("map_forest_4"),
b.width),k=q(3*f,3*b.height);(g=k.getContext("2d")).drawImage(e,0,0);g.drawImage(c,f,0);g.drawImage(d,f+f,0);g.drawImage(d,0,f);g.drawImage(b,f,f);g.drawImage(d,f+f,f);g.drawImage(d,0,f+f);g.drawImage(d,f,f+f);g.drawImage(d,f+f,f+f);this.M=b=B(k);c={"#0d3702":this.A.l("tree",2*a),"#d9a066":h(this.A.get("dirt"),2*a),"#bf0a0a":h(this.A.get("brick"),2*a),"#99e550":h(this.A.get("grass"),2*a),"#8a99f6":h(this.A.get("water"),2*a),"#6a6a6a":h(this.A.get("steel"),2*a),"#a9a9a9":this.A.l("castle",2*a),"#fbf236":this.A.l("house",
2*a),"#eca732":this.A.l("shop",2*a),"#2e2b2b":this.A.l("cave",2*a)};a*=16;d=q(b.length*a,b.length*a);var g=d.getContext("2d");for(e=0;e<b.length;e++)for(f=0;f<b[e].length;f++)k=b[f][e],"#0d3702"==k?(g.drawImage(.5<N()?c["#d9a066"]:c["#99e550"],e*a,f*a),g.drawImage(c["#0d3702"],e*a,f*a)):"#d9a066"==k?g.drawImage(c["#d9a066"],e*a,f*a):"#bf0a0a"==k?g.drawImage(c["#bf0a0a"],e*a,f*a):"#99e550"==k?g.drawImage(c["#99e550"],e*a,f*a):"#df7126"==k?(g.drawImage(c["#99e550"],e*a,f*a),this.pb.push([e,f])):"#8a99f6"==
k?g.drawImage(c["#8a99f6"],e*a,f*a):"#6a6a6a"==k?g.drawImage(c["#6a6a6a"],e*a,f*a):"#a9a9a9"==k?(g.drawImage(h(this.A.get("grass"),8*a),e*a,f*a),g.drawImage(c["#a9a9a9"],e*a,f*a)):"#2e2b2b"==k?(g.drawImage(h(this.A.get("grass"),4*a),e*a,f*a),g.drawImage(c["#2e2b2b"],e*a,f*a),this.lb.push([e,f])):"#fbf236"==k?(g.drawImage(h(this.A.get("grass"),4*a),e*a,f*a),g.drawImage(c["#fbf236"],e*a,f*a)):"#eca732"==k?(g.drawImage(h(this.A.get("grass"),4*a),e*a,f*a),g.drawImage(c["#eca732"],e*a,f*a)):"#130c40"==
k?(this.Ga=new n(e*a,f*a),b[e][f]="#d9a066",g.drawImage(c["#d9a066"],e*a,f*a)):"#ff0000"==k?this.Ua.push(new ba(this.W,4,new n(e*this.W.D,f*this.W.D))):console.log(k,"unclassified");this.Nb=d}}class ea{constructor(a,b,c,d,e){this.Na=a;this.g=new n(0,0);this.h=c;this.w=b;this.Qb=d;this.Rb=e}wb(a){this.g=new n(a.x,a.y)}Mb(a){this.g=a}move(a){this.g.move(a,32)}Ab(a){var b=this.g.x-this.w/2,c=this.g.y-this.h/2;return D(a,0>b?0:b,0>c?0:c,this.w,this.h)}C(a,b){let c;let d,e,f,k,g,m;var p=this.g.y-this.h/
2;c=this.g.x-this.w/2;0>=c&&(c=0,this.g.x=c+this.w/2);0>=p&&(p=0,this.g.y=p+this.h/2);c+this.w>b.width&&(c=b.width-this.w,this.g.x=c+this.w/2);p+this.h>b.height&&(p=b.height-this.h,this.g.y=p+this.h/2);f=this.Qb;k=this.Rb;d=g=this.w;e=m=this.h;a.drawImage(b,c,p,d,e,f,k,g,m)}}class fa{constructor(a){this.g=new n(a.x,a.y)}C(a){a.drawImage(this.u,this.g.x,this.g.y)}}class H extends fa{constructor(a){super(a.g);this.e=a;this.direction=a.direction;this.v=this.ca();this.u=this.v[this.direction];this.width=
this.u.width;this.height=this.u.height;this.speed=this.width/4;this.qb=this.e.attributes.Ea*this.speed/2;this.Ra=0;this.o=1}update(a){this.time=a;this.Ra++;this.Ra<this.qb?(this.g.move(this.direction,this.speed),this.e.jb(this)):this.o=0}ca(){if(H.U)return H.U;var a=this.e.j.S,b=16*a,c=r(t.H("arrow",a),b,b);a=I(c,0);b=I(c,2);var d=I(c,4);c=I(c,6);this.w=a.width;this.h=a.height;return H.U=[c,c,a,a,b,b,d,c],H.U}}class ha{constructor(){this.fb=this.Ea=8}}class ia{constructor(a){this.j=a;this.o=this.ea=
100;this.ga=0;this.attributes=new ha(1);this.g=new n(0,0);this.destination=new n(0,0);this.ma=!1;this.time=0;this.direction=4;this.v=this.ca();this.u=this.v[4];this.ha=[];this.ka=0;this.Fa=1E8}setPosition(a){this.g=new n(a.x,a.y);this.destination=new n(a.x,a.y)}update(a){this.ka=Math.max(this.ka-1,0);this.ha=this.ha.filter(b=>0<b.o);[...this.ha].forEach(b=>{b.update&&b.update(a)});this.time=a;0!=this.g.T(this.destination)?(this.ma=!0,this.g.Pb(this.destination,this.attributes.fb)):(this.ma=!1,this.j.ra.wb(this.g))}vb(){0<
this.ka||(this.ka=20-2*this.attributes.Ea,this.Fa--,this.ha.push(new H(this)))}jb(a){var b=a.g;b=this.j.R.ua(b.x/this.j.D,b.y/this.j.D);1!=b&&1!=b||2==b||(a.o=0);for(let c=0;c<this.j.F.length;c++)b=this.j.F[c],b.g.T(a.g)<this.j.D&&(b.o-=a.o,0>=b.o&&(4==b.type||5==b.type?this.ga-=b.type+1:this.ga+=b.type+1),a.o=0)}ta(){var a=q(this.u.width,3),b=a.getContext("2d");b.fillStyle="green";this.o<this.ea/2&&(b.fillStyle="orange");this.o<this.ea/2&&(b.fillStyle="red");return b.fillRect(0,0,this.o/this.ea*
this.u.width,3),a}C(a){a.drawImage(this.u,this.g.x,this.g.y);4==this.direction&&a.drawImage(this.P,this.g.x+this.u.width-this.P.width,this.g.y+this.u.height-1.5*this.P.height);6==this.direction&&a.drawImage(P(this.P),this.g.x+this.u.width-1.6*this.P.width,this.g.y+this.u.height-1.3*this.P.height);2==this.direction&&a.drawImage(this.P,this.g.x+this.u.width-1.2*this.P.width,this.g.y+this.u.height-1.3*this.P.height);[...this.ha].forEach(b=>{b.C&&b.C(a)});a.drawImage(this.ta(),this.g.x,this.g.y);0<this.Za&&
(a.fillStyle="#ff0000aa",a.fillRect(this.g.x,this.g.y,this.u.width,this.u.height),this.Za--)}Tb(a,b){this.direction=a=this.g.Pa(new n(a,b));this.u=this.v[a]}moveTo(a,b){var c=this.g.Pa(new n(a,b));this.direction=c;0!=this.g.T(new n(a,b))&&(this.u=this.v[c],this.move(c))}move(a){a===this.direction?this.ma||(console.log("moving player"),this.destination.move(a,this.width)):this.direction=a}ca(){this.P=t.H("bow",this.j.S);var a=t.H("player",this.j.S),b=t.H("playerb",this.j.S),c=t.H("players",this.j.S);
return this.width=a.width,this.height=a.height,[b,b,c=r(c,this.width,this.height),a,a,a,P(c,!0),b]}}class ja extends C{constructor(a){super(a);this.Jb()}Jb(){this.S=2;this.D=16*this.S;this.keyboard={};this.R=new da(this,this.S);this.aa=new w({color:"white",size:1});this.m=new ia(this);this.m.setPosition(this.R.Ga?this.R.Ga:new n(224,224));this.ra=new ea(this,this.s.B.width,this.s.B.height,0,0);this.ra.Mb(this.m.g);this.za="robin hood";this.F=[...this.R.Ua];this.Zb=this.ub();this.La()}Ib(a,b){a=new n(a,
b);for(let c=0;c<this.F.length;c++)if(b=this.F[c],b.g.T(a)<this.D)return b;return null}V(){}V(a,b){return null!=this.Ib(a,b)||this.R.ua(a/this.D,b/this.D)}sa(){var a=q(this.s.B.width,this.s.B.height);let b=a.getContext("2d");b.clearRect(0,0,b.canvas.width,b.canvas.height);b.fillStyle="black";b.fillRect(0,0,b.canvas.width,b.canvas.height);var c=(e=>{if(!e)return null;let f=q(e.width,e.height);return f.getContext("2d").drawImage(e,0,0),f})(this.R.Nb),d=c.getContext("2d");[...this.F].forEach(e=>{e.update&&
e.C(d)});this.m.C(d);c=this.ra.Ab(c);return b.drawImage(c,0,0),a}update(a){this.time=a;100>this.F.length&&this.hb();[...this.F].forEach(b=>{b.update&&b.update(a)});this.F=this.F.filter(b=>0<b.o);this.m.update(a);for(let b in this.keyboard)this.keyboard[b]&&this.Ha(b)}hb(){if(!(100<this.F.length)){var a=new F(this,L(0,3));this.F.push(a)}}ub(){var a=[];for(let c=0;c<this.R.M.length;c++)for(let d=0;d<this.R.M.length;d++){var b=new n(c*this.D,d*this.D);this.R.ua(c,d)||a.push(b)}return a}tb(){var a=this.La(8,
25);return 0<a.length?a[L(0,a.length)]:new n(this.D,this.D)}La(a=8,b=13){var c=this.Zb;c=(c=c.filter(f=>f.T(this.m.g)>this.D*a)).filter(f=>f.T(this.m.g)<this.D*b);var d=[];for(let f in c){var e=!0;for(let k=0;k<this.F.length;k++)if(this.F[k].g.T(new n(c[f].x,c[f].y))<this.D){e=!1;break}e&&d.push(c[f])}return c}Ha(a){if(" "!==a&&"space"!==a||this.m.vb()," "!==a&&"e"!==a)if("q"===a)this.keyboard.q=!1,this.s.bb();else if(!this.m.ma){var b=this.m.g.clone(),c=!1;"s"===a||"ArrowDown"===a?(b.move(4,this.m.height),
c=!0):"w"===a||"ArrowUp"===a?(b.move(0,this.m.height),c=!0):"d"===a||"ArrowRight"===a?(b.move(2,this.m.height),c=!0):"a"!==a&&"ArrowLeft"!==a||(b.move(6,this.m.height),c=!0);c&&(this.V(b.x,b.y)?this.m.Tb(b.x,b.y):this.m.moveTo(b.x,b.y))}}C(a){var b;a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.sa(),0,0);a.fillStyle="#004b52d6";a.fillRect(0,0,a.canvas.width,32);a.fillStyle=
"#ffffff";a.fillText("LIFE "+this.m.o,15,15);a.fillText("SCORE "+this.m.ga,15,30);a.fillText("Arrows "+(1E9<(b=this.m.Fa)?parseInt(b/1E6)+"B":1E6<b?parseInt(b/1E6)+"M":1E3<b?parseInt(b/1E3)+"K":b),192,15)}click(){}control(a){this.Ha(a)}da(a){this.keyboard[a.key]=!0}Z(a){this.keyboard[a.key]=!1}}class Q extends C{constructor(a){super(a);this.v={Ba:l.l("steel",1),Da:l.l("water",1),Qa:l.l("grass",1),m:l.l("player",1)};a=100;400>this.s.B.width&&(a=32);this.G=[{x:a,y:128},{x:a,y:160},{x:a,y:192},{x:a,
y:224}];this.za="robin hood";this.N=0;this.aa=new w({color:"red",size:2});this.buffer=this.Aa()}Aa(){var a=q(this.s.B.width,this.s.B.height);let b=a.getContext("2d");return b.drawImage(this.aa.I("PLAY GAME",this.v.Ba),this.G[0].x+20,this.G[0].y),b.drawImage(this.aa.I("INSTRUCTIONS",this.v.Qa),this.G[3].x+20,this.G[3].y),a}update(a){this.time=a}C(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";
a.drawImage(this.buffer,0,0);a.drawImage(this.aa.I("SOUND : "+(this.$&&this.$.fa?"on":"off"),this.v.Da),this.G[1].x+20,this.G[1].y);a.drawImage(this.aa.I(`NAME : ${this.za}`,this.v.Da),this.G[2].x+20,this.G[2].y);a.drawImage(this.v.m,this.G[this.N].x,this.G[this.N].y);a.fillText("Time "+this.time,20,20)}click(){}control(a){if("s"===a||"ArrowDown"===a)a=this.N+1,this.N=(0>a?-a:a)%this.G.length;else if("w"===a||"ArrowUp"===a)a=this.N-1,this.N=(0>a?-a:a)%this.G.length;else if("a"===a||"ArrowLeft"===
a||"d"===a||"ArrowRight"===a||"space"===a||" "===a)0==this.N?this.s.Vb():1==this.N?(this.$||(this.$=new Z("E4E4D4E4E4D4E4G4G4A4A4E4E4D4E4E4D4E4G4G4A4A4G4G4E4E4D4E4E4D4E4A4A4",120,!1,!0,2E3)),this.$.toggle()):2==this.N?this.za=(a=prompt("name","robin"))&&0<a.length?a.substring(0,10):"robin":3==this.N&&(this.$&&this.$.stop(),this.ab(new aa(this.s)))}da(){}Z(a){this.control(a.key)}}class ka{constructor(a){return this.target=a,this.Ca=[],!!a.addEventListener&&(["click","keydown","keyup","mousemove"].forEach(b=>
{a.addEventListener(b,c=>{this.fireEvent({name:b,event:c})})}),!0)}sub(a){this.Ca.push(a)}clear(){this.Ca=[]}fireEvent(a){var b=this.Ca,c;for(c in b)b[c].notify&&b[c].notify(a)}}class la{constructor(a){this.B=a;this.ja=document.querySelector(a.ja);this.canvas=Object.assign(document.createElement("canvas"),{width:a.width,height:a.height,className:"gamecanvas"});this.ja.appendChild(this.canvas);this.J=new ka(document);this.Wb();this.qa=new z(a.framerate,this,!0);this.sb()}update(a){if(0==this.qa.p)if(this.time=
a,this.j)try{this.j.update(a),this.j.C(this.canvas.getContext("2d"))}catch(b){console.log(b),this.qa.stop()}else this.qa.stop()}Wb(){this.j=new V(this);this.J.clear();this.J.sub(this.j)}Xb(a){this.j=a;this.J.clear();this.J.sub(this.j)}bb(){this.xa?(console.log("using mainmenuscene already created"),this.j=this.xa):(this.xa=new Q(this),this.j=this.xa);this.J.clear();this.J.sub(this.j)}Vb(){this.W?(console.log("using game already created"),this.j=this.W):(this.W=new ja(this),this.j=this.W);this.J.clear();
this.J.sub(this.j)}sb(){if(!(400<this.B.width)){var a=Object.assign(document.createElement("div"),{className:"controls_container"});a.innerHTML="<table>\n        <tr><td id='q'>q</td><td id='w'>w</td><td id='e'>e</td><td class=\"padding\"></td><td id='space'>space</td> </tr>\n        <tr><td id='a'>a</td><td id='s'>s</td><td id='d'>d</td><td class=\"padding\"></td><td id='f'>f</td></tr></table>";this.ja.appendChild(a);var b=((c,d=document)=>d.querySelectorAll(c))(".controls_container td");for(let c=
0;c<b.length;c++)b[c].addEventListener("click",()=>{this.J.fireEvent({name:"control",event:{key:b[c].innerText}})}),b[c].addEventListener("touchstart",()=>{this.J.fireEvent({name:"controlts",event:{key:b[c].innerText}})}),b[c].addEventListener("touchend",()=>{this.J.fireEvent({name:"controlte",event:{key:b[c].innerText}})})}}}const ma={ja:".canvas_container",fc:32,ac:1,framerate:1/15,width:32*parseInt(window.innerWidth/32),height:576,bc:"Assets",ec:G("#spriteSheetMain")};class na extends la{constructor(a){super(a)}}
document.addEventListener("DOMContentLoaded",function(){window.Na||(window.Na=new na(ma))},!1)})();
