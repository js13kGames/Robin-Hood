var x="function"==typeof Object.defineProperties?Object.defineProperty:function(l,q,t){if(l==Array.prototype||l==Object.prototype)return l;l[q]=t.value;return l};function z(l){l=["object"==typeof globalThis&&globalThis,l,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var q=0;q<l.length;++q){var t=l[q];if(t&&t.Math==Math)return t}throw Error("Cannot find global object");}var L=z(this);
function Q(l,q){if(q)a:{var t=L;l=l.split(".");for(var r=0;r<l.length-1;r++){var B=l[r];if(!(B in t))break a;t=t[B]}l=l[l.length-1];r=t[l];q=q(r);q!=r&&null!=q&&x(t,l,{configurable:!0,writable:!0,value:q})}}function R(l){l=Math.trunc(l)||0;0>l&&(l+=this.length);if(!(0>l||l>=this.length))return this[l]}Q("Array.prototype.at",function(l){return l?l:R});function S(l){return l?l:R}Q("Int8Array.prototype.at",S);Q("Uint8Array.prototype.at",S);Q("Uint8ClampedArray.prototype.at",S);
Q("Int16Array.prototype.at",S);Q("Uint16Array.prototype.at",S);Q("Int32Array.prototype.at",S);Q("Uint32Array.prototype.at",S);Q("Float32Array.prototype.at",S);Q("Float64Array.prototype.at",S);Q("String.prototype.at",function(l){return l?l:R});
(()=>{function l(a,b,c="source-atop"){let d=p(a.width,a.height),e=d.getContext("2d");return e.drawImage(a,0,0),e.globalCompositeOperation=c,e.fillStyle=b,e.fillRect(0,0,d.width,d.height),d}function q(a,b){let c=p(a.width+b.width,a.height+b.height),d=c.getContext("2d");return d.drawImage(a,0,0),d.drawImage(a,a.width,b.height),d.drawImage(b,a.width,0),d.drawImage(b,0,a.height),c}function t(a,b,c=0){0==c&&(c=b);var d=p(a.width*c,a.height*b),e=d.getContext("2d");for(let f=0;f<b;f++)for(let k=0;k<c;k++)e.drawImage(a,
k*a.width,f*a.height);return d}function r(a,b){let c=p(a.width,a.height),d=c.getContext("2d");return d.globalAlpha=b,d.drawImage(a,0,0),d.globalAlpha=1,c}function B(a,b,c,d=!1){var e=p(b,c),f=e.getContext("2d");return d&&f.fillRect(0,0,b,c),f.drawImage(a,b/2-a.width/2,c/2-a.height/2),e}class T{constructor(a=1/60,b,c=!1){this.at=0;this.Ca=null;this.Oa=a;this.t=b;c&&this.start();this.p=this.$=!1}Ub(a){if(this.Ca)for(this.at+=(a-this.Ca)/1E3,1<this.at&&(this.at=1);this.at>this.Oa;){this.t.update(Math.floor(a/
1E3));this.at-=this.Oa;break}this.Ca=a;this.$||this.$a()}$a(){requestAnimationFrame(a=>{this.Ub(a)})}start(){this.$=!1;this.$a()}stop(){this.$=!0}}class M{constructor(a){this.i=a;this.ma=[]}update(a){this.time=a;[...this.ma].forEach(b=>{b.update&&b.update(a)});this.ma=this.ma.filter(b=>!b.delete)}B(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);[...this.ma].forEach(b=>{b.B&&b.B(a)})}notify(a){let b=a.name;a=a.event;"keydown"==
b&&this.ra?this.ra(a):"keyup"==b&&this.da?this.da(a):"mousemove"==b&&this.Kb||("click"==b&&this.click?this.click(a):"control"==b&&this.control?this.control(a.key):"controlts"==b&&this.lb?this.lb(a.key):"controlte"==b&&this.kb?this.kb(a.key):console.log(b))}Kb(){}da(a){this.control(a.key)}}const U=Math.PI,H=(a,b=document)=>b.querySelector(a),O=(a=1,b=0)=>b+(a-b)*Math.random(),N=(a=1,b=0)=>0|O(a,b),p=(a=0,b=0)=>{let c=document.createElement("canvas");return c.width=a,c.height=b,c},J=(a,b,c=!0)=>((d,
e,f=!0)=>{var k,h,g,m;f&&0!=e%(Math.PI/4)?(g=d.width,m=d.height,k=h=Math.sqrt(g*g+m*m)):(k=d.width,h=d.height);f=p(k,h);g=f.getContext("2d");k/=2;h/=2;return g.imageSmoothingQuality="high",g.save(),g.translate(k,h),g.rotate(e),g.drawImage(d,0,0,d.width,d.height,-d.width/2,-d.height/2,d.width,d.height),g.restore(),f})(a,(b%=8)*U/4,c),D=(a,b,c,d,e)=>{let f=p(d,e);return f.getContext("2d").drawImage(a,b,c,d,e,0,0,d,e),f},A=(a,b=1,c=null)=>{let d=a.length,e=Math.max(...a.map(g=>g.length));var f=p(e*b,
d*b),k=f.getContext("2d");for(let g=0;g<d;g++)for(let m=0;m<e;m++){var h=a[g][m];c&&(h=c(h));h&&""!=h&&(k.fillStyle=h,k.fillRect(m*b,g*b,b,b))}return f},C=(a,b)=>{for(var c=a.getContext("2d").getImageData(0,0,a.width,a.height).data,d=[],e=0;e<c.length;e+=4){var f=d,k=f.push;var h=c[e];var g=c[e+1],m=c[e+2];h=0==h+g+m+c[e+3]?null:0==h+g+m||255<h||255<g||255<m?"#000000":"#"+((h<<16)+(g<<8)+m).toString(16).padStart(6,"0");k.call(f,h)}c=[];for(e=0;e<a.height;e++)c[e]=[];f=e=0;for(k=0;k<d.length;k++)e>=
a.width&&(f++,e=0),c[f][e]=d[k],b&&(c[f][e]=b(c[f][e])),e++;return c},v=(a,b,c="source-atop")=>{let d=p(a.width,a.height),e=d.getContext("2d");e.drawImage(a,0,0);e.globalCompositeOperation=c;for(c=0;c<a.width/b.width;c++)for(let f=0;f<a.height/b.height;f++)e.drawImage(b,c*b.width,f*b.height);return d},P=(a,b=!0)=>{let c=p(a.width,a.height),d=c.getContext("2d");return d.save(),b?(d.scale(-1,1),d.drawImage(a,0,0,-1*a.width,a.height)):(d.scale(1,-1),d.drawImage(a,0,0,a.width,-1*a.height)),d.restore(),
c},E=a=>{var b=p(a[0].width,a[0].height),c=b.getContext("2d");for(let d in a)c.drawImage(a[d],0,0);return b},y=[{c:0,l:0,n:"dirt",x:0,y:0,w:8,j:8},{c:0,l:0,n:"grass",x:1,y:0,w:8,j:8},{c:0,l:0,n:"water",x:2,y:0,w:8,j:8},{c:0,l:0,n:"steel",x:3,y:0,w:8,j:8},{c:0,l:0,n:"brick",x:4,y:0,w:8,j:8},{c:1,l:0,n:"sword",x:0,y:1,w:8,j:8},{c:1,l:0,n:"bow",x:1,y:1,w:8,j:8},{c:1,l:0,n:"arrow",x:2,y:1,w:8,j:8},{c:1,l:0,n:"magic",x:3,y:1,w:8,j:8},{c:1,l:1,n:"tree",x:4,y:1,w:8,j:8},{c:1,l:0,n:"coin",x:0,y:2,w:8,j:8},
{c:1,l:0,n:"apple",x:1,y:2,w:8,j:8},{c:1,l:0,n:"lemon",x:2,y:2,w:8,j:8},{c:1,l:0,n:"rabbit",x:0,y:3,w:8,j:8},{c:1,l:0,n:"wolf",x:1,y:3,w:16,j:8},{c:1,l:0,n:"castle",x:9,y:0,w:32,j:32},{c:1,l:0,n:"cave",x:3,y:2,w:16,j:16},{c:1,l:0,n:"player",x:0,y:4,w:16,j:16},{c:1,l:0,n:"playerb",x:2,y:4,w:16,j:16},{c:1,l:0,n:"players",x:4,y:4,w:8,j:16},{c:1,l:0,n:"playerh",x:5,y:4,w:8,j:16},{c:1,l:0,n:"wizzard",x:6,y:4,w:8,j:16},{c:1,l:0,n:"bear",x:7,y:4,w:16,j:16},{c:1,l:0,n:"deer",x:9,y:4,w:16,j:16},{c:1,l:0,n:"house",
x:5,y:0,w:16,j:16},{c:1,l:0,n:"shop",x:5,y:2,w:16,j:16},{c:1,l:0,n:"npcman",x:7,y:0,w:16,j:16},{c:1,l:0,n:"npcgirl",x:7,y:2,w:16,j:16},{c:1,l:0,n:"direction",x:11,y:4,w:16,j:16},{c:0,l:0,n:"map_spawn",x:0,y:6,w:16,j:16},{c:0,l:0,n:"map_castle",x:2,y:6,w:16,j:16},{c:0,l:0,n:"map_forest_1",x:4,y:6,w:16,j:16},{c:0,l:0,n:"map_forest_2",x:6,y:6,w:16,j:16},{c:0,l:0,n:"map_forest_3",x:8,y:6,w:16,j:16},{c:0,l:0,n:"map_forest_4",x:10,y:6,w:16,j:16}];class u{constructor(){this.m=this.Eb()}Eb(){if(u.sa)return u.sa;
for(let a=0;a<y.length;a++)y[a].Zb=this.get(y[a].n),y[a].ab=this.u(y[a].n,2),y[a].bb=this.u(y[a].n,3);return u.sa=y,u.sa}Ra(a){return(this.m?this.m:y).find(b=>b.n.toLowerCase()==a.toLowerCase())}get(a){a=this.Ra(a);if(!a||null==a.x)return null;if(a.$)return a.$;var b=H("#spriteSheetMain");b=D(b,8*a.x,8*a.y,a.w,a.j);return a.c?(a=C(b,c=>"#ffffff"===c?"":c),A(a,1,c=>c)):b}u(a,b=1){var c=this.Ra(a);if(c&&2==b&&c.ab)return c.ab;if(c&&3==b&&c.bb)return c.bb;a=this.get(a);a=C(a,d=>"#ffffff"==d?"":d);return A(a,
b,d=>d)}static I(a,b=1){a=this.vb(a);a=C(a,c=>"#ffffff"==c?"":c);return A(a,b,c=>c)}static vb(a){var b=y.find(d=>d.n.toLowerCase()==a.toLowerCase());if(b.$)return b.$;var c=H("#spriteSheetMain");c=D(c,8*b.x,8*b.y,b.w,b.j);return b.c?(b=C(c,d=>"#ffffff"===d?"":d),A(b,1,d=>d)):c}}class w{static Ja(){if(w.V)return w.V;var a=H("#spriteSheetMain");a=D(a,0,0,88,32);a=C(a,c=>"#ffffff"==c?"":c);var b=A(a,1,c=>c);return w.V={canvas:b,J:a},w.V}constructor(a={}){this.D=a;this.size=a.size?a.size:8;this.color=
a.color?a.color:"#ff00ff"}static R(a,b,c,d="Arial"){let e=p(1,1).getContext("2d");e.font=b+"px "+d;let f=p(parseInt(e.measureText(a).width||1),b+2);e=f.getContext("2d");e.font=b+"px "+d;e.fillStyle="green";e.fillText(a,0,b-2);c&&(f=v(f,c));a=p(f.width,f.height);b=a.getContext("2d");return b.fillStyle="#ffffff",b.drawImage(f,0,0),a}}class V{constructor(a,b=2){this.h=a;a=this.h.i.m.u("castle",b);b=C(a);var c=b.flat(),d=[...(new Set(c))];c={};for(f of d)for(c[f]=[],d=0;d<b.length;d++){c[f].push([]);
for(var e=0;e<b[d].length;e++)b[d][e]===f?c[f][d][e]="#000000":c[f][d][e]=null}var f=(delete c.Yb,c);var k=A(f["#6a6a6a"]),h=A(f["#c2c2c2"]);f=v(k,r(this.h.i.m.get("dirt"),.5));b=v(k,r(this.h.i.m.get("grass"),.5));c=v(k,r(this.h.i.m.get("water"),.5));d=v(k,r(this.h.i.m.get("brick"),.5));e=v(k,r(this.h.i.m.get("steel"),.5));k=v(k,r(this.h.i.m.get("magic"),.5));var g=v(h,r(this.h.i.m.get("dirt"),.2)),m=v(h,r(this.h.i.m.get("grass"),.2)),W=v(h,r(this.h.i.m.get("water"),.2)),X=v(h,r(this.h.i.m.get("brick"),
.2)),Y=v(h,r(this.h.i.m.get("steel"),.2));h=v(h,r(this.h.i.m.get("magic"),.2));this.va=E([a,g,f]);this.za=E([a,m,b]);this.la=E([a,W,c]);this.jb=E([a,X,d]);this.fb=E([a,Y,e]);this.Ua=E([a,h,k])}update(a){this.time=a}}class Z extends M{constructor(a){super(a);this.buffer=p(this.i.D.width,this.i.D.height);this.i.m=new u;var b=this.i.m.u("grass",1);a=this.i.m.u("dirt",1);var c=this.i.m.u("steel",1);b=q(a,b);a=q(c,a);this.aa=new V(this);this.s=this.i.m.u("player",2);this.ya=function(d,e,f,k,h=1){1<h&&
(d=t(d,h),e=t(e,h));d=q(d,e);e=p(d.width*k,d.height*f);h=e.getContext("2d");for(let g=0;g<f;g++)for(let m=0;m<k;m++)h.drawImage(d,g*d.height,m*d.width);return e}(b,a,this.i.canvas.width/8,this.i.canvas.height/8);this.ya=r(this.ya,.2);this.log=this.Ab();this.buffer=this.wa();this.ea=-20;this.Aa=this.zb()}Ab(){var a=p(400,200),b=a.getContext("2d"),c=this.i.m.u("grass",1),d=this.i.m.u("dirt",1),e=this.i.m.u("water",1),f=this.i.m.u("steel",1),k=q(d,c);f=q(f,f);c=q(c,e);d=q(e,d);return this.X=[w.R("13th CENTURY\u2122",
20,d,"Arial Black"),w.R("ROBIN\u27b8HOOD ",40,k,"Arial Black"),w.R("THE\u27b8OUTLAW ",28,f,"Arial Black"),w.R("\u26051370s\u2235\u2234\u2235\u2234\u2235\u2234\u2235\u2234\u2235\u2234\u2235\u2234\u22352023\u2605",15,c,"Arial Black")],b.drawImage(l(this.X[0],"white"),0,1),b.drawImage(this.X[0],1,1),b.drawImage(l(this.X[1],"red"),1,18),b.drawImage(this.X[1],0,17),b.drawImage(l(this.X[2],"white"),85,53),b.drawImage(this.X[2],85,52),b.drawImage(this.X[3],82,82),a}zb(){var a="you step into the legendary shoes of Robin Hood.;your mission is to make the world a better place.;- explore forest and hunt animals;- do quests and trade with merchants;- spread the wealth to the poor;- improve your stats and defend the village;controls;a/left : move left;d/right : move right;w/up : move up;s/down : move down;space : shoot arrow;e : interact with;q : open menu;game play;hunt animals in forest, rabbit, wolf, deer,and bear;harvest trees to get apples and lemons;things to do in town;- trade hunts with merchants;- give goodies to villagers for free (gain morale);- take quests from villagers for extra love;extra things to do;deep into the jungle lies the old wizzard;find him and buy the magic bow;more instructions can be learned in game".split(";"),
b=p(360,500);let c=b.getContext("2d");c.fillStyle="white";c.font="16px Arial";for(let d=0;d<a.length;d++)c.fillText(a[d],0,25*d+20);return b}update(a){this.time=a;this.ea+=.8}wa(){let a=p(this.i.D.width,this.i.D.height),b=a.getContext("2d");b.drawImage(this.ya,0,0);return b.drawImage(this.log,400>this.i.D.width?16:128,74),a}B(a){let b=20;a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.drawImage(this.buffer,0,0);a.fillStyle="green";
a.font="16px Arial";a.fillText("Time "+this.time,20,b);a.fillText("use any key to load menu ",20,b+20);a.drawImage(this.aa.va,16,192);a.drawImage(this.aa.za,88,192);a.drawImage(this.aa.la,160,192);a.drawImage(this.aa.jb,232,192);a.drawImage(this.aa.fb,304,192);a.drawImage(this.aa.Ua,376,192);a.drawImage(this.s,16,320);a.drawImage(D(this.Aa,0,this.ea%this.Aa.height,this.Aa.width,200),64,320)}pa(){100<this.ea&&this.i.Ga();this.ea=100}control(){this.pa()}click(){this.pa()}ra(){this.pa()}da(){this.pa()}}
class aa{constructor(a,b=300,c=!0,d=!0,e=3){this.L=a;this.Rb=b;this.loop=e;this.pitch=d;this.ha=!1;this.M=new AudioContext;this.Wa=this.L;c&&this.start()}toggle(){this.ha?this.stop():this.start()}start(){this.ha=!0;this.Ya()}stop(){this.ha=!1}reset(){this.L=this.Wa}Bb(a){switch(a){case "B":return 493.88;case "C":return 261.63;case "D":return 293.66;case "E":return 329.63;case "F":return 349.23;case "G":return 392}return 440}yb(a){var b=this.Bb(a[0]);return 1<a.length?b*Math.pow(2,a[1]/12):b}Ya(){if(this.ha)if(0===
this.L.length&&0<this.loop&&(this.L=this.Wa,this.loop--),0===this.L.length)this.stop();else{var a=this.L[0];this.pitch?(this.L[1],this.L=this.L.slice(2)):this.L=this.L.slice(1);var b=this.M.createOscillator(),c=this.M.createGain();b.connect(c);c.connect(this.M.destination);b.frequency.setValueAtTime(this.yb(a),this.M.currentTime);b.start();c.gain.setValueAtTime(0,this.M.currentTime);c.gain.exponentialRampToValueAtTime(1,this.M.currentTime+.02);setTimeout(()=>{c.gain.setValueAtTime(1,this.M.currentTime);
c.gain.exponentialRampToValueAtTime(.001,this.M.currentTime+.02);b.stop(this.M.currentTime+.02);this.Ya()},60/this.Rb*1E3)}}}class F{static Ja(){if(F.V)return F.V;var a=H("#spriteSheetMain");a=D(a,0,0,88,32);a=C(a,c=>"#ffffff"==c?"":c);var b=A(a,1,c=>c);return F.V={canvas:b,J:a},F.V}constructor(a={}){this.D=a;a.size?this.size=a.size:this.size=1;var b=F.Ja();this.J=JSON.parse(JSON.stringify(b.J));this.canvas=A(this.J,this.size,c=>a.color&&"#000000"==c?a.color:c);a.ub&&(this.canvas=v(this.canvas,a.ub));
this.xb(this.canvas,8*this.size)}xb(a,b){let c=0,d=0;for(let e=0;44>e;e++)11<=e&&0==e%11&&(d=0,c+=b),D(a,d*b,c,b,b),d++}}class n{constructor(a,b){this.x=a;this.y=b}is(a){let b=this.y,c=a.y;return this.x==a.x&&b==c}T(a){if(!a)return 1/0;let b=this.x,c=this.y,d=a.x;a=a.y;if(b==d&&c==a)return 0;if(b==d)return Math.abs(c-a);if(c==a)return Math.abs(b-d);let e=0;return e+=Math.pow(b-d,2),e+=Math.pow(c-a,2),e=Math.sqrt(e),e}Sa(a){let b=this.x,c=this.y,d=a.x;a=a.y;return b==d&&c==a?4:b>d?6:b<d?2:c<a?4:c>
a?0:4}move(a,b){0==a?this.y-=b:4==a?this.y+=b:6==a?this.x-=b:2==a?this.x+=b:7==a?(this.y-=b,this.x-=b):1==a?(this.y-=b,this.x+=b):3==a?(this.y+=b,this.x+=b):5==a&&(this.y+=b,this.x-=b)}Lb(a,b){let c=a.x-this.x,d=a.y-this.y,e=Math.sqrt(c*c+d*d);e<b?(this.x=a.x,this.y=a.y):(this.x+=(c/e||0)*b,this.y+=(d/e||0)*b)}clone(){return new n(this.x,this.y)}B(a,b="red"){a.fillStyle=b;this.ob(a,b)}ob(a,b="green"){a.fillStyle=b;a.strokeStyle=b;a.beginPath();a.arc(this.x,this.y,3,0,2*Math.PI);a.fill()}}const K=
[{Z:15,attack:1,o:1,name:"rabbit"},{Z:50,attack:4,o:5,name:"wolf"},{Z:50,attack:10,o:8,name:"deer"},{Z:50,attack:20,o:10,name:"bear"},{Z:10,attack:15,o:10,name:"npcman"},{Z:10,attack:10,o:10,name:"npcgirl"}];class G{constructor(a,b=0,c=null){this.type=b;this.h=a;this.F=this.ca();this.v=this.F[this.type];this.g=c||a.qb();this.o=K[this.type].o;this.fa=K[this.type].o;this.Ea=K[this.type].Z}Cb(){var a=[],b=this.h.A;let c=this.g.x/b,d=this.g.y/b;if(this.h.Y(c+1,d)&&a.push(new n),this.h.Y(c+1,d)&&a.push(new n(c*
b+b,d*b)),this.h.Y(c-1,d)&&a.push(new n(c*b-b,d*b)),this.h.Y(c,d+1)&&a.push(new n(c*b,d*b+b)),this.h.Y(c,d-1)&&a.push(new n(c*b,d*b-b)),0<a.length)a=a[N(0,a.length)],this.g=new n(a.x,a.y)}update(a){this.time=a;this.Ea--;0>=this.Ea&&(this.Ea=K[this.type].Z,this.Cb(),this.g.T(this.h.s.g)<2*this.h.A&&(this.h.s.o-=this.type+1,this.h.s.eb=10,console.log("attack player")))}xa(){var a=p(this.v.width,3),b=a.getContext("2d");b.fillStyle="green";return b.fillRect(0,0,this.o/this.fa*this.v.width,3),a}B(a){a.drawImage(this.v,
this.g.x,this.g.y);a.drawImage(this.xa(),this.g.x,this.g.y)}ca(){if(G.W)return G.W;var a=this.h.S,b=this.h.A,c=B(u.I("rabbit",a),b,b,!1),d=B(u.I("wolf",a),b,b,!1),e=B(u.I("deer",a),b,b,!1),f=u.I("bear",a),k=u.I("npcman",a);a=u.I("npcgirl",a);var h=u.I("sword",this.h.S);this.j=this.w=b;return G.W=[c,d,e,f,k,a,h],G.W}}class ba extends G{constructor(a,b=0,c=null){super(a,b,c)}B(a){super.B(a);a.drawImage(this.F[6],this.g.x+.65*this.v.width,this.g.y+.25*this.v.height)}}const ca=[{n:"tree",l:1,c:"#0d3702"},
{n:"brick",l:1,c:"#bf0a0a"},{n:"dirt",l:0,c:"#d9a066"},{n:"grass",l:0,c:"#99e550"},{n:"water",l:2,c:"#8a99f6"},{n:"steel",l:1,c:"#6a6a6a"},{n:"player",l:0,c:"#130c40"},{n:"army",l:0,c:"#ff0000"},{n:"cave",l:1,c:"#2e2b2b"},{n:"deerspawnpoint",l:0,c:"#df7126"},{n:"rabbitspawnpoint",l:0,c:"#d1d1d1"},{n:"wolfpawnpoint",l:0,c:"#898898"}];class da{constructor(a,b=1){this.U=a;this.C=new u;this.Za=[];this.Na=[];this.mb=[];this.Ta=[];this.cb=[];this.Db(b)}Ba(a,b){return(a=Math.floor(a),b=Math.floor(b),0>a)||
a>this.J.length-1||0>b||b>this.J.length-1||!this.J[a]?!0:this.Hb(this.J[b][a])}Hb(a){var b=ca.find(c=>c.c==a);return null==b?1:b.l}Db(a=1){var b=this.C.get("map_spawn"),c=this.C.get("map_castle"),d=this.C.get("map_forest_1"),e=this.C.get("map_forest_2"),f=(this.C.get("map_forest_3"),this.C.get("map_forest_4"),b.width),k=p(3*f,3*b.height);(g=k.getContext("2d")).drawImage(e,0,0);g.drawImage(c,f,0);g.drawImage(d,f+f,0);g.drawImage(d,0,f);g.drawImage(b,f,f);g.drawImage(d,f+f,f);g.drawImage(d,0,f+f);g.drawImage(d,
f,f+f);g.drawImage(d,f+f,f+f);this.J=b=C(k);var h={"#0d3702":this.C.u("tree",2*a),"#d9a066":t(this.C.get("dirt"),2*a),"#bf0a0a":t(this.C.get("brick"),2*a),"#99e550":t(this.C.get("grass"),2*a),"#8a99f6":t(this.C.get("water"),2*a),"#6a6a6a":t(this.C.get("steel"),2*a),"#a9a9a9":this.C.u("castle",2*a),"#fbf236":this.C.u("house",2*a),"#eca732":this.C.u("shop",2*a),"#2e2b2b":this.C.u("cave",2*a)};a*=16;c=p(b.length*a,b.length*a);var g=c.getContext("2d");for(d=0;d<b.length;d++)for(e=0;e<b[d].length;e++)f=
b[e][d],g.drawImage(.5<O()?h["#d9a066"]:h["#99e550"],d*a,e*a),"#0d3702"==f?g.drawImage(h["#0d3702"],d*a,e*a):"#d9a066"==f?g.drawImage(h["#d9a066"],d*a,e*a):"#bf0a0a"==f?g.drawImage(h["#bf0a0a"],d*a,e*a):"#99e550"==f?g.drawImage(h["#99e550"],d*a,e*a):"#df7126"==f?(g.drawImage(h["#99e550"],d*a,e*a),this.mb.push([d,e])):"#8a99f6"==f?g.drawImage(h["#8a99f6"],d*a,e*a):"#6a6a6a"==f?g.drawImage(h["#6a6a6a"],d*a,e*a):"#a9a9a9"==f?this.Ma=new n(d*a,e*a):"#2e2b2b"==f?this.Na.push(new n(d*a,e*a)):"#fbf236"==
f?this.Ta.push(new n(d*a,e*a)):"#eca732"==f?this.cb.push(new n(d*a,e*a)):"#130c40"==f?(this.Ka=new n(d*a,e*a),b[d][e]="#d9a066"):"#ff0000"==f?this.Za.push(new ba(this.U,4,new n(d*this.U.A,e*this.U.A))):"#000000"==f||"#d1d1d1"==f||"#898898"==f||console.log(f,"unclassified");g.drawImage(h["#a9a9a9"],this.Ma.x,this.Ma.y);this.Ta.forEach(m=>{g.drawImage(h["#fbf236"],m.x,m.y)});this.cb.forEach(m=>{g.drawImage(h["#eca732"],m.x,m.y)});this.Na.forEach(m=>{g.drawImage(h["#2e2b2b"],m.x,m.y)});this.Jb=c}}class ea{constructor(a,
b,c,d,e){this.Qa=a;this.g=new n(0,0);this.j=c;this.w=b;this.Mb=d;this.Nb=e}tb(a){this.g=new n(a.x,a.y)}Ib(a){this.g=a}move(a){this.g.move(a,32)}wb(a){var b=this.g.x-this.w/2,c=this.g.y-this.j/2;return D(a,0>b?0:b,0>c?0:c,this.w,this.j)}B(a,b){let c;let d,e,f,k,h,g;var m=this.g.y-this.j/2;c=this.g.x-this.w/2;0>=c&&(c=0,this.g.x=c+this.w/2);0>=m&&(m=0,this.g.y=m+this.j/2);c+this.w>b.width&&(c=b.width-this.w,this.g.x=c+this.w/2);m+this.j>b.height&&(m=b.height-this.j,this.g.y=m+this.j/2);f=this.Mb;k=
this.Nb;d=h=this.w;e=g=this.j;a.drawImage(b,c,m,d,e,f,k,h,g)}}class fa{constructor(){this.gb=this.Ha=8}}class ha{constructor(a){this.g=new n(a.x,a.y)}B(a){a.drawImage(this.v,this.g.x,this.g.y)}}class I extends ha{constructor(a){super(a.g);this.e=a;this.direction=a.direction;this.F=this.ca();this.v=this.F[this.direction];this.width=this.v.width;this.height=this.v.height;this.speed=this.width/4;this.nb=this.e.attributes.Ha*this.speed/2;this.Va=0;this.o=1}update(a){this.time=a;this.Va++;this.Va<this.nb?
(this.g.move(this.direction,this.speed),this.e.ib(this)):this.o=0}ca(){if(I.W)return I.W;var a=this.e.h.S,b=16*a,c=B(u.I("arrow",a),b,b);a=J(c,0);b=J(c,2);var d=J(c,4);c=J(c,6);this.w=a.width;this.j=a.height;return I.W=[c,c,a,a,b,b,d,c],I.W}}class ia{constructor(a){this.h=a;this.o=this.fa=100;this.ia=0;this.attributes=new fa(1);this.g=new n(0,0);this.destination=new n(0,0);this.qa=!1;this.time=0;this.direction=4;this.F=this.ca();this.v=this.F[4];this.ja=[];this.oa=0;this.Ia=1E4}setPosition(a){this.g=
new n(a.x,a.y);this.destination=new n(a.x,a.y)}update(a){this.oa=Math.max(this.oa-1,0);this.ja=this.ja.filter(b=>0<b.o);[...this.ja].forEach(b=>{b.update&&b.update(a)});this.time=a;0!=this.g.T(this.destination)?(this.qa=!0,this.g.Lb(this.destination,this.attributes.gb)):(this.qa=!1,this.h.ua.tb(this.g))}sb(){0<this.oa||(this.oa=20-2*this.attributes.Ha,this.Ia--,this.ja.push(new I(this)),this.Ob())}ib(a){var b=a.g;b=this.h.P.Ba(b.x/this.h.A,b.y/this.h.A);1!=b&&1!=b||2==b||(a.o=0,this.Xa());for(let c=
0;c<this.h.H.length;c++)b=this.h.H[c],b.g.T(a.g)<this.h.A&&(b.o-=a.o,0>=b.o&&(4==b.type||5==b.type?this.ia-=b.type+1:this.ia+=b.type+1),this.Xa(),a.o=0)}xa(){var a=p(this.v.width,3),b=a.getContext("2d");b.fillStyle="green";this.o<this.fa/2&&(b.fillStyle="orange");this.o<this.fa/2&&(b.fillStyle="red");return b.fillRect(0,0,this.o/this.fa*this.v.width,3),a}B(a){a.drawImage(this.v,this.g.x,this.g.y);4==this.direction&&a.drawImage(this.N,this.g.x+this.v.width-this.N.width,this.g.y+this.v.height-1.5*this.N.height);
6==this.direction&&a.drawImage(P(this.N),this.g.x+this.v.width-1.6*this.N.width,this.g.y+this.v.height-1.3*this.N.height);2==this.direction&&a.drawImage(this.N,this.g.x+this.v.width-1.2*this.N.width,this.g.y+this.v.height-1.3*this.N.height);[...this.ja].forEach(b=>{b.B&&b.B(a)});a.drawImage(this.xa(),this.g.x,this.g.y);0<this.eb&&(a.fillStyle="#ff0000aa",a.fillRect(this.g.x,this.g.y,this.v.width,this.v.height),this.eb--)}Pb(a,b){this.direction=a=this.g.Sa(new n(a,b));this.v=this.F[a]}moveTo(a,b){var c=
this.g.Sa(new n(a,b));this.direction=c;0!=this.g.T(new n(a,b))&&(this.v=this.F[c],this.move(c))}move(a){a===this.direction?this.qa||(console.log("moving player"),this.destination.move(a,this.width)):this.direction=a}ca(){this.N=u.I("bow",this.h.S);var a=u.I("player",this.h.S),b=u.I("playerb",this.h.S),c=u.I("players",this.h.S);return this.width=a.width,this.height=a.height,[b,b,c=B(c,this.width,this.height),a,a,a,P(c,!0),b]}Ob(){const a=new (window.AudioContext||window.webkitAudioContext),b=a.createOscillator();
b.type="sawtooth";b.frequency.setValueAtTime(500,a.currentTime);const c=a.createGain();c.gain.setValueAtTime(.2,a.currentTime);const d=a.createBiquadFilter();d.type="lowpass";d.frequency.setValueAtTime(500,a.currentTime);b.connect(c);c.connect(d);d.connect(a.destination);b.start();c.gain.exponentialRampToValueAtTime(.01,a.currentTime+.5);b.stop(a.currentTime+1)}Xa(){const a=new (window.AudioContext||window.webkitAudioContext),b=a.createOscillator();b.type="square";b.frequency.setValueAtTime(400,a.currentTime);
const c=a.createGain();c.gain.setValueAtTime(.2,a.currentTime);const d=a.createBiquadFilter();d.type="lowpass";d.frequency.setValueAtTime(400,a.currentTime);b.connect(c);c.connect(d);d.connect(a.destination);b.start();c.gain.exponentialRampToValueAtTime(.01,a.currentTime+.5);b.stop(a.currentTime+1)}}class ja extends M{constructor(a){super(a);this.Gb()}Gb(){this.S=2;this.A=16*this.S;this.keyboard={};this.P=new da(this,this.S);new F({color:"white",size:1});this.s=new ia(this);this.s.setPosition(this.P.Ka?
this.P.Ka:new n(224,224));this.ua=new ea(this,this.i.D.width,this.i.D.height,0,0);this.ua.Ib(this.s.g);this.ga="robin hood";this.H=[...this.P.Za];this.Vb=this.rb();this.Pa()}Fb(a,b){a=new n(a,b);for(let c=0;c<this.H.length;c++)if(b=this.H[c],b.g.T(a)<this.A)return b;return null}Y(){}Y(a,b){return null!=this.Fb(a,b)||this.P.Ba(a/this.A,b/this.A)}wa(){var a=p(this.i.D.width,this.i.D.height);let b=a.getContext("2d");b.clearRect(0,0,b.canvas.width,b.canvas.height);b.fillStyle="black";b.fillRect(0,0,b.canvas.width,
b.canvas.height);var c=(e=>{if(!e)return null;let f=p(e.width,e.height);return f.getContext("2d").drawImage(e,0,0),f})(this.P.Jb),d=c.getContext("2d");[...this.H].forEach(e=>{e.update&&e.B(d)});this.s.B(d);c=this.ua.wb(c);return b.drawImage(c,0,0),a}update(a){this.time=a;35>this.H.length&&this.hb();[...this.H].forEach(b=>{b.update&&b.update(a)});this.H=this.H.filter(b=>0<b.o);this.s.update(a);for(let b in this.keyboard)this.keyboard[b]&&this.La(b);0>=this.s.o&&(alert("game over"),this.i.U=null,this.i.Ga())}hb(){if(!(35<
this.H.length)){var a=new G(this,N(0,3));this.H.push(a)}}rb(){var a=[];for(let c=0;c<this.P.J.length;c++)for(let d=0;d<this.P.J.length;d++){var b=new n(c*this.A,d*this.A);this.P.Ba(c,d)||a.push(b)}return a}qb(){var a=this.Pa(8,25);return 0<a.length?a[N(0,a.length)]:new n(this.A,this.A)}Pa(a=8,b=13){var c=this.Vb;c=(c=c.filter(f=>f.T(this.s.g)>this.A*a)).filter(f=>f.T(this.s.g)<this.A*b);var d=[];for(let f in c){var e=!0;for(let k=0;k<this.H.length;k++)if(this.H[k].g.T(new n(c[f].x,c[f].y))<this.A){e=
!1;break}e&&d.push(c[f])}return c}La(a){if(" "!==a&&"space"!==a||this.s.sb()," "!==a&&"e"!==a)if("q"===a)this.keyboard.q=!1,this.i.Ga();else if(!this.s.qa){var b=this.s.g.clone(),c=!1;"s"===a||"ArrowDown"===a?(b.move(4,this.s.height),c=!0):"w"===a||"ArrowUp"===a?(b.move(0,this.s.height),c=!0):"d"===a||"ArrowRight"===a?(b.move(2,this.s.height),c=!0):"a"!==a&&"ArrowLeft"!==a||(b.move(6,this.s.height),c=!0);c&&(this.Y(b.x,b.y)?this.s.Pb(b.x,b.y):this.s.moveTo(b.x,b.y))}}B(a){var b;a.clearRect(0,0,a.canvas.width,
a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.wa(),0,0);a.fillStyle="#004b52d6";a.fillRect(0,0,a.canvas.width,32);a.fillStyle="#ffffff";a.fillText("LIFE "+this.s.o,15,15);a.fillText("SCORE "+this.s.ia,15,30);a.fillText("Arrows "+(1E9<(b=this.s.Ia)?parseInt(b/1E6)+"B":1E6<b?parseInt(b/1E6)+"M":1E3<b?parseInt(b/1E3)+"K":b),192,15)}click(){}control(a){this.La(a)}ra(a){this.keyboard[a.key]=!0}da(a){this.keyboard[a.key]=
!1}}class ka extends M{constructor(a){super(a);this.i.m.u("grass",1);this.i.m.u("dirt",1);this.i.m.u("steel",1);this.F={fb:this.i.m.u("steel",1),la:this.i.m.u("water",1),za:this.i.m.u("grass",1),va:this.i.m.u("dirt",1),Ua:this.i.m.u("magic",1),s:this.i.m.u("player",1)};a=400>this.i.D.width?32:100;this.G=[{x:a,y:128},{x:a,y:160},{x:a,y:192},{x:a,y:224},{x:a,y:256}];this.ga="robin hood";this.K=0;this.ka=!1;this.buffer=this.Qb()}Qb(){var a=p(this.i.D.width,this.i.D.height);return a.getContext("2d"),
a}update(a){this.time=a}B(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,0);a.drawImage(w.R("\u2588 \u24c5\u24c1\u24b6\u24ce \u24bc\u24b6\u24c2\u24ba",24,this.F.za,"Verdana"),this.G[0].x+20,this.G[0].y);a.drawImage(w.R("\u2588 SOUND : "+(this.ka&&1==this.ka?"on":"off"),24,this.F.la,"Verdana"),this.G[1].x+20,this.G[1].y);a.drawImage(w.R("\u2588 Music : "+(this.ba&&
this.ba.ha?"on":"off"),24,this.F.la,"Verdana"),this.G[2].x+20,this.G[2].y);a.drawImage(w.R(`\u2588 NAME : ${this.ga}`,24,this.F.la,"Verdana"),this.G[3].x+20,this.G[3].y);a.drawImage(w.R("\u2588 STATS \u32e1",24,this.F.va,"Roboto"),this.G[4].x+20,this.G[4].y);a.drawImage(this.F.s,this.G[this.K].x,this.G[this.K].y+4);a.fillText("Time "+this.time,20,20)}click(){}control(a){if("s"===a||"ArrowDown"===a)a=this.K+1,this.K=(0>a?-a:a)%this.G.length;else if("w"===a||"ArrowUp"===a)a=this.K-1,this.K=(0>a?-a:
a)%this.G.length;else if("a"===a||"ArrowLeft"===a||"d"===a||"ArrowRight"===a||"space"===a||" "===a)0==this.K?this.i.Sb():1==this.K?this.ka?this.ka=!1:this.ka=!0:2==this.K?(this.ba||(this.ba=new aa("E4E4D4E4E4D4E4G4G4A4A4E4E4D4E4E4D4E4G4G4A4A4G4G4E4E4D4E4E4D4E4A4A4",120,!1,!0,2E3)),this.ba.toggle()):3==this.K?this.ga=(a=prompt("name",this.ga))&&0<a.length?a.substring(0,10):this.ga:4==this.K&&(this.ba&&this.ba.stop(),alert("under construction"))}ra(){}da(a){this.control(a.key)}}class la{constructor(a){return this.target=
a,this.Fa=[],!!a.addEventListener&&(["click","keydown","keyup","mousemove"].forEach(b=>{a.addEventListener(b,c=>{this.fireEvent({name:b,event:c})})}),!0)}sub(a){this.Fa.push(a)}clear(){this.Fa=[]}fireEvent(a){var b=this.Fa,c;for(c in b)b[c].notify&&b[c].notify(a)}}class ma{constructor(a){this.D=a;this.m=new u;this.na=document.querySelector(a.na);this.canvas=Object.assign(document.createElement("canvas"),{width:a.width,height:a.height,className:"gamecanvas"});this.na.appendChild(this.canvas);this.O=
new la(document);this.Tb();this.ta=new T(a.framerate,this,!0);this.pb()}update(a){if(0==this.ta.p)if(this.time=a,this.h)try{this.h.update(a),this.h.B(this.canvas.getContext("2d"))}catch(b){console.log(b),this.ta.stop()}else this.ta.stop()}Tb(){this.h=new Z(this);this.O.clear();this.O.sub(this.h)}Ga(){this.Da?(console.log("using mainmenuscene already created"),this.h=this.Da):(this.Da=new ka(this),this.h=this.Da);this.O.clear();this.O.sub(this.h)}Sb(){this.U?(console.log("using game already created"),
this.h=this.U):(this.U=new ja(this),this.h=this.U);this.O.clear();this.O.sub(this.h)}pb(){if(!(400<this.D.width)){var a=Object.assign(document.createElement("div"),{className:"controls_container"});a.innerHTML="<table>\n        <tr><td id='q'>q</td><td id='w'>w</td><td id='e'>e</td><td class=\"padding\"></td><td id='space'>space</td> </tr>\n        <tr><td id='a'>a</td><td id='s'>s</td><td id='d'>d</td><td class=\"padding\"></td><td id='f'>f</td></tr></table>";this.na.appendChild(a);var b=((c,d=document)=>
d.querySelectorAll(c))(".controls_container td");for(let c=0;c<b.length;c++)b[c].addEventListener("click",()=>{this.O.fireEvent({name:"control",event:{key:b[c].innerText}})}),b[c].addEventListener("touchstart",()=>{this.O.fireEvent({name:"controlts",event:{key:b[c].innerText}})}),b[c].addEventListener("touchend",()=>{this.O.fireEvent({name:"controlte",event:{key:b[c].innerText}})})}}}const na={na:".canvas_container",ac:32,Wb:1,framerate:1/15,width:32*parseInt(window.innerWidth/32),height:576,Xb:"Assets",
$b:H("#spriteSheetMain")};class oa extends ma{constructor(a){super(a)}}document.addEventListener("DOMContentLoaded",function(){window.Qa||(window.Qa=new oa(na))},!1)})();
