var x="function"==typeof Object.defineProperties?Object.defineProperty:function(k,t,r){if(k==Array.prototype||k==Object.prototype)return k;k[t]=r.value;return k};function y(k){k=["object"==typeof globalThis&&globalThis,k,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var t=0;t<k.length;++t){var r=k[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object");}var J=y(this);
function Q(k,t){if(t)a:{var r=J;k=k.split(".");for(var z=0;z<k.length-1;z++){var C=k[z];if(!(C in r))break a;r=r[C]}k=k[k.length-1];z=r[k];t=t(z);t!=z&&null!=t&&x(r,k,{configurable:!0,writable:!0,value:t})}}function R(k){k=Math.trunc(k)||0;0>k&&(k+=this.length);if(!(0>k||k>=this.length))return this[k]}Q("Array.prototype.at",function(k){return k?k:R});function S(k){return k?k:R}Q("Int8Array.prototype.at",S);Q("Uint8Array.prototype.at",S);Q("Uint8ClampedArray.prototype.at",S);
Q("Int16Array.prototype.at",S);Q("Uint16Array.prototype.at",S);Q("Int32Array.prototype.at",S);Q("Uint32Array.prototype.at",S);Q("Float32Array.prototype.at",S);Q("Float64Array.prototype.at",S);Q("String.prototype.at",function(k){return k?k:R});
(()=>{function k(a,b,c=0){0==c&&(c=b);var d=q(a.width*c,a.height*b),e=d.getContext("2d");for(let f=0;f<b;f++)for(let g=0;g<c;g++)e.drawImage(a,g*a.width,f*a.height);return d}function t(a,b){let c=q(a.width,a.height),d=c.getContext("2d");return d.globalAlpha=b,d.drawImage(a,0,0),d.globalAlpha=1,c}function r(a,b,c,d=!1){var e=q(b,c),f=e.getContext("2d");return d&&f.fillRect(0,0,b,c),f.drawImage(a,b/2-a.width/2,c/2-a.height/2),e}class z{constructor(a=1/60,b,c=!1){this.at=0;this.sa=null;this.Ha=a;this.t=
b;c&&this.start();this.p=this.V=!1}Tb(a){if(this.sa)for(this.at+=(a-this.sa)/1E3,1<this.at&&(this.at=1);this.at>this.Ha;){this.t.update(Math.floor(a/1E3));this.at-=this.Ha;break}this.sa=a;this.V||this.Ra()}Ra(){requestAnimationFrame(a=>{this.Tb(a)})}start(){this.V=!1;this.Ra()}stop(){this.V=!0}}class C{constructor(a){this.o=a;this.fa=[]}update(a){this.time=a;[...this.fa].forEach(b=>{b.update&&b.update(a)});this.fa=this.fa.filter(b=>!b.delete)}v(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle=
"black";a.fillRect(0,0,a.canvas.width,a.canvas.height);[...this.fa].forEach(b=>{b.v&&b.v(a)})}Wa(a){this.o.Yb=this.o.l;a.o=this.o;this.o.Sb(a)}notify(a){let b=a.name;a=a.event;"keydown"==b&&this.ba?this.ba(a):"keyup"==b&&this.X?this.X(a):"mousemove"==b&&this.Jb||("click"==b&&this.click?this.click(a):"control"==b&&this.control?this.control(a.key):"controlts"==b&&this.jb?this.jb(a.key):"controlte"==b&&this.ib?this.ib(a.key):console.log(b))}Jb(){}X(a){this.control(a.key)}}const T=Math.PI,F=(a,b=document)=>
b.querySelector(a),M=(a=1,b=0)=>b+(a-b)*Math.random(),K=(a=1,b=0)=>0|M(a,b),q=(a=0,b=0)=>{let c=document.createElement("canvas");return c.width=a,c.height=b,c},I=(a,b,c=!0)=>((d,e,f=!0)=>{var g,h,m,n;f&&0!=e%(Math.PI/4)?(m=d.width,n=d.height,g=h=Math.sqrt(m*m+n*n)):(g=d.width,h=d.height);f=q(g,h);m=f.getContext("2d");g/=2;h/=2;return m.imageSmoothingQuality="high",m.save(),m.translate(g,h),m.rotate(e),m.drawImage(d,0,0,d.width,d.height,-d.width/2,-d.height/2,d.width,d.height),m.restore(),f})(a,(b%=
8)*T/4,c),D=(a,b,c,d,e)=>{let f=q(d,e);return f.getContext("2d").drawImage(a,b,c,d,e,0,0,d,e),f},A=(a,b=1,c=null)=>{let d=a.length,e=Math.max(...a.map(m=>m.length));var f=q(e*b,d*b),g=f.getContext("2d");for(let m=0;m<d;m++)for(let n=0;n<e;n++){var h=a[m][n];c&&(h=c(h));h&&""!=h&&(g.fillStyle=h,g.fillRect(n*b,m*b,b,b))}return f},B=(a,b)=>{for(var c=a.getContext("2d").getImageData(0,0,a.width,a.height).data,d=[],e=0;e<c.length;e+=4){var f=d,g=f.push;var h=c[e];var m=c[e+1],n=c[e+2];h=0==h+m+n+c[e+3]?
null:0==h+m+n||255<h||255<m||255<n?"#000000":"#"+((h<<16)+(m<<8)+n).toString(16).padStart(6,"0");g.call(f,h)}c=[];for(e=0;e<a.height;e++)c[e]=[];f=e=0;for(g=0;g<d.length;g++)e>=a.width&&(f++,e=0),c[f][e]=d[g],b&&(c[f][e]=b(c[f][e])),e++;return c},N=(a,b,c="source-atop")=>{let d=q(a.width,a.height),e=d.getContext("2d");e.drawImage(a,0,0);e.globalCompositeOperation=c;for(c=0;c<a.width/b.width;c++)for(let f=0;f<a.height/b.height;f++)e.drawImage(b,c*b.width,f*b.height);return d},u=[{c:0,i:0,n:"dirt",
x:88,y:0,w:8,g:8},{c:0,i:0,n:"grass",x:96,y:0,w:8,g:8},{c:0,i:0,n:"water",x:104,y:0,w:8,g:8},{c:0,i:0,n:"steel",x:112,y:0,w:8,g:8},{c:0,i:0,n:"brick",x:120,y:0,w:8,g:8},{c:1,i:0,n:"magic",x:88,y:8,w:8,g:8},{c:1,i:1,n:"tree",x:96,y:8,w:8,g:8},{c:1,i:0,n:"log",x:104,y:8,w:8,g:8},{c:1,i:0,n:"apple",x:112,y:8,w:8,g:8},{c:1,i:0,n:"lemon",x:120,y:8,w:8,g:8},{c:1,i:0,n:"sword",x:88,y:16,w:8,g:8},{c:1,i:0,n:"bow",x:96,y:16,w:8,g:8},{c:1,i:0,n:"arrow",x:104,y:16,w:8,g:8},{c:1,i:0,n:"rabbit",x:88,y:24,w:8,
g:8},{c:1,i:0,n:"wolf",x:96,y:24,w:16,g:8},{c:1,i:0,n:"castle",x:128,y:0,w:32,g:32},{c:1,i:0,n:"cave",x:112,y:16,w:16,g:16},{c:1,i:0,n:"player",x:0,y:32,w:16,g:16},{c:1,i:0,n:"playerb",x:16,y:32,w:16,g:16},{c:1,i:0,n:"players",x:32,y:32,w:8,g:16},{c:1,i:0,n:"playerh",x:40,y:32,w:8,g:16},{c:1,i:0,n:"bear",x:48,y:32,w:16,g:16},{c:1,i:0,n:"deer",x:64,y:32,w:16,g:16},{c:1,i:0,n:"house",x:80,y:32,w:16,g:16},{c:1,i:0,n:"shop",x:96,y:32,w:16,g:16},{c:1,i:0,n:"npcgirl",x:112,y:32,w:16,g:16},{c:1,i:0,n:"npcman",
x:128,y:32,w:16,g:16},{c:1,i:0,n:"direction",x:128,y:32,w:16,g:16},{c:0,i:0,n:"map_spawn",x:0,y:48,w:16,g:16},{c:0,i:0,n:"map_castle",x:16,y:48,w:16,g:16},{c:0,i:0,n:"map_forest_1",x:32,y:48,w:16,g:16},{c:0,i:0,n:"map_forest_2",x:48,y:48,w:16,g:16},{c:0,i:0,n:"map_forest_3",x:64,y:48,w:16,g:16},{c:0,i:0,n:"map_forest_4",x:80,y:48,w:16,g:16}];class v{constructor(){this.Va=this.Bb()}Bb(){if(v.Ca)return v.Ca;for(let a=0;a<u.length;a++)u[a].Zb=this.get(u[a].n),u[a].Ta=this.j(u[a].n,2),u[a].Ua=this.j(u[a].n,
3);v.Ca=u}La(a){return(this.Va?this.Va:u).find(b=>b.n.toLowerCase()==a.toLowerCase())}get(a){a=this.La(a);if(!a||null==a.x)return null;if(a.V)return a.V;var b=F("#spriteSheetMain");b=D(b,a.x,a.y,a.w,a.g);return a.c?(a=B(b,c=>"#ffffff"===c?"":c),A(a,1,c=>c)):b}j(a,b=1){var c=this.La(a);if(c&&2==b&&c.Ta)return c.Ta;if(c&&3==b&&c.Ua)return c.Ua;a=this.get(a);a=B(a,d=>"#ffffff"==d?"":d);return A(a,b,d=>d)}static M(a,b=1){a=this.ub(a);a=B(a,c=>"#ffffff"==c?"":c);return A(a,b,c=>c)}static ub(a){var b=u.find(d=>
d.n.toLowerCase()==a.toLowerCase());if(b.V)return b.V;var c=F("#spriteSheetMain");c=D(c,b.x,b.y,b.w,b.g);return b.c?(b=B(c,d=>"#ffffff"===d?"":d),A(b,1,d=>d)):c}}class l{constructor(){}static get(a){var b=u.find(d=>d.n.toLowerCase()==a.toLowerCase()),c=F("#spriteSheetMain");c=D(c,b.x,b.y,b.w,b.g);return b.c?(b=B(c,d=>"#ffffff"===d?"":d),A(b,1,d=>d)):c}static j(a,b=1){a=this.get(a);a=B(a,c=>"#ffffff"==c?"":c);return A(a,b,c=>c)}static getAll(a=1){var b={};for(let c in u)b[u[c].n]=1==a?l.get(u[c].n):
l.j(u[c].n,a);return b}}class w{static Za(){if(w.ka)return w.ka;var a=F("#spriteSheetMain");a=D(a,0,0,88,32);a=B(a,c=>"#ffffff"==c?"":c);var b=A(a,1,c=>c);return w.ka={canvas:b,K:a},w.ka}constructor(a={}){this.G=a;a.size?this.size=a.size:this.size=1;var b=w.Za();this.K=JSON.parse(JSON.stringify(b.K));this.canvas=A(this.K,this.size,c=>a.color&&"#000000"==c?a.color:c);a.sb&&(this.canvas=N(this.canvas,a.sb));this.hb=this.wb(this.canvas,8*this.size)}F(a,b){let c=q(8*this.size*a.length,8*this.size),d=
c.getContext("2d");a=a.toUpperCase();for(let e in a)d.drawImage(this.hb[a[e]],this.size*e*8,0);return b&&(c=N(c,b)),c}wb(a,b){var c={};let d=0,e=0;for(let f=0;44>f;f++){let g=" 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ.:-\u00d7?\u00a9!"[f];11<=f&&0==f%11&&(e=0,d+=b);let h=D(a,e*b,d,b,b);c[g]=h;e++}return c}}class L{constructor(a){a.size&&(this.size=a.size);a.Ja&&(this.Ja=a.Ja)}static get(a){var b=l.j("log",a);a=l.j("tree",a);var c=q(a.width,a.width+b.width),d=c.getContext("2d");return d.drawImage(a,0,
0),d.drawImage(b,0,a.height),c}static tb(){var a=l.j("log",2),b=l.j("tree",2),c=q(b.width,b.height+2*a.height).getContext("2d");c.drawImage(b,0,0);c.drawImage(a,0,b.height);c.drawImage(a,0,b.height+a.height)}}class U extends C{constructor(a){super(a);this.buffer=q(this.o.G.width,this.o.G.height);a=l.j("brick",1);var b=l.j("steel",1),c=l.j("water",1),d=l.j("apple",1),e=l.j("grass",1);l.j("water",2);var f=l.j("dirt",2),g=l.j("grass",2),h=l.j("castle",3),m=l.j("player",2),n=l.j("bear",3),V=l.j("deer",
2),W=l.j("rabbit",2),X=new w({color:"red",size:2}),E=new w({color:"red",size:4});L.get(1);L.get(2);L.tb();this.J={la:E.F("JS",a),"13K":E.F("13K",b),2023:E.F("2023",c),13:E.F("13",b),ab:X.F("TH",b),Ya:E.F("CENTURY",d),"ROBIN HOOD":E.F("ROBIN HOOD",e)};this.Vb=t(k(c,4,this.o.G.width/c.width),.6);this.$=t(k(f,2,36),.4);this.Cb=t(k(g,12,36),.4);this.fb=h;this.m=m;this.Fa=n;this.Ga=V;this.Sa=W;this.buffer=this.pa();this.ra=0}update(a){this.time=a;this.ra++}pa(){let a=q(600,600),b=a.getContext("2d");b.drawImage(this.Vb,
0,192);b.drawImage(this.$,0,224);b.drawImage(this.$,0,256);b.drawImage(this.$,0,480);b.drawImage(this.$,0,512);b.drawImage(this.$,0,544);b.drawImage(this.Cb,0,288);return b.drawImage(this.J.la,128,96),b.drawImage(this.J["13K"],128+this.J.la.width,96),b.drawImage(this.J[2023],160+this.J.la.width+this.J["13K"].width,96),b.drawImage(this.J[13],128,128),b.drawImage(this.J.ab,192,128),b.drawImage(this.J.Ya,224,128),b.drawImage(this.J["ROBIN HOOD"],128,160),a}v(a){let b=20;a.clearRect(0,0,a.canvas.width,
a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.drawImage(this.buffer,0,0);a.fillStyle="green";a.font="16px Arial";a.fillText("Time "+this.time,20,b);b+=20;a.fillText("use any key to load menu ",20,b);a.fillText("last edit : 2023-08-20 6:00 PM ",20,b+20);a.drawImage(this.fb,32,256);a.drawImage(this.m,128,352)}ia(){100<this.ra&&this.o.Xa();this.ra=100}control(){this.ia()}click(){this.ia()}ba(){this.ia()}X(){this.ia()}}class Y{constructor(a,b=300,c=!0,d=!0,e=3){this.I=
a;this.Pb=b;this.loop=e;this.pitch=d;this.ca=!1;this.N=new AudioContext;this.Pa=this.I;c&&this.start()}toggle(){this.ca?this.stop():this.start()}start(){this.ca=!0;this.Qa()}stop(){this.ca=!1}reset(){this.I=this.Pa}yb(a){switch(a){case "B":return 493.88;case "C":return 261.63;case "D":return 293.66;case "E":return 329.63;case "F":return 349.23;case "G":return 392}return 440}xb(a){var b=this.yb(a[0]);return 1<a.length?b*Math.pow(2,a[1]/12):b}Qa(){if(this.ca)if(0===this.I.length&&0<this.loop&&(this.I=
this.Pa,this.loop--),0===this.I.length)this.stop();else{var a=this.I[0];this.pitch?(this.I[1],this.I=this.I.slice(2)):this.I=this.I.slice(1);var b=this.N.createOscillator(),c=this.N.createGain();b.connect(c);c.connect(this.N.destination);b.frequency.setValueAtTime(this.xb(a),this.N.currentTime);b.start();c.gain.setValueAtTime(0,this.N.currentTime);c.gain.exponentialRampToValueAtTime(1,this.N.currentTime+.02);setTimeout(()=>{c.gain.setValueAtTime(1,this.N.currentTime);c.gain.exponentialRampToValueAtTime(.001,
this.N.currentTime+.02);b.stop(this.N.currentTime+.02);this.Qa()},60/this.Pb*1E3)}}}class Z extends C{constructor(a){super(a);this.u={xa:l.j("steel",1),za:l.j("water",1),Na:l.j("grass",1),m:l.j("player",1),Sa:l.j("rabbit",1),Ga:l.j("deer",1),Fa:l.j("bear",1),cb:l.j("apple",1),Gb:l.j("lemon",1)};this.Z=new w({color:"red",size:1});new w({color:"white",size:2});this.Nb=new w({color:"white",size:3});this.buffer=this.wa();this.y=0}wa(){var a=q(this.o.G.width,1200);let b=a.getContext("2d");var c=64;return b.drawImage(this.Nb.F("GAME INSTRUCTIONS",
this.u.xa),32,c),c+=80,b.fillStyle="white",b.font="16px Arial",b.fillText("you step into the legendary shoes of Robin Hood.",64,c),c+=20,b.fillText("your mission is to make the world a better place.",64,c),c+=20,b.fillText("- explore forest and hunt animals",64,c),c+=20,b.fillText("- do quests and trade with merchants",64,c),c+=20,b.fillText("- spread the wealth to the poor",64,c),c+=20,b.fillText("- improve your stats and defend the village",64,c),c+=20,c+=20,b.fillText("controls",64,c),c+=20,b.fillText("a/left : move left",
64,c),c+=20,b.fillText("d/right : move right",64,c),c+=20,b.fillText("w/up : move up",64,c),c+=20,b.fillText("s/down : move down",64,c),c+=20,b.fillText("space : shoot arrow",64,c),c+=20,b.fillText("e : interact with",64,c),c+=20,b.fillText("q : open menu",64,c),c+=20,c+=20,b.fillStyle="green",b.fillText("game play",64,c),c+=20,b.fillStyle="white",b.fillText("hunt animals in forest, rabbit, deer, bear",64,c),c+=20,b.drawImage(this.u.Sa,64,c+8),b.drawImage(this.u.Ga,72,c),b.drawImage(this.u.Fa,88,
c),c+=40,b.fillText("harvest trees to get apples and lemons",64,c),b.drawImage(this.u.cb,64,c+8),b.drawImage(this.u.Gb,72,c+8),c+=40,b.fillText("things to do in town",64,c),c+=20,b.fillText("- trade hunts with merchants",64,c),c+=20,b.fillText("- give goodies to villagers for free (gain morale)",64,c),c+=20,b.fillText("- take quests from villagers for extra love",64,c),c+=40,b.fillStyle="green",b.fillText("extra things to do",64,c),c+=20,b.fillStyle="red",b.fillText("deep into the jungle lies the old wizzard",
64,c),c+=20,b.fillText("find him and buy the magic bow",64,c),c+=20,b.fillStyle="white",b.fillText("more instructions can be learned in game",64,c),a}update(a){this.time=a}v(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,this.y);a.fillText("Time "+this.time,20,20)}click(){}ba(){}control(a){"s"===a||"ArrowDown"===a?this.y-=32:"w"===a||"ArrowUp"===a?this.y+=32:"fire"!==
a&&"e"!==a&&"q"!==a&&"a"!==a&&"ArrowLeft"!==a&&"d"!==a&&"ArrowRight"!==a&&"space"!==a&&" "!==a||this.Wa(new O(this.o))}X(a){this.control(a.key)}}class p{constructor(a,b){this.x=a;this.y=b}is(a){let b=this.y,c=a.y;return this.x==a.x&&b==c}P(a){if(!a)return 1/0;let b=this.x,c=this.y,d=a.x;a=a.y;if(b==d&&c==a)return 0;if(b==d)return Math.abs(c-a);if(c==a)return Math.abs(b-d);let e=0;return e+=Math.pow(b-d,2),e+=Math.pow(c-a,2),e=Math.sqrt(e),e}Ma(a){let b=this.x,c=this.y,d=a.x;a=a.y;return b==d&&c==
a?4:b>d?6:b<d?2:c<a?4:c>a?0:4}move(a,b){0==a?this.y-=b:4==a?this.y+=b:6==a?this.x-=b:2==a?this.x+=b:7==a?(this.y-=b,this.x-=b):1==a?(this.y-=b,this.x+=b):3==a?(this.y+=b,this.x+=b):5==a&&(this.y+=b,this.x-=b)}Kb(a,b){let c=a.x-this.x,d=a.y-this.y,e=Math.sqrt(c*c+d*d);e<b?(this.x=a.x,this.y=a.y):(this.x+=(c/e||0)*b,this.y+=(d/e||0)*b)}clone(){return new p(this.x,this.y)}v(a,b="red"){a.fillStyle=b;this.mb(a,b)}mb(a,b="green"){a.fillStyle=b;a.strokeStyle=b;a.beginPath();a.arc(this.x,this.y,3,0,2*Math.PI);
a.fill()}}const aa=[{n:"tree",i:1,c:"#0d3702"},{n:"brick",i:1,c:"#bf0a0a"},{n:"dirt",i:0,c:"#d9a066"},{n:"grass",i:0,c:"#99e550"},{n:"water",i:2,c:"#8a99f6"},{n:"steel",i:1,c:"#6a6a6a"},{n:"player",i:1,c:"#130c40"},{n:"cave",i:1,c:"#2e2b2b"},{n:"deerspawnpoint",i:0,c:"#df7126"}];class ba{constructor(a,b=1){this.s=new v;this.gb=[];this.kb=[];this.Ab(b)}qa(a,b){return(a=Math.floor(a),b=Math.floor(b),0>a)||a>this.K.length-1||0>b||b>this.K.length-1||!this.K[a]?!0:this.Fb(this.K[b][a])}Fb(a){var b=aa.find(c=>
c.c==a);return null==b?1:b.i}Ab(a=1){var b=this.s.get("map_spawn"),c=this.s.get("map_castle"),d=this.s.get("map_forest_1"),e=this.s.get("map_forest_2"),f=(this.s.get("map_forest_3"),this.s.get("map_forest_4"),b.width),g=q(3*f,3*b.height);(h=g.getContext("2d")).drawImage(e,0,0);h.drawImage(c,f,0);h.drawImage(d,f+f,0);h.drawImage(d,0,f);h.drawImage(b,f,f);h.drawImage(d,f+f,f);h.drawImage(d,0,f+f);h.drawImage(d,f,f+f);h.drawImage(d,f+f,f+f);this.K=b=B(g);c={"#0d3702":this.s.j("tree",2*a),"#d9a066":k(this.s.get("dirt"),
2*a),"#bf0a0a":k(this.s.get("brick"),2*a),"#99e550":k(this.s.get("grass"),2*a),"#8a99f6":k(this.s.get("water"),2*a),"#6a6a6a":k(this.s.get("steel"),2*a),"#a9a9a9":this.s.j("castle",2*a),"#fbf236":this.s.j("house",2*a),"#eca732":this.s.j("shop",2*a),"#2e2b2b":this.s.j("cave",2*a)};a*=16;d=q(b.length*a,b.length*a);var h=d.getContext("2d");for(e=0;e<b.length;e++)for(f=0;f<b[e].length;f++)g=b[f][e],"#0d3702"==g?(h.drawImage(.5<M()?c["#d9a066"]:c["#99e550"],e*a,f*a),h.drawImage(c["#0d3702"],e*a,f*a)):
"#d9a066"==g?h.drawImage(c["#d9a066"],e*a,f*a):"#bf0a0a"==g?h.drawImage(c["#bf0a0a"],e*a,f*a):"#99e550"==g?h.drawImage(c["#99e550"],e*a,f*a):"#df7126"==g?(h.drawImage(c["#99e550"],e*a,f*a),this.kb.push([e,f])):"#8a99f6"==g?h.drawImage(c["#8a99f6"],e*a,f*a):"#6a6a6a"==g?h.drawImage(c["#6a6a6a"],e*a,f*a):"#a9a9a9"==g?(h.drawImage(k(this.s.get("grass"),8*a),e*a,f*a),h.drawImage(c["#a9a9a9"],e*a,f*a)):"#2e2b2b"==g?(h.drawImage(k(this.s.get("grass"),4*a),e*a,f*a),h.drawImage(c["#2e2b2b"],e*a,f*a),this.gb.push([e,
f])):"#fbf236"==g?(h.drawImage(k(this.s.get("grass"),4*a),e*a,f*a),h.drawImage(c["#fbf236"],e*a,f*a)):"#eca732"==g?(h.drawImage(k(this.s.get("grass"),4*a),e*a,f*a),h.drawImage(c["#eca732"],e*a,f*a)):"#130c40"==g?(this.Da=new p(e*a,f*a),b[e][f]="#d9a066",h.drawImage(c["#d9a066"],e*a,f*a)):console.log(g,"unclassified");this.Ib=d}}class ca{constructor(a,b,c,d,e){this.Ka=a;this.h=new p(0,0);this.g=c;this.w=b;this.Lb=d;this.Mb=e}rb(a){this.h=new p(a.x,a.y)}Hb(a){this.h=a}move(a){this.h.move(a,32)}vb(a){var b=
this.h.x-this.w/2,c=this.h.y-this.g/2;return D(a,0>b?0:b,0>c?0:c,this.w,this.g)}v(a,b){let c;let d,e,f,g,h,m;var n=this.h.y-this.g/2;c=this.h.x-this.w/2;0>=c&&(c=0,this.h.x=c+this.w/2);0>=n&&(n=0,this.h.y=n+this.g/2);c+this.w>b.width&&(c=b.width-this.w,this.h.x=c+this.w/2);n+this.g>b.height&&(n=b.height-this.g,this.h.y=n+this.g/2);f=this.Lb;g=this.Mb;d=h=this.w;e=m=this.g;a.drawImage(b,c,n,d,e,f,g,h,m)}}class da{constructor(a){this.h=new p(a.x,a.y)}v(a){a.drawImage(this.O,this.h.x,this.h.y)}}class G extends da{constructor(a){super(a.h);
this.e=a;this.direction=a.direction;this.u=this.aa();this.O=this.u[this.direction];this.width=this.O.width;this.height=this.O.height;this.speed=this.width/4;this.lb=this.e.attributes.Aa*this.speed/2;this.Oa=0;this.B=1}update(a){this.time=a;this.Oa++;this.Oa<this.lb?(this.h.move(this.direction,this.speed),this.e.eb(this)):this.B=0}aa(){if(G.T)return G.T;var a=this.e.l.W,b=16*a,c=r(v.M("arrow",a),b,b);a=I(c,0);b=I(c,2);var d=I(c,4);c=I(c,6);this.w=a.width;this.g=a.height;return G.T=[c,c,a,a,b,b,d,c],
G.T}}class ea{constructor(){this.$a=this.Aa=8}}class fa{constructor(a){this.l=a;this.B=100;this.da=0;this.attributes=new ea(1);this.h=new p(0,0);this.destination=new p(0,0);this.ja=!1;this.time=0;this.direction=4;this.u=this.aa();this.O=this.u[4];this.ea=[];this.ha=0;this.Ba=1E8}setPosition(a){this.h=new p(a.x,a.y);this.destination=new p(a.x,a.y)}update(a){this.ha=Math.max(this.ha-1,0);this.ea=this.ea.filter(b=>0<b.B);[...this.ea].forEach(b=>{b.update&&b.update(a)});this.time=a;0!=this.h.P(this.destination)?
(this.ja=!0,this.h.Kb(this.destination,this.attributes.$a)):(this.ja=!1,this.l.na.rb(this.h))}qb(){0<this.ha||(this.ha=20-2*this.attributes.Aa,this.Ba--,this.ea.push(new G(this)))}eb(a){var b=a.h;b=this.l.R.qa(b.x/this.l.A,b.y/this.l.A);1!=b&&1!=b||2==b||(a.B=0);for(let c=0;c<this.l.C.length;c++)b=this.l.C[c],b.h.P(a.h)<this.l.A&&(b.B-=a.B,0>=b.B&&(4==b.type||5==b.type?this.da-=b.type+1:this.da+=b.type+1),a.B=0)}v(a){a.drawImage(this.O,this.h.x,this.h.y);[...this.ea].forEach(b=>{b.v&&b.v(a)})}Ob(a,
b){this.direction=a=this.h.Ma(new p(a,b));this.O=this.u[a]}moveTo(a,b){var c=this.h.Ma(new p(a,b));this.direction=c;0!=this.h.P(new p(a,b))&&(this.O=this.u[c],this.move(c))}move(a){a===this.direction?this.ja||(console.log("moving player"),this.destination.move(a,this.width)):this.direction=a}aa(){var a=v.M("player",this.l.W),b=v.M("playerb",this.l.W),c=v.M("players",this.l.W);return this.width=a.width,this.height=a.height,[b,b,c=r(c,this.width,this.height),a,a,a,((d,e=!0)=>{let f=q(d.width,d.height),
g=f.getContext("2d");return g.save(),e?(g.scale(-1,1),g.drawImage(d,0,0,-1*d.width,d.height)):(g.scale(1,-1),g.drawImage(d,0,0,d.width,-1*d.height)),g.restore(),f})(c,!0),b]}}const P=[{S:50},{S:50},{S:50},{S:50},{S:50},{S:50},{S:50}];class H{constructor(a,b=0){this.type=b;this.l=a;this.u=this.aa();this.O=this.u[this.type];this.h=a.ob();this.B=1+2*this.type;this.ua=P[this.type].S}zb(){var a=[],b=this.l.A;let c=this.h.x/b,d=this.h.y/b;if(this.l.U(c+1,d)&&a.push(new p),this.l.U(c+1,d)&&a.push(new p(c*
b+b,d*b)),this.l.U(c-1,d)&&a.push(new p(c*b-b,d*b)),this.l.U(c,d+1)&&a.push(new p(c*b,d*b+b)),this.l.U(c,d-1)&&a.push(new p(c*b,d*b-b)),0<a.length)a=a[K(0,a.length)],this.h=new p(a.x,a.y)}update(a){this.time=a;this.ua--;0>=this.ua&&(this.ua=P[this.type].S,this.zb(),this.h.P(this.l.m.h)<2*this.l.A&&(this.l.m.B-=this.type+1,console.log("attack player")))}v(a){a.drawImage(this.O,this.h.x,this.h.y)}aa(){if(H.T)return H.T;var a=this.l.W,b=this.l.A,c=r(v.M("rabbit",a),b,b,!1),d=r(v.M("wolf",a),b,b,!1),
e=r(v.M("deer",a),b,b,!1),f=v.M("bear",a),g=v.M("npcman",a);a=v.M("npcgirl",a);this.g=this.w=b;return H.T=[c,d,e,f,g,a],H.T}}class ha extends C{constructor(a){super(a);this.Eb()}Eb(){this.W=2;this.A=16*this.W;this.keyboard={};this.R=new ba(this,this.W);this.Z=new w({color:"white",size:1});this.m=new fa(this);this.m.setPosition(this.R.Da?this.R.Da:new p(224,224));this.na=new ca(this,this.o.G.width-96,this.o.G.height-96,0,0);this.na.Hb(this.m.h);this.va="robin hood";this.C=[];this.Ub=this.pb();this.Ia()}Db(a,
b){a=new p(a,b);for(let c=0;c<this.C.length;c++)if(b=this.C[c],b.h.P(a)<this.A)return b;return null}U(){}U(a,b){return null!=this.Db(a,b)||this.R.qa(a/this.A,b/this.A)}pa(){var a=q(this.o.G.width,this.o.G.height);let b=a.getContext("2d");b.clearRect(0,0,b.canvas.width,b.canvas.height);b.fillStyle="black";b.fillRect(0,0,b.canvas.width,b.canvas.height);var c=(e=>{if(!e)return null;let f=q(e.width,e.height);return f.getContext("2d").drawImage(e,0,0),f})(this.R.Ib),d=c.getContext("2d");[...this.C].forEach(e=>
{e.update&&e.v(d)});this.m.v(d);c=this.na.vb(c);return b.drawImage(c,0,0),a}update(a){this.time=a;100>this.C.length&&this.bb();[...this.C].forEach(b=>{b.update&&b.update(a)});this.C=this.C.filter(b=>0<b.B);this.m.update(a);for(let b in this.keyboard)this.keyboard[b]&&this.Ea(b)}bb(){if(!(100<this.C.length)){var a=new H(this,K(0,5));this.C.push(a)}}pb(){var a=[];for(let c=0;c<this.R.K.length;c++)for(let d=0;d<this.R.K.length;d++){var b=new p(c*this.A,d*this.A);this.R.qa(c,d)||a.push(b)}return a}ob(){var a=
this.Ia(8,25);return 0<a.length?a[K(0,a.length)]:new p(this.A,this.A)}Ia(a=8,b=13){var c=this.Ub;c=(c=c.filter(f=>f.P(this.m.h)>this.A*a)).filter(f=>f.P(this.m.h)<this.A*b);var d=[];for(let f in c){var e=!0;for(let g=0;g<this.C.length;g++)if(this.C[g].h.P(new p(c[f].x,c[f].y))<this.A){e=!1;break}e&&d.push(c[f])}return c}Ea(a){if(" "!==a&&"space"!==a||this.m.qb()," "!==a&&"e"!==a)if("q"===a)this.keyboard.q=!1,this.o.Xa();else if(!this.m.ja){var b=this.m.h.clone();"s"===a||"ArrowDown"===a?b.move(4,
this.m.height):"w"===a||"ArrowUp"===a?b.move(0,this.m.height):"d"===a||"ArrowRight"===a?b.move(2,this.m.height):"a"!==a&&"ArrowLeft"!==a||b.move(6,this.m.height);this.U(b.x,b.y)?this.m.Ob(b.x,b.y):this.m.moveTo(b.x,b.y)}}v(a){var b;a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.pa(),0,0);a.fillStyle="#004b52d6";a.fillRect(0,0,a.canvas.width,32);a.fillStyle="#ffffff";a.fillText("LIFE "+
this.m.B,15,15);a.fillText("SCORE "+this.m.da,15,30);a.fillText("Arrows "+(1E9<(b=this.m.Ba)?parseInt(b/1E6)+"B":1E6<b?parseInt(b/1E6)+"M":1E3<b?parseInt(b/1E3)+"K":b),192,15)}click(){}control(a){this.Ea(a)}ba(a){this.keyboard[a.key]=!0}X(a){this.keyboard[a.key]=!1}}class O extends C{constructor(a){super(a);this.u={xa:l.j("steel",1),za:l.j("water",1),Na:l.j("grass",1),m:l.j("player",1)};this.D=[{x:100,y:128},{x:100,y:160},{x:100,y:192},{x:100,y:224}];this.va="robin hood";this.L=0;this.Z=new w({color:"red",
size:2});this.buffer=this.wa()}wa(){var a=q(this.o.G.width,this.o.G.height);let b=a.getContext("2d");return b.drawImage(this.Z.F("PLAY GAME",this.u.xa),this.D[0].x+20,this.D[0].y),b.drawImage(this.Z.F("INSTRUCTIONS",this.u.Na),this.D[3].x+20,this.D[3].y),a}update(a){this.time=a}v(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,0);a.drawImage(this.Z.F("SOUND : "+(this.Y&&
this.Y.ca?"on":"off"),this.u.za),this.D[1].x+20,this.D[1].y);a.drawImage(this.Z.F(`NAME : ${this.va}`,this.u.za),this.D[2].x+20,this.D[2].y);a.drawImage(this.u.m,this.D[this.L].x,this.D[this.L].y);a.fillText("Time "+this.time,20,20)}click(){}control(a){if("s"===a||"ArrowDown"===a)a=this.L+1,this.L=(0>a?-a:a)%this.D.length;else if("w"===a||"ArrowUp"===a)a=this.L-1,this.L=(0>a?-a:a)%this.D.length;else if("a"===a||"ArrowLeft"===a||"d"===a||"ArrowRight"===a||"space"===a||" "===a)0==this.L?this.o.Qb():
1==this.L?(this.Y||(this.Y=new Y("E4E4D4E4E4D4E4G4G4A4A4E4E4D4E4E4D4E4G4G4A4A4G4G4E4E4D4E4E4D4E4A4A4",120,!1,!0,2E3)),this.Y.toggle()):2==this.L?this.va=(a=prompt("name","robin"))&&0<a.length?a.substring(0,10):"robin":3==this.L&&(this.Y&&this.Y.stop(),this.Wa(new Z(this.o)))}ba(){}X(a){this.control(a.key)}}class ia{constructor(a){return this.target=a,this.ya=[],!!a.addEventListener&&(["click","keydown","keyup","mousemove"].forEach(b=>{a.addEventListener(b,c=>{this.fireEvent({name:b,event:c})})}),
!0)}sub(a){this.ya.push(a)}clear(){this.ya=[]}fireEvent(a){var b=this.ya,c;for(c in b)b[c].notify&&b[c].notify(a)}}class ja{constructor(a){this.G=a;this.ga=document.querySelector(a.ga);this.canvas=Object.assign(document.createElement("canvas"),{width:a.width,height:a.height,className:"gamecanvas"});this.ga.appendChild(this.canvas);this.H=new ia(document);this.Rb();this.ma=new z(a.framerate,this,!0);this.nb()}update(a){if(0==this.ma.p)if(this.time=a,this.l)try{this.l.update(a),this.l.v(this.canvas.getContext("2d"))}catch(b){console.log(b),
this.ma.stop()}else this.ma.stop()}Rb(){this.l=new U(this);this.H.clear();this.H.sub(this.l)}Sb(a){this.l=a;this.H.clear();this.H.sub(this.l)}Xa(){this.ta?(console.log("using mainmenuscene already created"),this.l=this.ta):(this.ta=new O(this),this.l=this.ta);this.H.clear();this.H.sub(this.l)}Qb(){this.oa?(console.log("using game already created"),this.l=this.oa):(this.oa=new ha(this),this.l=this.oa);this.H.clear();this.H.sub(this.l)}nb(){var a=Object.assign(document.createElement("div"),{className:"controls_container"});
a.innerHTML="<table>\n        <tr><td id='q'>q</td><td id='w'>w</td><td id='e'>e</td><td class=\"padding\"></td><td id='space'>space</td> </tr>\n        <tr><td id='a'>a</td><td id='s'>s</td><td id='d'>d</td><td class=\"padding\"></td><td id='f'>f</td></tr></table>";this.ga.appendChild(a);var b=((c,d=document)=>d.querySelectorAll(c))(".controls_container td");for(let c=0;c<b.length;c++)b[c].addEventListener("click",()=>{this.H.fireEvent({name:"control",event:{key:b[c].innerText}})}),b[c].addEventListener("touchstart",
()=>{this.H.fireEvent({name:"controlts",event:{key:b[c].innerText}})}),b[c].addEventListener("touchend",()=>{this.H.fireEvent({name:"controlte",event:{key:b[c].innerText}})})}}const ka={ga:".canvas_container",ac:32,Wb:1,framerate:1/15,width:576,height:576,Xb:"Assets",$b:F("#spriteSheetMain")};class la extends ja{constructor(a){super(a)}}document.addEventListener("DOMContentLoaded",function(){window.Ka||(window.Ka=new la(ka))},!1)})();
