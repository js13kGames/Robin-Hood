var xa="function"==typeof Object.defineProperties?Object.defineProperty:function(m,u,v){if(m==Array.prototype||m==Object.prototype)return m;m[u]=v.value;return m};function ya(m){m=["object"==typeof globalThis&&globalThis,m,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var u=0;u<m.length;++u){var v=m[u];if(v&&v.Math==Math)return v}throw Error("Cannot find global object");}var za=ya(this);
function x(m,u){if(u)a:{var v=za;m=m.split(".");for(var t=0;t<m.length-1;t++){var z=m[t];if(!(z in v))break a;v=v[z]}m=m[m.length-1];t=v[m];u=u(t);u!=t&&null!=u&&xa(v,m,{configurable:!0,writable:!0,value:u})}}function A(m){m=Math.trunc(m)||0;0>m&&(m+=this.length);if(!(0>m||m>=this.length))return this[m]}x("Array.prototype.at",function(m){return m?m:A});function T(m){return m?m:A}x("Int8Array.prototype.at",T);x("Uint8Array.prototype.at",T);x("Uint8ClampedArray.prototype.at",T);
x("Int16Array.prototype.at",T);x("Uint16Array.prototype.at",T);x("Int32Array.prototype.at",T);x("Uint32Array.prototype.at",T);x("Float32Array.prototype.at",T);x("Float64Array.prototype.at",T);x("String.prototype.at",function(m){return m?m:A});
(()=>{function m(a,b,c="source-atop"){let d=q(a.width,a.height),e=d.getContext("2d");return e.drawImage(a,0,0),e.globalCompositeOperation=c,e.fillStyle=b,e.fillRect(0,0,d.width,d.height),d}function u(a,b){let c=q(a.width+b.width,a.height+b.height),d=c.getContext("2d");return d.drawImage(a,0,0),d.drawImage(a,a.width,b.height),d.drawImage(b,a.width,0),d.drawImage(b,0,a.height),c}function v(a,b,c=0){0==c&&(c=b);var d=q(a.width*c,a.height*b),e=d.getContext("2d");for(let f=0;f<b;f++)for(let h=0;h<c;h++)e.drawImage(a,
h*a.width,f*a.height);return d}function t(a,b){let c=q(a.width,a.height),d=c.getContext("2d");return d.globalAlpha=b,d.drawImage(a,0,0),d.globalAlpha=1,c}function z(a,b,c,d=!1){var e=q(b,c),f=e.getContext("2d");return d&&f.fillRect(0,0,b,c),f.drawImage(a,b/2-a.width/2,c/2-a.height/2),e}function J(a){return 1E9<a?parseInt(a/1E6)+"B":1E6<a?parseInt(a/1E6)+"M":1E3<a?parseInt(a/1E3)+"K":a}function n(a,b,c,d){let e=ea("#spriteSheetMain");a=U(e,8*a,8*b,8*c,8*d);return V(a,f=>"#ffffff"===f?"":f)}function fa(a,
b){for(var c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++)b(a[d][c],c,d)}class Aa{constructor(a=1/30,b,c=!1){this.at=0;this.Ba=null;this.Oa=a;this.t=b;c&&this.start();this.p=this.Fa=!1}nc(a){if(this.Ba)for(this.at+=(a-this.Ba)/1E3,1<this.at&&(this.at=1);this.at>this.Oa;){this.t.update(Math.floor(a/1E3));this.at-=this.Oa;break}this.Ba=a;this.Fa||this.eb()}eb(){requestAnimationFrame(a=>{this.nc(a)})}start(){this.Fa=!1;this.eb()}stop(){this.Fa=!0}}class W{constructor(a){this.u=a;this.fa=[]}update(a){this.time=
a;[...this.fa].forEach(b=>{b.update&&b.update(a)});this.fa=this.fa.filter(b=>!b.delete)}o(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);[...this.fa].forEach(b=>{b.o&&b.o(a)})}notify(a){let b=a.name;a=a.event;"keydown"==b&&this.ma?this.ma(a):"keyup"==b&&this.X?this.X(a):"mousemove"==b&&this.Pb||("click"==b&&this.click?this.click(a):"control"==b&&this.control?this.control(a.key):"controlts"==b&&this.mb?this.mb(a.key):"controlte"==
b&&this.lb?this.lb(a.key):console.log(b))}Pb(){}X(a){this.control(a.key)}}const Ba=Math.PI,ea=(a,b=document)=>b.querySelector(a),ha=(a=1,b=0)=>0|((c=1,d=0)=>d+(c-d)*Math.random())(a,b),q=(a=0,b=0)=>{let c=document.createElement("canvas");return c.width=a,c.height=b,c},O=(a,b,c=!0)=>((d,e,f=!0)=>{var h,k,l,p;f&&0!=e%(Math.PI/4)?(l=d.width,p=d.height,h=k=Math.sqrt(l*l+p*p)):(h=d.width,k=d.height);f=q(h,k);l=f.getContext("2d");h/=2;k/=2;return l.imageSmoothingQuality="high",l.save(),l.translate(h,k),
l.rotate(e),l.drawImage(d,0,0,d.width,d.height,-d.width/2,-d.height/2,d.width,d.height),l.restore(),f})(a,(b%=8)*Ba/4,c),U=(a,b,c,d,e)=>{let f=q(d,e);return f.getContext("2d").drawImage(a,b,c,d,e,0,0,d,e),f},g=(a,b=1,c=null)=>{let d=a.length,e=Math.max(...a.map(l=>l.length));var f=q(e*b,d*b),h=f.getContext("2d");for(let l=0;l<d;l++)for(let p=0;p<e;p++){var k=a[l][p];c&&(k=c(k));k&&""!=k&&(h.fillStyle=k,h.fillRect(p*b,l*b,b,b))}return f},V=(a,b)=>{for(var c=a.getContext("2d").getImageData(0,0,a.width,
a.height).data,d=[],e=0;e<c.length;e+=4){var f=d,h=f.push;var k=c[e];var l=c[e+1],p=c[e+2];k=0==k+l+p+c[e+3]?null:0==k+l+p||255<k||255<l||255<p?"#000000":"#"+((k<<16)+(l<<8)+p).toString(16).padStart(6,"0");h.call(f,k)}c=[];for(e=0;e<a.height;e++)c[e]=[];f=e=0;for(h=0;h<d.length;h++)e>=a.width&&(f++,e=0),c[f][e]=d[h],b&&(c[f][e]=b(c[f][e])),e++;return c},w=(a,b,c="source-atop")=>{let d=q(a.width,a.height),e=d.getContext("2d");e.drawImage(a,0,0);e.globalCompositeOperation=c;for(c=0;c<a.width/b.width;c++)for(let f=
0;f<a.height/b.height;f++)e.drawImage(b,c*b.width,f*b.height);return d},ia=(a,b=!0)=>{let c=q(a.width,a.height),d=c.getContext("2d");return d.save(),b?(d.scale(-1,1),d.drawImage(a,0,0,-1*a.width,a.height)):(d.scale(1,-1),d.drawImage(a,0,0,a.width,-1*a.height)),d.restore(),c},F=a=>{var b=q(a[0].width,a[0].height),c=b.getContext("2d");for(let d in a)c.drawImage(a[d],0,0);return b};class B{constructor(){}static get(a,b,c,d,e="Arial",f=0,h=0){let k=q(1,1).getContext("2d");k.font=b+"px "+e;f=q(parseInt(f||
k.measureText(a).width||1),h||b+2);k=f.getContext("2d");k.font=b+"px "+e;k.fillStyle=c;k.fillText(a,0,b-2);d&&(f=w(f,d));a=q(f.width,f.height);b=a.getContext("2d");return b.fillStyle="#ffffff",b.drawImage(f,0,0),a}}var Ca=n(0,0,1,1),Da=n(1,0,1,1),Ea=n(2,0,1,1),Fa=n(3,0,1,1),Ga=n(4,0,1,1),ja=n(0,1,1,1),ka=n(1,1,1,1),la=n(2,1,1,1),Ha=n(3,1,1,1),ma=n(4,1,1,1),na=n(0,2,1,1),Ia=n(1,2,1,1),Ja=n(2,2,1,1),oa=n(0,3,1,1),pa=n(1,3,2,1),P=n(9,0,4,4),X=n(3,2,2,2),Y=n(0,4,2,2),qa=n(2,4,2,2),ra=n(4,4,1,2),Ka=n(5,
4,1,2),La=n(6,4,1,2),sa=n(7,4,2,2),ta=n(9,4,2,2),Z=n(5,0,2,2),aa=n(5,2,2,2),ua=n(7,0,2,2),va=n(7,2,2,2),Ma=n(11,4,1,1),Na=n(0,6,2,2),Oa=n(2,6,2,2),Pa=n(4,6,2,2),Qa=n(6,6,2,2),Ra=n(8,6,2,2),Sa=n(10,6,2,2),E=g(Ca,1),G=g(Da,1),K=g(Ea,1),H=g(Fa,1),ba=g(Ga,1);g(ja,1);g(ka,1);g(la,1);var ca=g(Ha,1);g(ma,1);g(na,1);g(Ia,1);g(Ja,1);g(oa,1);g(pa,1);g(P,1);g(X,1);var Ta=g(Y,1);g(qa,1);g(ra,1);g(Ka,1);g(La,1);g(sa,1);g(ta,1);g(Z,1);g(aa,1);g(ua,1);g(va,1);var Ua=g(Ma,1),da=g(Na,1),Va=g(Oa,1),Wa=g(Pa,1),Xa=g(Qa,
1),Ya=g(Ra,1),Za=g(Sa,1);g(P,2);g(Z,2);g(aa,2);g(X,2);class $a{constructor(a,b=2){this.h=a;a=g(P,b);b=V(a);var c=b.flat(),d=[...(new Set(c))];c={};for(f of d)for(c[f]=[],d=0;d<b.length;d++){c[f].push([]);for(var e=0;e<b[d].length;e++)b[d][e]===f?c[f][d][e]="#000000":c[f][d][e]=null}var f=(delete c.sc,c);var h=g(f["#6a6a6a"]),k=g(f["#c2c2c2"]);f=w(h,t(E,.5));b=w(h,t(G,.5));c=w(h,t(K,.5));d=w(h,t(ba,.5));e=w(h,t(H,.5));h=w(h,t(ca,.5));var l=w(k,t(E,.2)),p=w(k,t(G,.2)),y=w(k,t(K,.2)),C=w(k,t(ba,.2)),
D=w(k,t(H,.2));k=w(k,t(ca,.2));this.sa=F([a,l,f]);this.ya=F([a,p,b]);this.da=F([a,y,c]);this.kb=F([a,C,d]);this.ib=F([a,D,e]);this.Ua=F([a,k,h])}update(a){this.time=a}}class ab extends W{constructor(a){super(a);a=u(E,G);var b=u(H,E);this.T=new $a(this);this.i=g(Y,2);this.xa=function(c,d,e,f,h=1){1<h&&(c=v(c,h),d=v(d,h));c=u(c,d);d=q(c.width*f,c.height*e);h=d.getContext("2d");for(let k=0;k<e;k++)for(let l=0;l<f;l++)h.drawImage(c,k*c.height,l*c.width);return d}(a,b,this.u.canvas.width/8,this.u.canvas.height/
8);this.xa=t(this.xa,.2);this.log=this.Bb();this.buffer=this.ua();this.Y=-20;this.za=this.Ab()}Bb(){var a=q(400,200),b=a.getContext("2d"),c=u(E,G),d=u(H,H),e=u(G,K),f=u(K,E);return this.R=[B.get("13th CENTURY\u2122",20,"green",f,"Arial Black"),B.get("ROBIN\u27b8HOOD ",40,"green",c,"Arial Black"),B.get("THE\u27b8OUTLAW ",28,"green",d,"Arial Black"),B.get("\u26051370s\u2235\u2234\u2235\u2234\u2235\u2234\u2235\u2234\u2235\u2234\u2235\u2234\u22352023\u2605",15,"green",e,"Arial Black")],b.drawImage(m(this.R[0],
"white"),0,1),b.drawImage(this.R[0],1,1),b.drawImage(m(this.R[1],"red"),1,18),b.drawImage(this.R[1],0,17),b.drawImage(m(this.R[2],"white"),85,53),b.drawImage(this.R[2],85,52),b.drawImage(this.R[3],82,82),a}Ab(){var a="you step into the legendary shoes of Robin Hood.;your mission is to make the world a better place.;- explore forest and hunt animals;- do quests and trade with merchants;- spread the wealth to the poor;- improve your stats and defend the village;a w s d / arrows for movement;e interact, q menue, space fire;explore forest hunt animal;trade with merchants;- give goodies to villagers for free (gain morale);- take quests from villagers for extra love;find old wizzard for a magic bow;more instructions can be learned in game".split(";"),
b=q(360,500);let c=b.getContext("2d");c.fillStyle="white";c.font="16px Arial";for(let d=0;d<a.length;d++)c.fillText(a[d],0,25*d+20);return b}update(a){this.time=a;this.Y+=.8}ua(){let a=q(this.u.C.width,this.u.C.height),b=a.getContext("2d");b.drawImage(this.xa,0,0);return b.drawImage(this.log,400>this.u.C.width?16:128,74),a}o(a){let b=20;a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.drawImage(this.buffer,0,0);a.fillStyle="green";
a.font="16px Arial";a.fillText("Time "+this.time,20,b);a.fillText("use any key to load menu ",20,b+20);a.drawImage(this.T.sa,16,192);a.drawImage(this.T.ya,88,192);a.drawImage(this.T.da,160,192);a.drawImage(this.T.kb,232,192);a.drawImage(this.T.ib,304,192);a.drawImage(this.T.Ua,376,192);a.drawImage(this.i,16,320);a.drawImage(U(this.za,0,this.Y%this.za.height,this.za.width,200),64,320)}ka(){100<this.Y&&this.u.Ha();this.Y=100}control(){this.ka()}click(){this.ka()}ma(){this.ka()}X(){this.ka()}}class bb{constructor(a,
b=300,c=!0,d=!0,e=3){this.I=a;this.jc=b;this.loop=e;this.pitch=d;this.$=!1;this.L=new AudioContext;this.Ya=this.I;c&&this.start()}toggle(){this.$?this.stop():this.start()}start(){this.$=!0;this.cb()}stop(){this.$=!1}reset(){this.I=this.Ya}Fb(a){switch(a){case "B":return 493.88;case "C":return 261.63;case "D":return 293.66;case "E":return 329.63;case "F":return 349.23;case "G":return 392}return 440}xb(a){var b=this.Fb(a[0]);return 1<a.length?b*Math.pow(2,a[1]/12):b}cb(){if(this.$)if(0===this.I.length&&
0<this.loop&&(this.I=this.Ya,this.loop--),0===this.I.length)this.stop();else{var a=this.I[0];this.pitch?(this.I[1],this.I=this.I.slice(2)):this.I=this.I.slice(1);var b=this.L.createOscillator(),c=this.L.createGain();b.connect(c);c.connect(this.L.destination);b.frequency.setValueAtTime(this.xb(a),this.L.currentTime);b.start();c.gain.setValueAtTime(0,this.L.currentTime);c.gain.exponentialRampToValueAtTime(.05,this.L.currentTime+.02);setTimeout(()=>{c.gain.setValueAtTime(.05,this.L.currentTime);c.gain.exponentialRampToValueAtTime(.001,
this.L.currentTime+.02);b.stop(this.L.currentTime+.02);this.cb()},60/this.jc*1E3)}}}class cb extends W{constructor(a){super(a);this.B={ib:H,da:K,ya:G,sa:E,Ua:ca,i:Ta};a=400>this.u.C.width?32:100;this.v=[{x:a,y:128},{x:a,y:160},{x:a,y:192},{x:a,y:224},{x:a,y:256}];this.Z="robin hood";this.D=0;this.ca=!1;this.buffer=this.ic()}ic(){var a=q(this.u.C.width,this.u.C.height);return a.getContext("2d"),a}update(a){this.time=a}o(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,
0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,0);a.drawImage(B.get("\u2588 \u24c5\u24c1\u24b6\u24ce \u24bc\u24b6\u24c2\u24ba",24,"green",this.B.ya,"Verdana"),this.v[0].x+20,this.v[0].y);a.drawImage(B.get("\u2588 SOUND : "+(this.ca&&1==this.ca?"on":"off"),24,"green",this.B.da,"Verdana"),this.v[1].x+20,this.v[1].y);a.drawImage(B.get("\u2588 Music : "+(this.V&&this.V.$?"on":"off"),24,"green",this.B.da,"Verdana"),this.v[2].x+20,this.v[2].y);a.drawImage(B.get(`\u2588 NAME : ${this.Z}`,
24,"green",this.B.da,"Verdana"),this.v[3].x+20,this.v[3].y);a.drawImage(B.get("\u2588 STATS \u32e1",24,"green",this.B.sa,"Roboto"),this.v[4].x+20,this.v[4].y);a.drawImage(this.B.i,this.v[this.D].x,this.v[this.D].y+4);a.fillText("Time "+this.time,20,20)}click(){}control(a){if("s"===a||"ArrowDown"===a)a=this.D+1,this.D=(0>a?-a:a)%this.v.length;else if("w"===a||"ArrowUp"===a)a=this.D-1,this.D=(0>a?-a:a)%this.v.length;else if("a"===a||"ArrowLeft"===a||"d"===a||"ArrowRight"===a||"space"===a||" "===a)0==
this.D?this.u.lc():1==this.D?this.ca?this.ca=!1:this.ca=!0:2==this.D?(this.V||(this.V=new bb("E4E4D4E4E4D4E4G4G4A4A4E4E4D4E4E4D4E4G4G4A4A4G4G4E4E4D4E4E4D4E4A4A4",120,!1,!0,2E3)),this.V.toggle()):3==this.D?this.Z=(a=prompt("name",this.Z))&&0<a.length?a.substring(0,10):this.Z:4==this.D&&(this.V&&this.V.stop(),alert("under construction"))}ma(){}X(a){this.control(a.key)}}class r{constructor(a,b){this.x=a;this.y=b}is(a){let b=this.y,c=a.y;return this.x==a.x&&b==c}K(a){if(!a)return 1/0;let b=this.x,c=this.y,
d=a.x;a=a.y;if(b==d&&c==a)return 0;if(b==d)return Math.abs(c-a);if(c==a)return Math.abs(b-d);let e=0;return e+=Math.pow(b-d,2),e+=Math.pow(c-a,2),e=Math.sqrt(e),e}va(a){let b=this.x,c=this.y,d=a.x;a=a.y;return b==d&&c==a?4:b>d?6:b<d?2:c<a?4:c>a?0:4}Wa(a,b){let c=this.clone();return c.move(a,b),c}move(a,b){0==a?this.y-=b:4==a?this.y+=b:6==a?this.x-=b:2==a?this.x+=b:7==a?(this.y-=b,this.x-=b):1==a?(this.y-=b,this.x+=b):3==a?(this.y+=b,this.x+=b):5==a&&(this.y+=b,this.x-=b)}Wa(a,b){let c=this.clone();
return c.move(a,b),c}Rb(a,b){let c=a.x-this.x,d=a.y-this.y,e=Math.sqrt(c*c+d*d);e<b?(this.x=a.x,this.y=a.y):(this.x+=(c/e||0)*b,this.y+=(d/e||0)*b)}clone(){return new r(this.x,this.y)}o(a,b="red"){a.fillStyle=b;this.ta(a,3,b)}ta(a,b=4,c="green"){a.fillStyle=c;a.strokeStyle=c;a.beginPath();a.arc(this.x,this.y,b,0,2*Math.PI);a.fill()}static ta(a,b,c,d=1,e="green"){a.fillStyle=e;a.strokeStyle=e;a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.fill()}}const Q=[{S:25,attack:1,j:1,name:"rabbit"},{S:25,attack:4,
j:5,name:"wolf"},{S:25,attack:10,j:8,name:"deer"},{S:25,attack:20,j:10,name:"bear"},{S:25,attack:15,j:10,name:"npcman"},{S:25,attack:10,j:10,name:"npcgirl"}];class L{constructor(a,b=0,c=null){this.type=b;this.h=a;this.B=this.W();this.l=this.B[this.type];this.g=c||a.qb();this.j=Q[this.type].j;this.U=Q[this.type].j;this.Da=Q[this.type].S;this.O=[]}Qb(){var a=this.h.m;const b=this.h.ab.Qa(this.g.x/a,this.g.y/a,this.h.i.g.x/a,this.h.i.g.y/a);b&&2<=b.length?this.g=new r(b[1][0]*a,b[1][1]*a):console.log("no visible path to player")}update(a){this.time=
a;this.Da--;0>=this.Da&&(this.Da=Q[this.type].S-this.h.ra,this.Qb(),this.g.K(this.h.i.g)<2*this.h.m&&(this.h.i.j-=this.type+1,this.h.i.hb=10))}wa(){var a=q(this.l.width,3),b=a.getContext("2d");b.fillStyle="green";return b.fillRect(0,0,this.j/this.U*this.l.width,3),a}o(a){a.drawImage(this.l,this.g.x,this.g.y);this.j<this.U&&a.drawImage(this.wa(),this.g.x,this.g.y)}W(){if(L.P)return L.P;var a=this.h.N,b=this.h.m,c=z(g(oa,a),b,b,!1),d=z(g(pa,a),b,b,!1),e=z(g(ta,a),b,b,!1),f=g(sa,a),h=g(ua,a),k=g(va,
a);a=g(ja,a);this.H=this.w=b;return L.P=[c,d,e,f,h,k,a],L.P}}const R=[{n:"tree",A:1,c:"#0d3702"},{n:"brick",A:1,c:"#bf0a0a"},{n:"dirt",A:0,c:"#d9a066"},{n:"grass",A:0,c:"#99e550"},{n:"water",A:2,c:"#8a99f6"},{n:"steel",A:1,c:"#6a6a6a"},{n:"snow",A:0,c:"#dcdcdc"},{n:"player",A:0,c:"#130c40"},{n:"army",A:0,c:"#ff0000"},{n:"cave",A:1,c:"#2e2b2b"},{n:"deerspawnpoint",A:0,c:"#df7126"},{n:"rabbitspawnpoint",A:0,c:"#d1d1d1"},{n:"wolfspawnpoint",A:0,c:"#898898"}],M=a=>{switch(a){case "#130c40":return"player";
case "#df7126":return"spawner_deer";case "#d1d1d1":return"spawner_rabbit";case "#898898":return"spawner_wolf";default:return null}};class db{constructor(a,b=1){this.$b=v(E,4);this.ac=v(G,4);this.hc=v(K,4);this.dc=v(Ua,4);this.Xb=v(ba,4);this.ec=v(H,4);this.fc=g(ma,4);this.Yb=g(P,4);this.bc=g(Z,4);this.cc=g(aa,4);this.Zb=g(X,4);this.ja=a;this.na=[0,0];this.J=[];this.Vb=[];this.Hb(b);this.Ea=this.Gb()}Gb(){var a={};for(var b in R)a[R[b].c]=R[b].A;b=[];for(var c=0;c<this.J.length;c++){b[c]=[];for(var d=
0;d<this.J[c].length;d++){var e=a[this.J[d][c]];b[c][d]=null!=e&&0==e?0:1}}return b}Aa(a,b){return(a=Math.floor(a),b=Math.floor(b),0>a)||a>this.J.length-1||0>b||b>this.J.length-1||!this.J[a]?!0:this.Kb(this.J[b][a])}Kb(a){var b=R.find(c=>c.c==a);return null==b?1:b.A}Db(){var a=da.width,b=q(3*a,3*da.height),c=b.getContext("2d");for(let d=0;3>d;d++)for(let e=0;3>e;e++)c.drawImage(Wa,d*a,e*a);return c.drawImage(Xa,a,0),c.drawImage(Ya,2*a,2*a),c.drawImage(Za,2*a,a),c.drawImage(Va,0,0),c.drawImage(da,
a,a),b}Cb(a,b=32){var c=[],d=[],e={},f=a.length,h=a[0].length;c=Array(f).fill(null).map(()=>Array(h).fill(null));d=Array(f).fill(null).map(()=>Array(h).fill(null));var k=new r(32,32);fa(a,(l,p,y)=>{c[p][y]=(C=>{switch(C){case "#99e550":return"grass";case "#d9a066":return"dirt";case "#dcdcdc":return"snow";case "#8a99f6":return"water";default:return null}})(l)||"grass";d[p][y]=(C=>{switch(C){case "#0d3702":return"tree";case "#bf0a0a":return"brick";case "#6a6a6a":return"steel";case "#a9a9a9":return"castle";
case "#fbf236":return"house";case "#eca732":return"shop";case "#2e2b2b":return"cave";default:return null}})(l)||null;e[M(l)]||(e[M(l)]=[]);M(l)&&(e[M(l)].push([p,y]),"player"==M(l)&&(k=new r(p*b,y*b)))});a=this.Na(c,b);f=this.Na(d,b);return{wc:c,tc:d,kc:a,Sb:f,rc:e,Ub:k}}Na(a,b=32){var c=q(a.length*b,a.length*b),d=c.getContext("2d");return fa(a,(e,f,h)=>{var k=e?this.zb(e):null;e&&k&&d.drawImage(k,h*b,f*b)}),c}zb(a){switch(a){case "dirt":return this.$b;case "grass":return this.ac;case "water":return this.hc;
case "snow":return this.dc;case "brick":return this.Xb;case "steel":return this.ec;case "tree":return this.fc;case "castle":return this.Yb;case "house":return this.bc;case "shop":return this.cc;case "cave":return this.Zb;default:return null}}Hb(a=1){var b=this.Db();this.map=b;a*=16;this.J=b=V(b);this.Lb=b=this.Cb(b,a);this.na=this.Lb.Ub;this.Nb=F([b.kc,b.Sb])}}class eb{constructor(a,b,c,d,e){this.Ra=a;this.g=new r(0,0);this.H=c;this.w=b;this.Za=d;this.$a=e}ub(a){this.g=new r(a.x,a.y)}Mb(a){this.g=
a}move(a){this.g.move(a,32)}vb(a){var b=this.g.x-this.w/2,c=this.g.y-this.H/2;return U(a,0>b?0:b,0>c?0:c,this.w,this.H)}o(a,b){let c;let d,e,f,h,k,l;var p=this.g.y-this.H/2;c=this.g.x-this.w/2;0>=c&&(c=0,this.g.x=c+this.w/2);0>=p&&(p=0,this.g.y=p+this.H/2);c+this.w>b.width&&(c=b.width-this.w,this.g.x=c+this.w/2);p+this.H>b.height&&(p=b.height-this.H,this.g.y=p+this.H/2);f=this.Za;h=this.$a;d=k=this.w;e=l=this.H;a.drawImage(b,c,p,d,e,f,h,k,l)}yb(a,b,c=32){var d=this.g.x-this.w/2,e=this.g.y-this.H/
2;a=a+(0>d?0:d)-this.Za;b=b+(0>e?0:e)-this.$a;return a=Math.floor(a/c)*c,b=Math.floor(b/c)*c,new r(a,b)}}class fb{constructor(){this.Ia=8}}class wa{constructor(a){this.g=new r(a.x,a.y);this.j=1}o(a){a.drawImage(this.l,this.g.x,this.g.y)}}class N extends wa{constructor(a){super(a.g);this.e=a;this.direction=a.direction;this.B=this.W();this.l=this.B[this.direction];this.width=this.l.width;this.height=this.l.height;this.speed=this.width;this.nb=this.e.attributes.Ia*this.speed/20;this.Xa=0;this.j=1}update(a){this.time=
a;this.Xa++;this.Xa<this.nb?(this.g.move(this.direction,this.speed),this.e.jb(this)):this.j=0}W(){if(N.P)return N.P;var a=this.e.h.N,b=16*a,c=z(g(la,a),b,b);a=O(c,0);b=O(c,2);var d=O(c,4);c=O(c,6);this.w=a.width;this.H=a.height;return N.P=[c,c,a,a,b,b,d,c],N.P}}class S extends wa{constructor(a,b,c=1){super(b);this.h=a;this.value=c;this.l=this.wb()}update(a){this.time=a;this.g.K(this.h.i.g)<1.5*this.h.m&&(this.h.i.pa+=this.value,this.j=0)}o(a){super.o(a)}wb(){if(S.Ka)return S.Ka;var a=this.h.m;a=z(g(na,
this.h.N),a,a,!1);return S.Ka=a,a}}class gb{constructor(a){this.h=a;this.j=this.U=100;this.pa=this.aa=0;this.attributes=new fb(1);this.g=new r(0,0);this.destination=new r(0,0);this.la=!1;this.time=0;this.direction=4;this.B=this.W();this.l=this.B[4];this.ia=0;this.ba=[];this.Ja=1E3;this.fb=256}setPosition(a){this.g=new r(a.x,a.y);this.destination=new r(a.x,a.y)}update(a){this.ia=Math.max(this.ia-1,0);this.ba=this.ba.filter(b=>0<b.j);[...this.ba].forEach(b=>{b.update&&b.update(a)});this.time=a;0!=this.g.K(this.destination)?
(this.la=!0,this.g.Rb(this.destination,this.l.width/2),this.h.ga.ub(this.g)):this.la=!1;this.s=this.h.s.filter(b=>b.g.K(this.g)<this.fb);0<this.s.length&&[...this.s].forEach(b=>{b.update&&b.update(this.time)})}tb(){0<this.ia||(this.ia=20-2*this.attributes.Ia,this.Ja--,this.ba.push(new N(this)),this.Tb())}jb(a){var b=a.g;b=this.h.G.Aa(b.x/this.h.m,b.y/this.h.m);1!=b&&1!=b||2==b||(a.j=0,this.bb());for(let c=0;c<this.h.s.length;c++)b=this.h.s[c],b.g.K(a.g)<this.h.m&&null!=b.type&&(b.j-=a.j,0>=b.j&&(this.h.s.push(new S(this.h,
b.g,b.type+1)),4==b.type||5==b.type?this.aa-=b.type+1:this.aa+=b.type+1),this.bb(),a.j=0)}wa(){var a=q(this.l.width,3),b=a.getContext("2d");b.fillStyle="green";this.j<this.U/2&&(b.fillStyle="orange");this.j<this.U/2&&(b.fillStyle="red");return b.fillRect(0,0,this.j/this.U*this.l.width,3),a}o(a){a.drawImage(this.l,this.g.x,this.g.y);4==this.direction?a.drawImage(this.M,this.g.x+this.l.width-this.M.width,this.g.y+this.l.height-1.5*this.M.height):6==this.direction?a.drawImage(ia(this.M),this.g.x+this.l.width-
1.6*this.M.width,this.g.y+this.l.height-1.3*this.M.height):2==this.direction&&a.drawImage(this.M,this.g.x+this.l.width-1.2*this.M.width,this.g.y+this.l.height-1.3*this.M.height);[...this.ba].forEach(b=>{b.o&&b.o(a)});a.drawImage(this.wa(),this.g.x,this.g.y);0<this.hb&&(a.fillStyle="#ff0000aa",a.fillRect(this.g.x,this.g.y,this.l.width,this.l.height),this.hb--);this.ob(a)}gb(a,b){this.direction=a=this.g.va(new r(a,b));this.l=this.B[a]}moveTo(a,b){if(!this.h.qa(a,b)){var c=this.g.va(new r(a,b));this.direction=
c;0!=this.g.K(new r(a,b))&&(this.l=this.B[c],this.move(c))}}move(a){a===this.direction?this.la||this.destination.move(a,this.width):this.direction=a}W(){this.M=g(ka,this.h.N);var a=g(Y,this.h.N),b=g(qa,this.h.N),c=g(ra,this.h.N);return this.width=a.width,this.height=a.height,[b,b,c=z(c,this.width,this.height),a,a,a,ia(c,!0),b]}Tb(){const a=new (window.AudioContext||window.webkitAudioContext),b=a.createOscillator();b.type="sawtooth";b.frequency.setValueAtTime(500,a.currentTime);const c=a.createGain();
c.gain.setValueAtTime(.2,a.currentTime);const d=a.createBiquadFilter();d.type="lowpass";d.frequency.setValueAtTime(500,a.currentTime);b.connect(c);c.connect(d);d.connect(a.destination);b.start();c.gain.exponentialRampToValueAtTime(.01,a.currentTime+.5);b.stop(a.currentTime+1)}bb(){const a=new (window.AudioContext||window.webkitAudioContext),b=a.createOscillator();b.type="square";b.frequency.setValueAtTime(400,a.currentTime);const c=a.createGain();c.gain.setValueAtTime(.2,a.currentTime);const d=a.createBiquadFilter();
d.type="lowpass";d.frequency.setValueAtTime(400,a.currentTime);b.connect(c);c.connect(d);d.connect(a.destination);b.start();c.gain.exponentialRampToValueAtTime(.01,a.currentTime+.5);b.stop(a.currentTime+1)}ob(a){a.beginPath();a.arc(this.g.x+this.l.width/2,this.g.y+this.l.width/2,this.fb,0,2*Math.PI,!1);a.strokeStyle="red";a.stroke()}}class hb{constructor(a){this.Ob=a;this.rows=a.length;this.cols=a[0].length}Qa(a,b,c,d){a=Math.floor(a);b=Math.floor(b);c=Math.floor(c);d=Math.floor(d);const e=[],f=new Set,
h={},k=Array(this.rows).fill(null).map(()=>Array(this.cols).fill(1/0));k[a][b]=0;const l=Array(this.rows).fill(null).map(()=>Array(this.cols).fill(1/0));l[a][b]=this.Ta(a,b,c,d);for(e.push([a,b]);0<e.length;){a=this.rb(e,l);const [p,y]=a;if(p===c&&y===d)return this.Wb(h,a);e.splice(e.indexOf(a),1);f.add(`${p}-${y}`);b=this.Eb(p,y);for(const C of b){const [D,I]=C;f.has(`${D}-${I}`)||this.Ob[D][I]||(b=k[p][y]+1,b<k[D][I]&&(h[`${D}-${I}`]=a,k[D][I]=b,l[D][I]=b+this.Ta(D,I,c,d),e.includes(C)||e.push(C)))}}return null}Ta(a,
b,c,d){return Math.abs(a-c)+Math.abs(b-d)}rb(a,b){let c=a[0],d=b[c[0]][c[1]];for(const e of a){const [f,h]=e;b[f][h]<d&&(c=e,d=b[f][h])}return c}Eb(a,b){const c=[];return 0<a&&c.push([a-1,b]),a<this.rows-1&&c.push([a+1,b]),0<b&&c.push([a,b-1]),b<this.cols-1&&c.push([a,b+1]),c}Wb(a,b){const c=[b];for(;a.hasOwnProperty(`${b[0]}-${b[1]}`);)b=a[`${b[0]}-${b[1]}`],c.unshift(b);return c}}class ib extends W{constructor(a){super(a);this.Ib()}Ib(){this.ra=1;this.ea=5;this.N=2;this.m=16*this.N;this.keyboard=
{};this.G=new db(this,this.N);this.Ca=t(this.G.map,.7);this.i=new gb(this);this.i.setPosition(this.G.na?this.G.na:new r(224,224));this.ga=new eb(this,this.u.C.width,this.u.C.height,0,0);this.ga.Mb(this.i.g);this.Z="robin hood";this.s=[...this.G.Vb];this.Ea=this.G.Ea;this.ab=new hb(this.Ea);this.oc=this.sb();this.Pa();this.La()}Sa(a,b){a=Math.floor(a);b=Math.floor(b);a=new r(a,b);for(let c=0;c<this.s.length;c++)if(b=this.s[c],b.g.K(a)<this.m)return b;return null}qa(){}qa(a,b){return null!=this.Sa(a,
b)||this.G.Aa(a/this.m,b/this.m)}ua(){var a=q(this.u.C.width,this.u.C.height);let b=a.getContext("2d");b.clearRect(0,0,b.canvas.width,b.canvas.height);b.fillStyle="black";b.fillRect(0,0,b.canvas.width,b.canvas.height);var c=(e=>{if(!e)return null;let f=q(e.width,e.height);return f.getContext("2d").drawImage(e,0,0),f})(this.G.Nb),d=c.getContext("2d");if([...this.s].forEach(e=>{e.o&&e.o(d)}),this.i.o(d),this.O)for(let e in this.O)b.drawImage(t(this.i.l,.8),this.O[e][0]*this.m,this.O[e][1]*this.m);c=
this.ga.vb(c);return b.drawImage(c,0,0),a}update(a){this.time=a;this.s=this.s.filter(b=>0<b.j);this.i.update(a);for(let b in this.keyboard)this.keyboard[b]&&this.Ma(b);if(0>=this.i.j&&(alert("game over"),this.u.ja=null,this.i.j=100,this.u.Ha()),this.O&&0<this.O.length)a=this.O.shift(),this.i.g=new r(a[0]*this.m,a[1]*this.m);0>=this.s.length&&(this.ea+=5,this.ra++,this.La())}La(){for(let a=0;a<this.ea&&!(this.s.length>this.ea);a++){let b=new L(this,ha(0,3));this.s.push(b)}}sb(){var a=[];for(let c=
0;c<this.G.J.length;c++)for(let d=0;d<this.G.J.length;d++){var b=new r(c*this.m,d*this.m);this.G.Aa(c,d)||a.push(b)}return a}qb(){var a=this.Pa(8,25);return 0<a.length?a[ha(0,a.length)]:new r(this.m,this.m)}Pa(a=8,b=13){var c=this.oc;c=(c=c.filter(f=>f.K(this.i.g)>this.m*a)).filter(f=>f.K(this.i.g)<this.m*b);var d=[];for(let f in c){var e=!0;for(let h=0;h<this.s.length;h++)if(this.s[h].g.K(new r(c[f].x,c[f].y))<this.m){e=!1;break}e&&d.push(c[f])}return c}Jb(){var a=this.i.g.Wa(this.i.direction,this.m);
a=this.Sa(a.x,a.y);console.log(a)}Ma(a){if(" "!==a&&"space"!==a||this.i.tb(),"e"===a)this.Jb(),this.keyboard={};else if("q"===a)this.keyboard.q=!1,this.u.Ha();else if(!this.i.la){var b=this.i.g.clone(),c=!1;"s"===a||"ArrowDown"===a?(b.move(4,this.i.height),c=!0):"w"===a||"ArrowUp"===a?(b.move(0,this.i.height),c=!0):"d"===a||"ArrowRight"===a?(b.move(2,this.i.height),c=!0):"a"!==a&&"ArrowLeft"!==a||(b.move(6,this.i.height),c=!0);c&&(this.i.g.va(b)!=this.i.direction?(this.i.gb(b.x,b.y),this.keyboard=
{}):this.qa(b.x,b.y)?this.i.gb(b.x,b.y):this.i.moveTo(b.x,b.y))}}o(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.ua(),0,0);a.fillStyle="#004b52d6";a.fillRect(0,0,a.canvas.width,32);a.fillStyle="#ffffff";a.fillText("\u2665 "+J(this.i.j),15,15);a.fillText("\u2295 "+J(this.i.aa),15,30);a.fillText("\u27b9\t"+J(this.i.Ja),96,15);a.fillText("\u0556\t"+J(this.i.pa),96,30);a.fillText("Mobs "+
J(this.s.length),192,15);a.fillText("LVL "+J(this.ra),192,30);a.drawImage(this.Ca,0,a.canvas.height-this.Ca.height);r.ta(a,this.i.g.x/this.m,a.canvas.height-this.Ca.height+this.i.g.y/this.m,3,"green")}click(a){var b=this.m;a=this.ga.yb(a.offsetX,a.offsetY,b);a=new r(a.x,a.y);this.O=b=this.ab.Qa(this.i.g.x/b,this.i.g.y/b,a.x/b,a.y/b);console.log(b)}control(a){this.Ma(a)}ma(a){this.keyboard[a.key]=!0}X(a){this.keyboard[a.key]=!1}}class jb{constructor(a){return this.target=a,this.Ga=[],!!a.addEventListener}sub(a){this.Ga.push(a)}clear(){this.Ga=
[]}fireEvent(a){var b=this.Ga,c;for(c in b)b[c].notify&&b[c].notify(a)}}class kb{constructor(a){this.C=a;this.ha=document.querySelector(a.ha);this.canvas=Object.assign(document.createElement("canvas"),{width:a.width,height:a.height,className:"gamecanvas"});this.ha.appendChild(this.canvas);this.F=new jb(document);["keydown","keyup"].forEach(b=>{document.addEventListener(b,c=>{this.F.fireEvent({name:b,event:c})})});this.canvas.addEventListener("click",b=>{this.F.fireEvent({name:"click",event:b})});
this.mc();400>this.C.width&&(a.framerate/=2);this.oa=new Aa(a.framerate,this,!0);this.pb()}update(a){if(0==this.oa.p)if(this.time=a,this.h)try{this.h.update(a),this.h.o(this.canvas.getContext("2d"))}catch(b){console.log(b),this.oa.stop()}else this.oa.stop()}mc(){this.h=new ab(this);this.F.clear();this.F.sub(this.h)}Ha(){this.Va||(this.Va=new cb(this));this.h=this.Va;this.F.clear();this.F.sub(this.h)}lc(){this.ja||(this.ja=new ib(this));this.h=this.ja;this.F.clear();this.F.sub(this.h)}pb(){if(!(400<
this.C.width)){var a=Object.assign(document.createElement("div"),{className:"controls_container"});a.innerHTML="<table>\n        <tr><td id='q'>q</td><td id='w'>w</td><td id='e'>e</td><td class=\"padding\"></td><td id='space'>space</td> </tr>\n        <tr><td id='a'>a</td><td id='s'>s</td><td id='d'>d</td><td class=\"padding\"></td><td id='f'>f</td></tr></table>";this.ha.appendChild(a);var b=((c,d=document)=>d.querySelectorAll(c))(".controls_container td");for(let c=0;c<b.length;c++)b[c].addEventListener("click",
()=>{this.F.fireEvent({name:"control",event:{key:b[c].id}})}),b[c].addEventListener("touchstart",()=>{this.F.fireEvent({name:"controlts",event:{key:b[c].id}})}),b[c].addEventListener("touchend",()=>{this.F.fireEvent({name:"controlte",event:{key:b[c].id}})})}}}const lb={ha:".canvas_container",vc:32,pc:1,framerate:1/30,width:32*parseInt(window.innerWidth/32),height:576,qc:"Assets",uc:ea("#spriteSheetMain")};class mb extends kb{constructor(a){super(a)}}document.addEventListener("DOMContentLoaded",function(){window.Ra||
(window.Ra=new mb(lb))},!1)})();
