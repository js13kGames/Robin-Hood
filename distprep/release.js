var da="function"==typeof Object.defineProperties?Object.defineProperty:function(p,x,y){if(p==Array.prototype||p==Object.prototype)return p;p[x]=y.value;return p};function ea(p){p=["object"==typeof globalThis&&globalThis,p,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var x=0;x<p.length;++x){var y=p[x];if(y&&y.Math==Math)return y}throw Error("Cannot find global object");}var fa=ea(this);
function D(p,x){if(x)a:{var y=fa;p=p.split(".");for(var w=0;w<p.length-1;w++){var F=p[w];if(!(F in y))break a;y=y[F]}p=p[p.length-1];w=y[p];x=x(w);x!=w&&null!=x&&da(y,p,{configurable:!0,writable:!0,value:x})}}function I(p){p=Math.trunc(p)||0;0>p&&(p+=this.length);if(!(0>p||p>=this.length))return this[p]}D("Array.prototype.at",function(p){return p?p:I});function U(p){return p?p:I}D("Int8Array.prototype.at",U);D("Uint8Array.prototype.at",U);D("Uint8ClampedArray.prototype.at",U);
D("Int16Array.prototype.at",U);D("Uint16Array.prototype.at",U);D("Int32Array.prototype.at",U);D("Uint32Array.prototype.at",U);D("Float32Array.prototype.at",U);D("Float64Array.prototype.at",U);D("String.prototype.at",function(p){return p?p:I});
(()=>{function p(a,b,c="source-atop"){let d=v(a.width,a.height),e=d.getContext("2d");return e.drawImage(a,0,0),e.globalCompositeOperation=c,e.fillStyle=b,e.fillRect(0,0,d.width,d.height),d}function x(a,b){let c=v(a.width+b.width,a.height+b.height),d=c.getContext("2d");return d.drawImage(a,0,0),d.drawImage(a,a.width,b.height),d.drawImage(b,a.width,0),d.drawImage(b,0,a.height),c}function y(a,b,c=0){0==c&&(c=b);var d=v(a.width*c,a.height*b),e=d.getContext("2d");for(let f=0;f<b;f++)for(let g=0;g<c;g++)e.drawImage(a,
g*a.width,f*a.height);return d}function w(a,b){let c=v(a.width,a.height),d=c.getContext("2d");return d.globalAlpha=b,d.drawImage(a,0,0),d.globalAlpha=1,c}function F(a,b,c,d=!1){var e=v(b,c),f=e.getContext("2d");return d&&f.fillRect(0,0,b,c),f.drawImage(a,b/2-a.width/2,c/2-a.height/2),e}function J(a){return 1E9<a?parseInt(a/1E6)+"B":1E6<a?parseInt(a/1E6)+"M":1E3<a?parseInt(a/1E3)+"K":a}function r(a,b,c,d){let e=X("#spriteSheetMain");a=V(e,8*a,8*b,8*c,8*d);return W(a,f=>"#ffffff"===f?"":f)}function Y(a,
b){for(var c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++)b(a[d][c],c,d)}class ha{constructor(a=1/30,b,c=!1){this.at=0;this.sb=null;this.Wb=a;this.t=b;c&&this.start();this.p=this.Jb=!1}td(a){if(this.sb)for(this.at+=(a-this.sb)/1E3,1<this.at&&(this.at=1);this.at>this.Wb;){this.t.update(Math.floor(a/1E3));this.at-=this.Wb;break}this.sb=a;this.Jb||this.lc()}lc(){requestAnimationFrame(a=>{this.td(a)})}start(){this.Jb=!1;this.lc()}stop(){this.Jb=!0}}class O{constructor(a){this.o=a;this.Ia=[]}update(a){this.time=
a;[...this.Ia].forEach(b=>{b.update&&b.update(a)});this.Ia=this.Ia.filter(b=>!b.delete)}s(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);[...this.Ia].forEach(b=>{b.s&&b.s(a)})}notify(a){let b=a.name;a=a.event;"keydown"==b&&this.za?this.za(a):"keyup"==b&&this.qa?this.qa(a):"mousemove"==b&&this.Xc||("click"==b&&this.click?this.click(a):"control"==b&&this.control?this.control(a.key):"controlts"==b&&this.tc?this.tc(a.key):"controlte"==
b&&this.sc&&this.sc(a.key))}Xc(){}qa(a){this.control(a.key)}}const ia=Math.PI,X=(a,b=document)=>b.querySelector(a),P=a=>0>a?-a:a,K=(a=1,b=0)=>0|((c=1,d=0)=>d+(c-d)*Math.random())(a,b),v=(a=0,b=0)=>{let c=document.createElement("canvas");return c.width=a,c.height=b,c},Q=(a,b,c=!0)=>((d,e,f=!0)=>{var g,l,m,q;f&&0!=e%(Math.PI/4)?(m=d.width,q=d.height,g=l=Math.sqrt(m*m+q*q)):(g=d.width,l=d.height);f=v(g,l);m=f.getContext("2d");g/=2;l/=2;return m.imageSmoothingQuality="high",m.save(),m.translate(g,l),
m.rotate(e),m.drawImage(d,0,0,d.width,d.height,-d.width/2,-d.height/2,d.width,d.height),m.restore(),f})(a,(b%=8)*ia/4,c),V=(a,b,c,d,e)=>{let f=v(d,e);return f.getContext("2d").drawImage(a,b,c,d,e,0,0,d,e),f},h=(a,b=1,c=null)=>{let d=a.length,e=Math.max(...a.map(m=>m.length));var f=v(e*b,d*b),g=f.getContext("2d");for(let m=0;m<d;m++)for(let q=0;q<e;q++){var l=a[m][q];c&&(l=c(l));l&&""!=l&&(g.fillStyle=l,g.fillRect(q*b,m*b,b,b))}return f},W=(a,b)=>{for(var c=a.getContext("2d").getImageData(0,0,a.width,
a.height).data,d=[],e=0;e<c.length;e+=4){var f=d,g=f.push;var l=c[e];var m=c[e+1],q=c[e+2];l=0==l+m+q+c[e+3]?null:0==l+m+q||255<l||255<m||255<q?"#000000":"#"+((l<<16)+(m<<8)+q).toString(16).padStart(6,"0");g.call(f,l)}c=[];for(e=0;e<a.height;e++)c[e]=[];f=e=0;for(g=0;g<d.length;g++)e>=a.width&&(f++,e=0),c[f][e]=d[g],b&&(c[f][e]=b(c[f][e])),e++;return c},B=(a,b,c="source-atop")=>{let d=v(a.width,a.height),e=d.getContext("2d");e.drawImage(a,0,0);e.globalCompositeOperation=c;for(c=0;c<a.width/b.width;c++)for(let f=
0;f<a.height/b.height;f++)e.drawImage(b,c*b.width,f*b.height);return d},Z=(a,b=!0)=>{let c=v(a.width,a.height),d=c.getContext("2d");return d.save(),b?(d.scale(-1,1),d.drawImage(a,0,0,-1*a.width,a.height)):(d.scale(1,-1),d.drawImage(a,0,0,a.width,-1*a.height)),d.restore(),c},L=a=>{var b=v(a[0].width,a[0].height),c=b.getContext("2d");for(let d in a)c.drawImage(a[d],0,0);return b};class C{constructor(){}static get(a,b,c,d,e="Arial",f=0,g=0){let l=v(1,1).getContext("2d");l.font=b+"px "+e;f=v(parseInt(f||
l.measureText(a).width||1),g||b+2);l=f.getContext("2d");l.font=b+"px "+e;l.fillStyle=c;l.fillText(a,0,b-2);d&&(f=B(f,d));a=v(f.width,f.height);b=a.getContext("2d");return b.fillStyle="#ffffff",b.drawImage(f,0,0),a}}let k={},n={};class M{static ya(){M.oc={L:r(0,0,1,1),H:r(1,0,1,1),K:r(2,0,1,1),S:r(3,0,1,1),T:r(4,0,1,1),Mb:r(0,1,1,1),I:r(1,1,1,1),cb:r(2,1,1,1),ba:r(3,1,1,1),Nb:r(4,1,1,1),gb:r(0,2,1,1),bb:r(1,2,1,1),rb:r(2,2,1,1),Hb:r(0,3,1,1),Pb:r(1,3,2,1),Ka:r(9,0,4,4),La:r(3,2,2,2),i:r(0,4,2,2),Fb:r(2,
4,2,2),Gb:r(4,4,1,2),kc:r(5,4,1,2),Ob:r(6,4,1,2),eb:r(7,4,2,2),hb:r(9,4,2,2),Sa:r(5,0,2,2),Xa:r(5,2,2,2),Va:r(7,0,2,2),Db:r(7,2,2,2),ka:r(11,4,1,1),zb:r(0,6,2,2),ub:r(2,6,2,2),vb:r(4,6,2,2),wb:r(6,6,2,2),xb:r(8,6,2,2),yb:r(10,6,2,2)};k=M.oc;M.pc={L:h(k.L,1),H:h(k.H,1),K:h(k.K,1),S:h(k.S,1),T:h(k.T,1),Mb:h(k.Mb,1),I:h(k.I,1),cb:h(k.cb,1),ba:h(k.ba,1),Nb:h(k.Nb,1),gb:h(k.gb,1),bb:h(k.bb,1),rb:h(k.rb,1),Hb:h(k.Hb,1),Pb:h(k.Pb,1),Ka:h(k.Ka,1),La:h(k.La,1),i:h(k.i,1),Fb:h(k.Fb,1),Gb:h(k.Gb,1),kc:h(k.kc,
1),Ob:h(k.Ob,1),eb:h(k.eb,1),hb:h(k.hb,1),Sa:h(k.Sa,1),Xa:h(k.Xa,1),Va:h(k.Va,1),Db:h(k.Db,1),ka:h(k.ka,1),zb:h(k.zb,1),ub:h(k.ub,1),vb:h(k.vb,1),wb:h(k.wb,1),xb:h(k.xb,1),yb:h(k.yb,1)};n=M.pc;h(k.Ka,2);h(k.Sa,2);h(k.Xa,2);h(k.La,2)}}class t{constructor(a,b){this.x=a;this.y=b}is(a){let b=this.y,c=a.y;return this.x==a.x&&b==c}M(a){if(!a)return 1/0;let b=this.x,c=this.y,d=a.x;a=a.y;if(b==d&&c==a)return 0;if(b==d)return Math.abs(c-a);if(c==a)return Math.abs(b-d);let e=0;return e+=Math.pow(b-d,2),e+=
Math.pow(c-a,2),e=Math.sqrt(e),e}kb(a){let b=this.x,c=this.y,d=a.x;a=a.y;return b==d&&c==a?4:b>d?6:b<d?2:c<a?4:c>a?0:4}cc(a,b){let c=this.clone();return c.move(a,b),c}move(a,b){0==a?this.y-=b:4==a?this.y+=b:6==a?this.x-=b:2==a?this.x+=b:7==a?(this.y-=b,this.x-=b):1==a?(this.y-=b,this.x+=b):3==a?(this.y+=b,this.x+=b):5==a&&(this.y+=b,this.x-=b)}cc(a,b){let c=this.clone();return c.move(a,b),c}Zc(a,b){let c=a.x-this.x,d=a.y-this.y,e=Math.sqrt(c*c+d*d);e<b?(this.x=a.x,this.y=a.y):(this.x+=(c/e||0)*b,
this.y+=(d/e||0)*b)}clone(){return new t(this.x,this.y)}s(a,b="red"){a.fillStyle=b;this.ib(a,3,b)}ib(a,b=4,c="green"){a.fillStyle=c;a.strokeStyle=c;a.beginPath();a.arc(this.x,this.y,b,0,2*Math.PI);a.fill()}static ib(a,b,c,d=1,e="green"){a.fillStyle=e;a.strokeStyle=e;a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.fill()}}const R=[{ha:25,D:1,va:1},{ha:25,D:5,va:4},{ha:25,D:8,va:10},{ha:25,D:9,va:20},{ha:25,D:9,va:15},{ha:25,D:9,va:10}];class G{constructor(a,b=0,c=null){this.type=b;this.g=a;this.C=this.ga();
this.j=this.C[this.type];this.h=c||a.yc();this.A=R[this.type].D;this.ra=R[this.type].D;this.Bb=R[this.type].ha;this.ja=[]}Yc(){var a=this.g.l;const b=this.g.ic.Yb(this.h.x/a,this.h.y/a,this.g.i.h.x/a,this.g.i.h.y/a);b&&2<=b.length&&(this.h=new t(b[1][0]*a,b[1][1]*a))}update(a){this.time=a;this.Bb--;0>=this.Bb&&(this.Bb=R[this.type].ha-this.g.O,this.Yc(),this.h.M(this.g.i.h)<1.5*this.g.l&&(this.g.i.A-=this.type+1,this.g.i.mc=3))}lb(a){if(this.A!=this.ra){var b=v(this.j.width,3),c=b.getContext("2d");
c.fillStyle="green";c.fillRect(0,0,this.A/this.ra*this.j.width,3);a.drawImage(b,this.h.x,this.h.y)}}s(a){a.drawImage(this.j,this.h.x,this.h.y);this.lb(a)}ga(){if(G.ca)return G.ca;var a=this.g.R,b=this.g.l,c=F(h(k.Hb,a),b,b,!1),d=F(h(k.Pb,a),b,b,!1),e=F(h(k.hb,a),b,b,!1),f=h(k.eb,a),g=h(k.Va,a),l=h(k.Db,a);a=h(k.Mb,a);this.D=this.w=b;return G.ca=[c,d,e,f,g,l,a],G.ca}}class ja extends G{constructor(a,b=0,c=null){super(a,b,c)}s(a){super.s(a);a.drawImage(this.C[6],this.h.x+.65*this.j.width,this.h.y+.25*
this.j.height)}}class aa{constructor(a,b=2){this.g=a;this.Cb=b;this.u=[];this.ga(b)}Kb(a){var b=this.g.l*this.Cb;this.h=new t(a.x+this.g.l*this.Cb/2,a.y+b/2);var c=new t(a.x,a.y+b),d=new t(a.x+this.g.l,a.y+b);a=new t(a.x+2*this.g.l,a.y+b);this.X=[c,d,a]}s(a){a.drawImage(this.T,this.h.x-this.T.width/2,this.h.y-this.T.width/2)}update(a){this.time=a;this.u=this.u.filter(c=>0<c.A);var b=Math.abs(this.h.x-this.g.i.h.x);if(Math.abs(this.h.y-this.g.i.h.y)<=8*this.g.l&&b<=6*this.g.l)for(let c in this.X)(b=
this.g.Ra(this.X[c].x,this.X[c].y))||(b=new ja(this.g,4,this.X[c]),this.u.push(b),this.g.u.push(b));[...this.u].forEach(c=>{c.update&&c.update(a)})}ga(a=2){a=h(k.Ka,a);var b=W(a),c=b.flat(),d=[...(new Set(c))];c={};for(f of d)for(c[f]=[],d=0;d<b.length;d++){c[f].push([]);for(var e=0;e<b[d].length;e++)b[d][e]===f?c[f][d][e]="#000000":c[f][d][e]=null}var f=(delete c.zd,c);var g=h(f["#6a6a6a"]),l=h(f["#c2c2c2"]);f=B(g,w(n.L,.5));b=B(g,w(n.H,.5));c=B(g,w(n.K,.5));d=B(g,w(n.T,.5));e=B(g,w(n.S,.5));g=B(g,
w(n.ba,.5));var m=B(l,w(n.L,.2)),q=B(l,w(n.H,.2)),u=B(l,w(n.K,.2)),A=B(l,w(n.T,.2)),z=B(l,w(n.S,.2));l=B(l,w(n.ba,.2));this.L=L([a,m,f]);this.H=L([a,q,b]);this.K=L([a,u,c]);this.T=L([a,A,d]);this.S=L([a,z,e]);this.ba=L([a,l,g])}}class ka extends O{constructor(a){super(a);this.ob=!1;this.aa=0}ya(){M.ya();var a=n.L,b=n.S,c=x(a,n.H);a=x(b,a);this.pa=new aa(this);this.i=h(k.i,2);this.nb=function(d,e,f,g,l=1){1<l&&(d=y(d,l),e=y(e,l));d=x(d,e);e=v(d.width*g,d.height*f);l=e.getContext("2d");for(let m=0;m<
f;m++)for(let q=0;q<g;q++)l.drawImage(d,m*d.height,q*d.width);return e}(c,a,this.o.canvas.width/8,this.o.canvas.height/8);this.nb=w(this.nb,.2);this.log=this.Jc();this.buffer=this.wa();this.aa=-20;this.pb=this.Ic();this.ob=!0}Jc(){var a=v(400,200),b=a.getContext("2d"),c=n.H,d=n.L,e=n.K,f=n.S,g=x(d,c);f=x(f,f);c=x(c,e);d=x(e,d);return this.ea=[C.get("13th CENTURY\u2122",20,"green",d,"Arial Black"),C.get("ROBIN\u27b8HOOD ",40,"green",g,"Arial Black"),C.get("THE\u27b8OUTLAW ",28,"green",f,"Arial Black"),
C.get("\u26051370s\u2235\u2234\u2235\u2234\u2235\u2234\u2235\u2234\u2235\u2234\u2235\u2234\u22352023\u2605",15,"green",c,"Arial Black")],b.drawImage(p(this.ea[0],"white"),0,1),b.drawImage(this.ea[0],1,1),b.drawImage(p(this.ea[1],"red"),1,18),b.drawImage(this.ea[1],0,17),b.drawImage(p(this.ea[2],"white"),85,53),b.drawImage(this.ea[2],85,52),b.drawImage(this.ea[3],82,82),a}Ic(){var a="you step into the legendary shoes of Robin Hood.;your mission is to make the world a better place.;- explore forest and hunt animals;- trade with merchants;- take quest from villagers;- improve your stats and defend the village;a w s d / arrows for movement;e interact, q menue, space fire".split(";"),
b=v(360,500);let c=b.getContext("2d");c.fillStyle="white";c.font="16px Arial";for(let d=0;d<a.length;d++)c.fillText(a[d],0,25*d+20);return b}update(a){this.time=a;this.aa+=.5;!this.ob&&15<this.aa&&document.querySelector("#spriteSheetMain").complete&&this.ya()}wa(){let a=v(this.o.G.width,this.o.G.height),b=a.getContext("2d");b.drawImage(this.nb,0,0);return b.drawImage(this.log,400>this.o.G.width?16:128,74),a}s(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,
a.canvas.height);this.ob?(a.drawImage(this.buffer,0,0),a.drawImage(this.pa.L,16,192),a.drawImage(this.pa.H,88,192),a.drawImage(this.pa.K,160,192),a.drawImage(this.pa.T,232,192),a.drawImage(this.pa.S,304,192),a.drawImage(this.pa.ba,376,192),a.drawImage(this.i,16,320),a.drawImage(V(this.pb,0,this.aa%this.pb.height,this.pb.width,200),64,320)):(a.fillStyle="green",a.fillText(`loading sprites ${this.time} ${this.aa} ${document.querySelector("#spriteSheetMain").complete}`,20,20))}Qa(){100<this.aa&&this.o.Ya();
this.aa=100}control(){this.Qa()}click(){this.Qa()}za(){this.Qa()}qa(){this.Qa()}}class la{constructor(a,b=300,c=!0,d=!0,e=3){this.P=a;this.od=b;this.loop=e;this.pitch=d;this.Ca=!1;this.W=new AudioContext;this.ec=this.P;c&&this.start()}toggle(){this.Ca?this.stop():this.start()}start(){this.Ca=!0;this.jc()}stop(){this.Ca=!1}reset(){this.P=this.ec}Nc(a){switch(a){case "B":return 493.88;case "C":return 261.63;case "D":return 293.66;case "E":return 329.63;case "F":return 349.23;case "G":return 392}return 440}Fc(a){var b=
this.Nc(a[0]);return 1<a.length?b*Math.pow(2,a[1]/12):b}jc(){if(this.Ca)if(0===this.P.length&&0<this.loop&&(this.P=this.ec,this.loop--),0===this.P.length)this.stop();else{var a=this.P[0];this.pitch?(this.P[1],this.P=this.P.slice(2)):this.P=this.P.slice(1);var b=this.W.createOscillator(),c=this.W.createGain();b.connect(c);c.connect(this.W.destination);b.frequency.setValueAtTime(this.Fc(a),this.W.currentTime);b.start();c.gain.setValueAtTime(0,this.W.currentTime);c.gain.exponentialRampToValueAtTime(.05,
this.W.currentTime+.02);setTimeout(()=>{c.gain.setValueAtTime(.05,this.W.currentTime);c.gain.exponentialRampToValueAtTime(.001,this.W.currentTime+.02);b.stop(this.W.currentTime+.02);this.jc()},60/this.od*1E3)}}}class ma extends O{constructor(a){super(a);this.C={S:n.S,K:n.K,ka:n.ka,H:n.H,L:n.L,ba:n.ba,i:n.i};this.Y=400>this.o.G.width?32:100;this.m=[{x:this.Y,y:128},{x:this.Y,y:160},{x:this.Y,y:192},{x:this.Y,y:224},{x:this.Y,y:256},{x:this.Y,y:288},{x:this.Y,y:320}];this.Ba="robin hood";this.v=0;this.fb=
this.ta=!1;this.buffer=this.nd()}nd(){var a=v(this.o.G.width,this.o.G.height);return a.getContext("2d"),a}update(a){this.time=a}s(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.buffer,0,0);a.drawImage(C.get("\u2588 \u24c5\u24c1\u24b6\u24ce \u24bc\u24b6\u24c2\u24ba",24,"green",this.C.H,"Verdana"),this.m[0].x+20,this.m[0].y);a.drawImage(C.get("\u2588 SOUND : "+(this.ta&&1==
this.ta?"on":"off"),24,"green",this.C.K,"Verdana"),this.m[1].x+20,this.m[1].y);a.drawImage(C.get("\u2588 Music : "+(this.sa&&this.sa.Ca?"on":"off"),24,"green",this.C.K,"Verdana"),this.m[2].x+20,this.m[2].y);a.drawImage(C.get(`\u2588 NAME : ${this.Ba}`,24,"green",this.C.K,"Verdana"),this.m[3].x+20,this.m[3].y);a.drawImage(C.get("\u2588 Cheatmode : "+(this.fb?"on":"off"),24,"green",this.C.ka,"Verdana"),this.m[4].x+20,this.m[4].y);a.drawImage(C.get("\u2588 STATS \u32e1",24,"green",this.C.L,"Verdana"),
this.m[5].x+20,this.m[5].y);a.drawImage(C.get("\u2588 GOD MODE : "+(this.ac?"on":"off"),24,"green",this.C.ka,"Verdana"),this.m[6].x+20,this.m[6].y);a.drawImage(this.C.i,this.m[this.v].x,this.m[this.v].y+4);a.fillText("Time "+this.time,20,20)}click(){}control(a){if("s"===a||"ArrowDown"===a)this.v=P(this.v+1)%this.m.length;else if("w"===a||"ArrowUp"===a)0==this.v?this.v=this.m.length-1:this.v=P(this.v-1)%this.m.length;else if("a"===a||"ArrowLeft"===a||"d"===a||"ArrowRight"===a||"space"===a||" "===a)0==
this.v?(this.o.B||confirm("start new game?"))&&this.o.qd():1==this.v?this.ta?this.ta=!1:this.ta=!0:2==this.v?(this.sa||(this.sa=new la("E4E4D4E4E4D4E4G4G4A4A4E4E4D4E4E4D4E4G4G4A4A4G4G4E4E4D4E4E4D4E4A4A4",120,!1,!0,2E3)),this.sa.toggle()):3==this.v?this.Ba=(a=prompt("name",this.Ba))&&0<a.length?a.substring(0,10):this.Ba:4==this.v?(this.fb=!0,this.o.B&&(this.o.B.i.U=1E7)):5==this.v?(this.sa&&this.sa.stop(),this.o.B?this.o.sd():alert("start game before using this page")):6==this.v&&(this.ac=!0,this.o.B&&
this.o.B.i.Na())}za(){}qa(a){this.control(a.key)}}class na extends G{constructor(a,b=null){super(a,5,b);this.Fa=0;this.Wa=K(2,5)}Ta(){this.Rc()}Rc(){var a=K(0,this.Fa),b=K(a+this.g.O,a+this.g.O+this.Wa);a=K(a+this.g.O,a+this.g.O+this.Wa);var c=(this.Wa+this.g.O)*this.g.i.attributes.$;confirm(`Quest\n ${b} apples and ${a} oranges for ${c} points`)&&(this.g.i.ia>=a&&this.g.i.fa>=b?(this.g.i.ia-=a,this.g.i.fa-=b,this.g.i.points+=c,this.Fa++):alert("insufficient materials"))}update(){}s(a){a.drawImage(this.j,
this.h.x,this.h.y)}}class oa extends G{constructor(a,b=null){super(a,5,b);this.j=this.Pa();this.Fa=0;this.Wa=1}Pa(){return h(k.Va,this.g.R,a=>"#bf0a0a"==a||"#990000"==a?"#76428a":a)}Ta(){this.mb()}mb(){var a=this.g.O,b=this.Fa+this.g.O,c=K(a,b);a=K(a,b);b=this.g.O*(c+a);0>=(b-=K(0,this.g.i.attributes.$*b/2))&&(b=1);confirm(`trade offer\n${c} apples and ${a} oranges for ${b} $`)&&(this.g.i.U>=b?(this.g.i.ia+=a,this.g.i.fa+=c,this.g.i.U-=b,this.Fa++):alert("not enough cash"))}update(){}s(a){a.drawImage(this.j,
this.h.x,this.h.y)}}class pa extends G{constructor(a,b=null){super(a,5,b);this.j=this.Pa()}Pa(){var a=h(k.Ob,this.g.R,b=>b);return F(a,this.g.l,this.g.l)}Ta(){this.mb()}mb(){confirm("magic bow 1000000 $")&&(1E6<=this.g.i.U?alert("you have your skills, you dont need a magic bow"):alert("insufficient cash"))}update(){}s(a){a.drawImage(this.j,this.h.x,this.h.y)}}class qa{constructor(a,b=2){this.g=a;this.Cb=b;this.u=[];this.j=h(k.La,b)}Kb(a){var b=this.j.height;this.h=new t(a.x+this.j.width/2,a.y+b/2);
this.X=[new t(a.x+this.g.l,a.y+b)]}s(a){a.drawImage(this.j,this.h.x-this.j.width/2,this.h.y-this.j.height/2)}update(a){if(this.u=this.u.filter(c=>0<c.A),[...this.u].forEach(c=>{c.update&&c.update(a)}),this.time!=a&&(this.time=a,this.h.M(this.g.i.h)<=4.5*this.g.l))for(let c in this.X)if(!(b=this.g.Ra(this.X[c].x,this.X[c].y))){var b=new G(this.g,3,this.X[c]);this.u.push(b);this.g.u.push(b)}}}const S=[{n:"p",F:1,c:"#0d3702"},{n:"p",F:1,c:"#bf0a0a"},{n:"p",F:0,c:"#d9a066"},{n:"p",F:0,c:"#99e550"},{n:"p",
F:2,c:"#8a99f6"},{n:"p",F:1,c:"#6a6a6a"},{n:"p",F:0,c:"#dcdcdc"},{n:"p",F:0,c:"#130c40"},{n:"p",F:1,c:"#fff300"},{n:"p",F:1,c:"#76428a"},{n:"p",F:1,c:"#191919"},{n:"p",F:0,c:"#ff0000"},{n:"p",F:1,c:"#2e2b2b"},{n:"p",F:0,c:"#df7126"},{n:"p",F:0,c:"#d1d1d1"},{n:"p",F:0,c:"#898898"}],H=a=>{switch(a){case "#130c40":return"player";case "#fff300":return"villager";case "#76428a":return"merchant";case "#191919":return"wizzard";case "#a9a9a9":return"castle";case "#2e2b2b":return"cave"}return null};class ra{constructor(a,
b=1){this.B=a;this.ed=y(n.L,4);this.fd=y(n.H,4);this.md=y(n.K,4);this.jd=y(n.ka,4);this.dd=y(n.T,4);this.kd=y(n.S,4);this.ld=h(k.Nb,4);this.gd=h(k.Sa,4);this.hd=h(k.Xa,4);this.$a=[0,0];this.oa=[];this.ua=[];this.V=[];this.Pc(b);this.Eb=this.Oc()}Oc(){var a={};for(var b in S)a[S[b].c]=S[b].F;b=[];for(var c=0;c<this.V.length;c++){b[c]=[];for(var d=0;d<this.V[c].length;d++){var e=a[this.V[d][c]];b[c][d]=null!=e&&0==e?0:1}}return b}qb(a,b){return(a=Math.floor(a),b=Math.floor(b),0>a)||a>this.V.length-
1||0>b||b>this.V.length-1||!this.V[a]?!0:this.Tc(this.V[b][a])}Tc(a){var b=S.find(c=>c.c==a);return null==b?1:b.F}Lc(){var a=n.zb,b=n.ub,c=n.vb,d=n.wb,e=n.xb,f=n.yb,g=a.width,l=v(3*g,3*a.height),m=l.getContext("2d");for(let q=0;3>q;q++)for(let u=0;3>u;u++)m.drawImage(c,q*g,u*g);return m.drawImage(d,g,0),m.drawImage(e,2*g,2*g),m.drawImage(f,2*g,g),m.drawImage(b,0,0),m.drawImage(a,g,g),l}Kc(a,b=32){var c=[],d=[],e={},f=a.length,g=a[0].length;c=Array(f).fill(null).map(()=>Array(g).fill(null));d=Array(f).fill(null).map(()=>
Array(g).fill(null));var l=new t(32,32),m=[],q=[];Y(a,(u,A,z)=>{if(c[A][z]=(E=>{switch(E){case "#99e550":return"grass";case "#d9a066":return"dirt";case "#dcdcdc":return"snow";case "#8a99f6":return"water"}return null})(u)||"grass",d[A][z]=(E=>{switch(E){case "#0d3702":return"tree";case "#bf0a0a":return"brick";case "#6a6a6a":return"steel";case "#fbf236":return"house";case "#eca732":return"shop"}return null})(u)||null,e[H(u)]||(e[H(u)]=[]),H(u))(e[H(u)].push([A,z]),"player"==H(u))?l=new t(A*b,z*b):"villager"==
H(u)?m.push(new na(this.B,new t(A*b,z*b))):"merchant"==H(u)?m.push(new oa(this.B,new t(A*b,z*b))):"wizzard"==H(u)?m.push(new pa(this.B,new t(A*b,z*b))):"castle"==H(u)?(u=new aa(this.B,4),u.Kb({x:A*b,y:z*b}),q.push(u)):"cave"==H(u)&&(u=new qa(this.B,4),u.Kb({x:A*b,y:z*b}),q.push(u))});a=this.Ub(c,b);f=this.Ub(d,b);return{Dd:c,Ad:d,pd:a,$c:f,yd:e,bd:l,vd:m,rc:q}}Ub(a,b=32){var c=v(a.length*b,a.length*b),d=c.getContext("2d");return Y(a,(e,f,g)=>{var l=e?this.Hc(e):null;e&&l&&d.drawImage(l,g*b,f*b)}),
c}Hc(a){switch(a){case "dirt":return this.ed;case "grass":return this.fd;case "water":return this.md;case "snow":return this.jd;case "brick":return this.dd;case "steel":return this.kd;case "tree":return this.ld;case "house":return this.gd;case "shop":return this.hd;default:return null}}Pc(a=1){var b=this.Lc();this.map=b;a*=16;this.V=b=W(b);this.tb=b=this.Kc(b,a);this.$a=this.tb.bd;this.oa=this.tb.vd;this.ua=this.tb.rc;this.Vc=L([b.pd,b.$c])}}class sa{constructor(a,b,c,d,e){this.Zb=a;this.h=new t(0,
0);this.D=c;this.w=b;this.fc=d;this.hc=e}Cc(a){this.h=new t(a.x,a.y)}Uc(a){this.h=a}move(a){this.h.move(a,32)}Dc(a){var b=this.h.x-this.w/2,c=this.h.y-this.D/2;return V(a,0>b?0:b,0>c?0:c,this.w,this.D)}s(a,b){let c;let d,e,f,g,l,m;var q=this.h.y-this.D/2;c=this.h.x-this.w/2;0>=c&&(c=0,this.h.x=c+this.w/2);0>=q&&(q=0,this.h.y=q+this.D/2);c+this.w>b.width&&(c=b.width-this.w,this.h.x=c+this.w/2);q+this.D>b.height&&(q=b.height-this.D,this.h.y=q+this.D/2);f=this.fc;g=this.hc;d=l=this.w;e=m=this.D;a.drawImage(b,
c,q,d,e,f,g,l,m)}Gc(a,b,c=32){var d=this.h.x-this.w/2,e=this.h.y-this.D/2;a=a+(0>d?0:d)-this.fc;b=b+(0>e?0:e)-this.hc;return a=Math.floor(a/c)*c,b=Math.floor(b/c)*c,new t(a,b)}}class ba{constructor(){this.Z=6;this.ma=this.la=1;this.na=10;this.$=this.da=1}Na(){this.$=this.da=this.na=this.ma=this.la=this.Z=15}static clone(a){var b=new ba;b.Z=a.Z;b.la=a.la;b.ma=a.ma;b.na=a.na;b.da=a.da;b.$=a.$}jb(a){switch(a){case "ARCHERY":return this.Z;case "HEALTH":return this.la;case "POWER":return this.ma;case "SPEED":return this.na;
case "STELTH":return this.da;case "LUCK":return this.$;default:return 0}}wc(a,b){switch(a){case "ARCHERY":this.Z=b;break;case "HEALTH":this.la=b;break;case "POWER":this.ma=b;break;case "SPEED":this.na=b;break;case "STELTH":this.da=b;break;case "LUCK":this.$=b}}Qc(){return[{n:"HEALTH",Ga:this.la},{n:"POWER",Ga:this.ma},{n:"ARCHERY",Ga:this.Z},{n:"SPEED",Ga:this.na},{n:"STELTH",Ga:this.da},{n:"LUCK",Ga:this.$}]}}class ca{constructor(a){this.h=new t(a.x,a.y);this.A=1}s(a){a.drawImage(this.j,this.h.x,
this.h.y)}}class N extends ca{constructor(a){super(a.h);this.e=a;this.direction=a.direction;this.C=this.ga();this.j=this.C[this.direction];this.width=this.j.width;this.height=this.j.height;this.speed=this.width;this.uc=this.e.attributes.Z;this.dc=0;this.A=1}update(a){this.time=a;this.dc++;this.dc<this.uc?(this.h.move(this.direction,this.speed),this.e.qc(this)):this.A=0}ga(){if(N.ca)return N.ca;var a=this.e.g.R,b=16*a,c=F(h(k.cb,a),b,b);a=Q(c,0);b=Q(c,2);var d=Q(c,4);c=Q(c,6);this.w=a.width;this.D=
a.height;return N.ca=[c,c,a,a,b,b,d,c],N.ca}}class T extends ca{constructor(a,b,c=1){super(b);this.g=a;this.value=c;this.j=this.Ec()}update(a){this.time=a;this.h.M(this.g.i.h)<1.5*this.g.l&&(this.g.i.U+=this.value,this.A=0)}s(a){super.s(a)}Ec(){if(T.Qb)return T.Qb;var a=this.g.l;a=F(h(k.gb,this.g.R),a,a,!1);return T.Qb=a,a}}class ta{constructor(a){this.g=a;this.A=this.ra=100;this.ia=this.fa=this.points=this.U=this.Da=0;this.attributes=new ba(1);this.h=new t(0,0);this.destination=new t(0,0);this.Ua=
!1;this.time=0;this.direction=4;this.C=this.ga();this.j=this.C[4];this.Oa=0;this.Ea=[];this.Za=1E3}Na(){this.A=this.Za=this.ia=this.fa=this.points=this.U=1E7;this.attributes.Na()}$b(){var a=this.g.l*(12-this.attributes.da);return a<=1.5*this.g.l&&(a=1.5*this.g.l),a}setPosition(a){this.h=new t(a.x,a.y);this.destination=new t(a.x,a.y)}update(a){this.Oa=Math.max(this.Oa-1,0);this.Ea=this.Ea.filter(b=>0<b.A);[...this.Ea].forEach(b=>{b.update&&b.update(a)});this.time=a;0!=this.h.M(this.destination)?(this.Ua=
!0,this.h.Zc(this.destination,this.j.width/2),this.g.Ja.Cc(this.h)):this.Ua=!1;this.u=this.g.u.filter(b=>b.h.M(this.h)<this.$b());0<this.u.length&&[...this.u].forEach(b=>{b.update&&b.update(this.time)})}Bc(){0<this.Oa||(this.Oa=20-2*this.attributes.Z,this.Za--,this.Ea.push(new N(this)),this.ad())}qc(a){var b=a.h;b=this.g.N.qb(b.x/this.g.l,b.y/this.g.l);1!=b&&1!=b||2==b||(a.A=0);for(let c=0;c<this.g.u.length;c++)b=this.g.u[c],b.h.M(a.h)<this.g.l&&null!=b.type&&(b.A-=a.A,0>=b.A&&(this.g.u.push(new T(this.g,
b.h,b.type+1)),5==b.type?this.Da-=b.type+1:this.Da+=b.type+1),a.A=0)}lb(){var a=v(this.j.width,3),b=a.getContext("2d");b.fillStyle="green";this.A<this.ra/2&&(b.fillStyle="orange");this.A<this.ra/2&&(b.fillStyle="red");return b.fillRect(0,0,this.A/this.ra*this.j.width,3),a}s(a){a.drawImage(this.j,this.h.x,this.h.y);4==this.direction?a.drawImage(this.I,this.h.x+this.j.width-this.I.width,this.h.y+this.j.height-1.5*this.I.height):6==this.direction?a.drawImage(Z(this.I),this.h.x+this.j.width-1.6*this.I.width,
this.h.y+this.j.height-1.3*this.I.height):2==this.direction&&a.drawImage(this.I,this.h.x+this.j.width-1.2*this.I.width,this.h.y+this.j.height-1.3*this.I.height);[...this.Ea].forEach(b=>{b.s&&b.s(a)});a.drawImage(this.lb(),this.h.x,this.h.y);0<this.mc&&(a.fillStyle="#ff0000aa",a.fillRect(this.h.x,this.h.y,this.j.width,this.j.height),this.mc--);this.vc(a)}Ib(a,b){this.direction=a=this.h.kb(new t(a,b));this.j=this.C[a]}moveTo(a,b){if(!this.g.Vb(a,b)){var c=this.h.kb(new t(a,b));this.direction=c;0!=this.h.M(new t(a,
b))&&(this.j=this.C[c],this.move(c))}}move(a){a===this.direction?this.Ua||this.destination.move(a,this.width):this.direction=a}ga(){this.I=h(k.I,this.g.R);var a=h(k.i,this.g.R),b=h(k.Fb,this.g.R),c=h(k.Gb,this.g.R);return this.width=a.width,this.height=a.height,[b,b,c=F(c,this.width,this.height),a,a,a,Z(c,!0),b]}Pa(){return this.j}ad(){if(this.g.o.Aa.ta){for(var a=new AudioContext,b=a.createBuffer(1,96E3,48E3),c=b.getChannelData(0),d=96E3;d--;){var e=d;if(2E4<d)var f=null;else f=(2E4-d)/2E4,f=93&
Math.pow(50*d,.7)?f:-f;c[e]=f}c=a.createBufferSource();c.buffer=b;c.connect(a.destination);c.start()}}vc(a){var b=this.$b();0>=b||(a.beginPath(),a.arc(this.h.x+this.j.width/2,this.h.y+this.j.width/2,b,0,2*Math.PI,!1),a.setLineDash([5,25]),a.strokeStyle="red",a.stroke(),a.setLineDash([]))}}class ua{constructor(a){this.Wc=a;this.rows=a.length;this.cols=a[0].length}Yb(a,b,c,d){a=Math.floor(a);b=Math.floor(b);c=Math.floor(c);d=Math.floor(d);const e=[],f=new Set,g={},l=Array(this.rows).fill(null).map(()=>
Array(this.cols).fill(1/0));l[a][b]=0;const m=Array(this.rows).fill(null).map(()=>Array(this.cols).fill(1/0));m[a][b]=this.bc(a,b,c,d);for(e.push([a,b]);0<e.length;){a=this.zc(e,m);const [q,u]=a;if(q===c&&u===d)return this.cd(g,a);e.splice(e.indexOf(a),1);f.add(`${q}-${u}`);b=this.Mc(q,u);for(const A of b){const [z,E]=A;f.has(`${z}-${E}`)||this.Wc[z][E]||(b=l[q][u]+1,b<l[z][E]&&(g[`${z}-${E}`]=a,l[z][E]=b,m[z][E]=b+this.bc(z,E,c,d),e.includes(A)||e.push(A)))}}return null}bc(a,b,c,d){return Math.abs(a-
c)+Math.abs(b-d)}zc(a,b){let c=a[0],d=b[c[0]][c[1]];for(const e of a){const [f,g]=e;b[f][g]<d&&(c=e,d=b[f][g])}return c}Mc(a,b){const c=[];return 0<a&&c.push([a-1,b]),a<this.rows-1&&c.push([a+1,b]),0<b&&c.push([a,b-1]),b<this.cols-1&&c.push([a,b+1]),c}cd(a,b){const c=[b];for(;a.hasOwnProperty(`${b[0]}-${b[1]}`);)b=a[`${b[0]}-${b[1]}`],c.unshift(b);return c}}class va extends O{constructor(a){super(a);this.ya()}ya(){this.O=1;this.Ha=5;this.R=2;this.l=16*this.R;this.keyboard={};this.N=new ra(this,this.R);
this.Ab=w(this.N.map,.7);this.i=new ta(this);this.o.Aa.fb&&(this.i.U=1E7);this.o.Aa.ac&&this.i.Na();this.i.setPosition(this.N.$a?this.N.$a:new t(224,224));this.Ja=new sa(this,this.o.G.width,this.o.G.height,0,0);this.Ja.Uc(this.i.h);this.Ba="robin hood";this.oa=[...this.N.oa];this.ua=[...this.N.ua];this.u=[];this.Eb=this.N.Eb;this.ic=new ua(this.Eb);this.ud=this.Ac();this.Xb();this.Rb()}Ra(a,b){a=Math.floor(a);b=Math.floor(b);a=new t(a,b);for(var c=0;c<this.oa.length;c++)if((b=this.oa[c]).h.M(a)<this.l)return b;
for(c=0;c<this.u.length;c++)if((b=this.u[c]).h.M(a)<this.l)return b;return null}Vb(a,b){return null!=this.Ra(a,b)||this.N.qb(a/this.l,b/this.l)}wa(){var a=v(this.o.G.width,this.o.G.height);let b=a.getContext("2d");b.clearRect(0,0,b.canvas.width,b.canvas.height);b.fillStyle="black";b.fillRect(0,0,b.canvas.width,b.canvas.height);var c=(e=>{if(!e)return null;let f=v(e.width,e.height);return f.getContext("2d").drawImage(e,0,0),f})(this.N.Vc),d=c.getContext("2d");if([...this.u].forEach(e=>{e.s&&e.s(d)}),
[...this.oa].forEach(e=>{e.s&&e.s(d)}),[...this.ua].forEach(e=>{e.s&&e.s(d)}),this.i.s(d),this.ja)for(let e in this.ja)b.drawImage(w(this.i.j,.8),this.ja[e][0]*this.l,this.ja[e][1]*this.l);c=this.Ja.Dc(c);return b.drawImage(c,0,0),a}update(a){this.time=a;this.u=this.u.filter(c=>0<c.A);this.i.update(a);for(var b in this.keyboard)this.keyboard[b]&&this.Sb(b);if(0>=this.i.A&&(alert("game over"),this.o.B=null,this.i.A=100,this.o.Ya()),this.ja&&0<this.ja.length)b=this.ja.shift(),this.i.h=new t(b[0]*this.l,
b[1]*this.l);0>=this.u.length&&(this.Ha+=5,this.O++,this.Rb());[...this.ua].forEach(c=>{c.update&&c.update(a)})}Rb(){for(let a=0;a<this.Ha&&!(this.u.length>this.Ha);a++){let b=new G(this,K(0,3));this.u.push(b)}}Ac(){var a=[];for(let c=0;c<this.N.V.length;c++)for(let d=0;d<this.N.V.length;d++){var b=new t(c*this.l,d*this.l);this.N.qb(c,d)||a.push(b)}return a}yc(){var a=this.Xb(8,25);return 0<a.length?a[K(0,a.length)]:new t(this.l,this.l)}Xb(a=8,b=13){var c=this.ud;c=(c=c.filter(f=>f.M(this.i.h)>this.l*
a)).filter(f=>f.M(this.i.h)<this.l*b);var d=[];for(let f in c){var e=!0;for(let g=0;g<this.u.length;g++)if(this.u[g].h.M(new t(c[f].x,c[f].y))<this.l){e=!1;break}e&&d.push(c[f])}return c}Sc(){var a=this.i.h.cc(this.i.direction,this.l);(a=this.Ra(a.x,a.y))&&a.Ta&&a.Ta()}Sb(a){if(" "!==a&&"space"!==a||this.i.Bc(),"e"===a)this.Sc(),this.keyboard={};else if("q"===a)this.keyboard.q=!1,this.o.Ya();else if(!this.i.Ua){var b=this.i.h.clone(),c=!1;if("s"===a||"ArrowDown"===a?(b.move(4,this.i.height),c=!0):
"w"===a||"ArrowUp"===a?(b.move(0,this.i.height),c=!0):"d"===a||"ArrowRight"===a?(b.move(2,this.i.height),c=!0):"a"!==a&&"ArrowLeft"!==a||(b.move(6,this.i.height),c=!0),c)a=this.i.h.kb(b),this.i.Ib(b.x,b.y),a!=this.i.direction?(this.i.Ib(b.x,b.y),this.keyboard={}):this.Vb(b.x,b.y)?this.i.Ib(b.x,b.y):this.i.moveTo(b.x,b.y)}}s(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";a.drawImage(this.wa(),
0,0);a.fillStyle="#004b52d6";a.fillRect(0,0,a.canvas.width,48);a.fillStyle="#ffffff";a.fillText("\u2665 "+J(this.i.A),15,15);a.fillText("\u2295 "+J(this.i.Da),15,30);a.fillText("\u263a"+J(this.i.points),15,45);a.fillText("\u27b9\t"+J(this.i.Za),96,15);a.fillText("\u0556\t"+J(this.i.U),96,30);a.fillText("Mobs "+J(this.u.length),192,15);a.fillText("LVL "+J(this.O),192,30);a.drawImage(n.bb,316,4);a.drawImage(n.rb,316,20);a.fillText("   "+J(this.i.fa),320,15);a.fillText("   "+J(this.i.ia),320,30);a.drawImage(this.Ab,
0,a.canvas.height-this.Ab.height);t.ib(a,this.i.h.x/this.l,a.canvas.height-this.Ab.height+this.i.h.y/this.l,3,"green")}click(a){var b=this.l;a=this.Ja.Gc(a.offsetX,a.offsetY,b);a=new t(a.x,a.y);this.ic.Yb(this.i.h.x/b,this.i.h.y/b,a.x/b,a.y/b)}control(a){this.Sb(a)}za(a){this.keyboard[a.key]=!0}qa(a){this.keyboard[a.key]=!1}}class wa{constructor(a){return this.target=a,this.Lb=[],!!a.addEventListener}sub(a){this.Lb.push(a)}clear(){this.Lb=[]}fireEvent(a){var b=this.Lb,c;for(c in b)b[c].notify&&b[c].notify(a)}}
class xa extends O{constructor(a){super(a);this.C={H:n.H,i:n.i};this.Y=400>this.o.G.width?32:100;this.B=this.o.B;this.m=[];this.Tb=this.B.i.attributes.Qc();for(let b in this.Tb)this.m.push({x:this.Y,y:192+32*b,k:this.Tb[b].n});this.v=0;this.buffer=this.wa()}wa(){var a=v(this.o.G.width,this.o.G.height),b=a.getContext("2d"),c=this.m[0],d=c.x+20;b.drawImage(this.xa("STATISTICS"),d,c.y-64);b.drawImage(this.xa("POINTS"),d,c.y-32);for(let e in this.m)c=this.m[e],b.drawImage(this.xa(`${c.k} `),d,c.y);return a}update(a){this.time=
a}xa(a){return C.get(a,24,"white",this.C.H)}s(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="black";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.fillStyle="green";a.font="16px Arial";var b=this.m[0],c=b.x+20;a.drawImage(this.buffer,0,0);a.drawImage(this.xa(`${this.B.i.points}`),c+150,b.y-32);for(let d in this.m)b=this.m[d],a.drawImage(this.xa(`${this.B.i.attributes.jb(b.k)}`),c+150,b.y);a.drawImage(this.C.i,this.m[this.v].x,this.m[this.v].y+4);a.fillText("Time "+this.time,20,
20)}click(){}control(a){if("q"===a)this.o.Ya();else if("w"===a||"ArrowUp"===a)0==this.v?this.v=this.m.length-1:this.v=P(this.v-1)%this.m.length;else if("s"===a||"ArrowDown"===a)this.v=P(this.v+1)%this.m.length;else if("d"==a||"ArrowRight"==a){if(0>=this.B.i.points)return void alert("no points to use");this.v;a=this.m[this.v].k;10<=this.B.i.attributes.jb(a)?alert("level max"):confirm("spend points "+a)&&(this.B.i.attributes.wc(a,this.B.i.attributes.jb(a)+1),--this.B.i.points)}}za(){}qa(a){this.control(a.key)}}
class ya{constructor(a){this.G=a;this.Ma=document.querySelector(a.Ma);this.canvas=Object.assign(document.createElement("canvas"),{width:a.width,height:a.height,className:"gamecanvas"});this.Ma.appendChild(this.canvas);this.J=new wa(document);["keydown","keyup"].forEach(b=>{document.addEventListener(b,c=>{this.J.fireEvent({name:b,event:c})})});this.canvas.addEventListener("click",b=>{this.J.fireEvent({name:"click",event:b})});this.rd();400>this.G.width&&(a.framerate/=2);this.ab=new ha(a.framerate,
this,!0);this.xc()}update(a){if(0==this.ab.p)if(this.time=a,this.g)try{this.g.update(a),this.g.s(this.canvas.getContext("2d"))}catch(b){console.log(b),this.ab.stop()}else this.ab.stop()}rd(){this.g=new ka(this);this.J.clear();this.J.sub(this.g)}Ya(){this.Aa||(this.Aa=new ma(this));this.g=this.Aa;this.J.clear();this.J.sub(this.g)}qd(){this.B||(this.B=new va(this));this.g=this.B;this.J.clear();this.J.sub(this.g)}sd(){this.nc||(this.nc=new xa(this));this.g=this.nc;this.J.clear();this.J.sub(this.g)}xc(){if(!(400<
this.G.width)){var a=Object.assign(document.createElement("div"),{className:"controls_container"});a.innerHTML="<table>\n        <tr><td id='q'>q</td><td id='w'>w</td><td id='e'>e</td><td class=\"padding\"></td><td id='space'>space</td> </tr>\n        <tr><td id='a'>a</td><td id='s'>s</td><td id='d'>d</td><td class=\"padding\"></td><td id='f'>f</td></tr></table>";this.Ma.appendChild(a);var b=((c,d=document)=>d.querySelectorAll(c))(".controls_container td");for(let c=0;c<b.length;c++)b[c].addEventListener("click",
()=>{this.J.fireEvent({name:"control",event:{key:b[c].id}})}),b[c].addEventListener("touchstart",()=>{this.J.fireEvent({name:"controlts",event:{key:b[c].id}})}),b[c].addEventListener("touchend",()=>{this.J.fireEvent({name:"controlte",event:{key:b[c].id}})})}}}const za={Ma:".canvas_container",Cd:32,wd:1,framerate:1/30,width:32*parseInt(window.innerWidth/32),height:32*parseInt(window.innerHeight/32),xd:"Assets",Bd:X("#spriteSheetMain")};class Aa extends ya{constructor(a){super(a)}}document.addEventListener("DOMContentLoaded",
function(){window.Zb||(window.Zb=new Aa(za))},!1)})();
